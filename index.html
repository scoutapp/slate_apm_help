<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Help Docs ~ Scout APM</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/screen_overrides.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
    <link href="stylesheets/scout.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js"></script>

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Slab:400,700' rel='stylesheet' type='text/css'>

      <script>
        $(function() {
          setupLanguages([]);
        });
      </script>

    <!-- Segment.io -->
    <script>
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
      analytics.load("vIATKC0XM9jmRNEQfF8kVJXwEChtmd1K");
      analytics.page();
      }}();
    </script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      // This sends traffic to the help-specific GA account. Segment is responsible for sending
      // data to the Scout overall property.
      ga('create', 'UA-3212349-13', 'auto', 'help_tracker');
      ga('help_tracker.send', 'pageview');

      //This does hash-click tracking (inspired by http://stackoverflow.com/a/4813223)
      $(document).ready(function() {
        $('.tocify-item a').on('click', function(){
          ga('help_tracker.send', 'pageview', {'page': location.pathname + location.search  + location.hash});
          analytics.page({'path': location.pathname + location.search  + location.hash});
        });
      });
    </script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <a href="https://scoutapp.com" target="_blank"><img src="images/logo.png" id="logo" alt="Logo" /></a>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="scout-help-docs">Scout Help Docs</h1>

<p>Welcome to the help site for <strong><a href="https://scoutapp.com">Scout Application Monitoring</a></strong>. Don&rsquo;t have an account? <a href="https://scoutapp.com/info/pricing" target="_blank">Get started - it&rsquo;s free</a>.</p>

<p>Browse through the sidebar, search, <a href="mailto:support@scoutapp.com">email us</a>, or <a href="http://slack.scoutapp.com" target="_blank">join our Slack community</a>. We&rsquo;re here to help.</p>

<div id="overview_container">
  <div>
    <h3><a href="#ruby-agent">Ruby Agent</a></h3>
    <p>
      View our docs for installing, configuring, and troubleshooting the Scout Ruby agent.
    </p>
  </div>

  <div>
    <h3><a href="#elixir-agent">Elixir Agent</a></h3>
    <p>
      View our docs for installing, configuring, and troubleshooting the Scout Elixir agent.
    </p>
  </div>

  <div>
    <h3><a href="https://scoutapp.com/info/pricing" target="_blank">Signup - it&rsquo;s free</a></h3>
    <p>
      Don&rsquo;t have an account? <a href="https://scoutapp.com/info/pricing" target="_blank">Signup</a> - our free plan
      monitors apps both large and small.
    </p>
  </div>
</div>

<h2 id="overview">Overview</h2>

<p>Scout Application Monitoring is a lightweight, production-grade application monitoring service built for modern development teams. Just embed our agent in your application: we handle the rest. </p>

<p>Here&rsquo;s an overview of the key functionality in our application monitoring service:</p>

<h3 id="agents">Agents</h3>

<p>We support Ruby on Rails apps and have beta support for Elixir.</p>

<p>Our agent is designed to run in production environments and has low overhead. Every minute, the agent transmits metrics to our service over SSL. </p>

<p>There&rsquo;s nothing to install on your servers.</p>

<h3 id="user-interface">User Interface</h3>

<p>A complete overview of the Scout UX is available in the <a href="#features">features</a> area of this help site.</p>

          <h1 id="ruby-agent">Ruby Agent</h1>

<h2 id="ruby-requirements">Requirements</h2>

<p>Our Ruby agent supports Ruby on Rails 2.2+ and Ruby 1.8.7+ and the following app servers/background job frameworks:</p>

<ul>
<li>Phusion Passenger</li>
<li>Puma</li>
<li>Rainbows</li>
<li>Thin</li>
<li>Unicorn</li>
<li>WEBrick</li>
<li>Sidekiq</li>
<li>DelayedJob</li>
<li>Resque</li>
</ul>

<p><a href="#memory-bloat-detection">Memory Bloat detection</a> and <a href="#scoutprof">ScoutProf</a> require Ruby 2.1+.</p>

<h2 id="ruby_install">Installation</h2>

<p>Tailored instructions are provided within our user interface. General instructions:</p>

<table class="help install install_ruby">
  <tbody>
      <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
              <p>Your Gemfile:</p>
<pre>
gem 'scout_apm'
</pre>

        <p><strong>Shell:</strong></p>

<pre>
bundle install
</pre>
      </td>
    </tr>
    <tr>
        <td><span class="step">2</span></td>
        <td><p>Download your customized config file, placing it at <code>config/scout_apm.yml</code>.</p>
        <p class="smaller">Your customized config file is available within your Scout account.</p>
      </td>
    </tr>
    <tr>
        <td><span class="step">3</span></td>
        <td><p>Deploy.</p></td>
    </tr>
    </tbody>
</table>

<h2 id="ruby-troubleshooting">Troubleshooting</h2>

<h3 id="no-data">No Data</h3>

<p>Not seeing any data?</p>

<table class="help">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Is there a <code>log/scout_apm.log</code> file?</p>
        <p><strong style="color:gray">Yes:</strong></p>
        <p>Examine the log file for error messages:</p>
<pre>
tail -n1000 log/scout_apm.log | grep "Starting monitoring" -A20
</pre>
        <p>
          See something noteworthy? Proceed to <a href="#step7">to the last step</a>. Otherwise, continue to step 2.
        </p>
        <p><strong style="color:gray">No:</strong></p>
        <p>
          The gem was never initialized by the application.</p>
        <p>
          Ensure that the <code>scout_apm</code> gem is not restricted to a specific <code>group</code> in your <code>Gemfile</code>. For example, the configuration below would prevent <code>scout_apm</code> from loading in a <code>staging</code> environment:
        </p>
<pre>
group :production do
  gem 'unicorn'
  gem 'scout_apm'
end
</pre>
        <p><a href="#step7">Jump to the last step</a> if <code>scout_apm</code> is correctly configured in your <code>Gemfile</code>.</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td>
        <p>Was the <code><strong>scout_apm</strong></code> gem deployed with your application?</p>
<pre>
bundle list scout_apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td>
        <p>Did you download the config file, placing it in <code><strong>config/scout_apm.yml</strong></code>?</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">4</span>
      </td>
      <td>
        <p>
          Did you restart the app?
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">5</span>
      </td>
      <td>
        <a name="step5"></a>
        <p>Are you sure the application has processed any requests?</p>
<pre>
tail -n1000 log/production.log | grep "Processing"
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">6</span>
      </td>
      <td>
        <p>
          Using Unicorn?
        </p>
        <p>Add the <code>preload_app true</code> directive to your Unicorn config file. <a href="http://unicorn.bogomips.org/Unicorn/Configurator.html#method-i-preload_app">Read more</a> in the Unicorn docs.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <a name="step7"></a>
        <span class="step">7</span>
      </td>
      <td>
        <p>
          Oops! Looks like messed up. <a href="mailto:support@scoutapp.com">Send us an email</a> with the following:
        </p>
        <ul>
          <li>The last 1000 lines of your <code>log/scout_apm.log</code> file, if the file exists:<br/><code>tail -n1000 log/scout_apm.log</code>.
          </li>
          <li>Your application&rsquo;s gems <code>bundle list</code>.
          </li>
          <li>
            Rails version
          </li>
          <li>
            Application Server (examples: Passenger, Thin, etc.)
          </li>
          <li>
            Web Server (examples: Apache, Nginx, etc.)
          </li>
        </ul>
        <p>
          We typically respond within a couple of hours during the business day.
        </p>
      </td>
    </tr>
  </tbody>
</table>

<h3 id="missing-memory-metrics">Missing memory metrics</h3>

<p>Memory allocation metrics require the following:</p>

<ul>
<li>Ruby version 2.1+</li>
<li><code class="prettyprint">scout_apm</code> version 2.0+</li>
</ul>

<p>If the above requirements are not met, Scout continues to function but does not report allocation-related metrics.</p>

<h2 id="updating-to-the-newest-version">Updating to the Newest Version</h2>

<p>The latest version of <code class="prettyprint">scout_apm</code> is <code><span id="latest-gem-version">SEE CHANGELOG</span></code>.</p>

<table class="help install">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Ensure your Gemfile entry for Scout is: <code>gem 'scout_apm'</code> </p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td><p>Run <code> bundle update scout_apm</code></p></td>
    </tr>
      <tr>
      <td><span class="step">3</span></td>
      <td><p>Re-deploy your application.</p></td>
    </tr>
  </tbody>
</table>

<p>The gem version changelog is <a href="https://github.com/scoutapp/scout_apm_ruby/blob/master/CHANGELOG.markdown">available here</a>.<br>
<h2 id="ruby-configuration-options">Configuration Options</h2></p>

<p>The Ruby agent can be configured via the <code class="prettyprint">config/scout_apm.yml</code> Yaml file and/or environment variables. A config file with your organization key is available for download as part of the install instructions.</p>

<h3 id="erb-evaluation">ERB evaluation</h3>

<p>ERB is evaluated when loading the config file. For example, you can set the app name based on the hostname:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "ProjectPlanner.io (#{Rails.env})" %&gt;</span>
</code></pre>
<h3 id="ruby-configuration-reference">Configuration Reference</h3>

<p>The following configuration settings are available:</p>

<table class="lookup">
  <thead>
    <tr>
      <th>
        Setting&nbsp;Name
      </th>
      <th>
        Description
      </th>
      <th>
        Default
      </th>
      <th>
        Required
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>
        name
      </th>
      <td>
        Name of the application (ex: &lsquo;Photos App&rsquo;).
      </td>
      <td>
        <code>Rails.application.class.to_s.
           sub(/::Application$/, '')</code>
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        key
      </th>
      <td>
        The organization API key.
      </td>
      <td></td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        monitor
      </th>
      <td>
        Whether monitoring should be enabled.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        log_level
      </th>
      <td>
        The logging level of the agent.
      </td>
      <td>
        <code>INFO</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        log_file_path
      </th>
      <td>The path to the <code>scout_apm.log</code> log file directory. Use <code>stdout</code> to log to STDOUT.
      </td>
      <td>
        <code>Environment#root+log/</code>&nbsp;or <code>STDOUT</code> if running on Heroku.
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        hostname
      </th>
      <td>
        The hostname the metrics should be aggregrated under.
      </td>
      <td>
        <code>Socket.gethostname</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        proxy
      </th>
      <td>Specify the proxy URL (ex: <code>https://proxy</code>) if a proxy is required.
      </td>
      <td></td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        host
      </th>
      <td>
        The protocol + domain where the agent should report.
      </td>
      <td>
        <code>https://apm.scoutapp.com</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        uri_reporting
      </th>
      <td>
        By default Scout reports the URL and filtered query parameters with transaction traces. Sensitive parameters in the URL will be redacted. To exclude query params entirely, use
        <code>path</code>.
      </td>
      <td>
        <code>filtered_params</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        disabled_instruments
      </th>
      <td>
        An Array of instruments that Scout should not install. Each Array element should should be a string-ified, case-sensitive class name (ex: <code>['Elasticsearch','HttpClient']</code>). The default installed instruments can be viewed in the <a href="https://github.com/scoutapp/scout_apm_ruby/tree/master/lib/scout_apm/instruments" target="_blank">agent source</a>.
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        ignore
      </th>
      <td>
        An Array of web endpoints that Scout should not instrument. Routes that match the prefixed path (ex: <code>['/health', '/status']</code>) will be ignored by the agent.
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        enable_background_jobs
      </th>
      <td>
        Indicates if background jobs should be monitored.
      </td>
      <td>
        <code>true</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>dev_trace</th>
      <td>
        Indicates if DevTrace, the Scout development profiler, should be enabled. Note this setting only applies
        to the development environment.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>No</td>
    </tr>
    <tr>
      <th>profile</th>
      <td>
        Indicates if ScoutProf, the Scout code profiler, should be enabled.
      </td>
      <td>
        <code>true</code>
      </td>
      <td>No</td>
    </tr>
    <tr>
      <th>revision_sha</th>
      <td>
        The Git SHA that corresponds to the version of the app being deployed.
      </td>
      <td>
        <a href="#deploy-tracking-config">See docs</a>
      </td>
      <td>No</td>
    </tr>
  </tbody>
</table>

<h3 id="ruby-env-vars">Environment Variables</h3>

<p>You can also configure Scout APM via environment variables. <em>Environment variables override settings provided in</em> <code class="prettyprint">scout_apm.yml</code>.</p>

<p>Environment variables have the same names as those in the Yaml config file, but are prefixed with <code class="prettyprint">SCOUT_</code>. For example, to set the organization key via environment variables:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">export</span> <span class="no">SCOUT_KEY</span><span class="o">=</span><span class="no">YOURKEY</span>
</code></pre>
<h2 id="deploy-tracking-config">Deploy Tracking Config</h2>

<p>Scout can <a href="#deploy-tracking">track deploys</a>, making it easier to correlate changes in your app to performance. To enable deploy tracking, first ensure you are on the latest version of <code class="prettyprint">scout_apm</code>. See our <a href="#updating-to-the-newest-version">upgrade instructions</a>.</p>

<p>Scout identifies deploys via the following:</p>

<ol>
<li>If you are using Capistrano, no extra configuration is required. Scout reads the contents of the <code class="prettyprint">REVISION</code> and/or <code class="prettyprint">revisions.log</code> file and parses out the SHA of the most recent release.</li>
<li>If you are using Heroku, enable <a href="https://devcenter.heroku.com/articles/dyno-metadata">Dyno Metadata</a>. This adds a <code class="prettyprint">HEROKU_SLUG_COMMIT</code> environment variable to your dynos, which Scout then associates with deploys.</li>
<li>If you are deploying via a custom approach, set a <code class="prettyprint">SCOUT_REVISION_SHA</code> environment variable equal to the SHA of your latest release.</li>
<li>If the app resides in a Git repo, Scout parses the output of <code class="prettyprint">git rev-parse --short HEAD</code> to determine the revision SHA.</li>
</ol>

<h2 id="ruby-devtrace">Enabling DevTrace</h2>

<p>To enable <a href="#devtrace">DevTrace</a>, our in-browser profiler:</p>

<table class="help install">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Ensure you are on the latest version of <code>scout_apm</code>.
          See our <a href="#updating-to-the-newest-version">upgrade instructions</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td>
        <p style="line-height: 170%">
          Add <code>dev_trace: true</code> to the <code>development</code> section of your <code>scout_apm.yml</code> config file or start your local Rails server with:
          <code>SCOUT_DEV_TRACE=true rails server</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td>
        <p>Refresh your browser window and look for the speed badge.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="request-queuing">Request Queuing</h2>

<p>Scout can measure the time it takes a request to reach your Rails app from farther upstream (a load balancer or web server). This appears in Scout as &ldquo;Request Queuing&rdquo; and provides an indication of your application&rsquo;s capacity. Large request queuing time is an indication that your app needs more capacity.</p>

<p><img src="images/request_queue_annotated.png" alt="request queuing" /></p>

<p>To see this metric within Scout, you need to configure your upstream software, adding an HTTP header that our agent reads. This is typically a one-line change.</p>

<h3 id="http-header">HTTP Header</h3>

<p>The Scout agent depends on an HTTP request header set by an upstream load balancer (ex: HAProxy) or web server (ex: Apache, Ngnix).</p>

<p><strong>Protip:</strong> We suggest adding the header as early as possible in your infrastructure. This ensures you won&rsquo;t miss performance issues that appear before the header is set.</p>

<p>The agent will read any of the following headers as the start time of the request:</p>
<pre class="highlight ruby tab-ruby"><code><span class="sx">%w(X-Queue-Start X-Request-Start X-QUEUE-START X-REQUEST-START x-queue-start x-request-start)</span>
</code></pre>
<p>Include a value in the format <code class="prettyprint">t=MICROSECONDS_SINCE_EPOCH</code> where <code class="prettyprint">MICROSECONDS_SINCE_EPOCH</code> is an integer value of the number of microseconds that have elapsed since the beginning of Unix epoch.</p>

<p><strong>Nearly any front-end HTTP server or load balancer can be configured to add this header.</strong> Some examples are below.</p>

<h3 id="apache">Apache</h3>

<p>Apache&rsquo;s <strong>mod_headers</strong> module includes a <code class="prettyprint">%t</code> variable that is formatted for Scout usage. To enable request queue reporting, add this code to your Apache config:</p>
<pre class="highlight  tab-plaintext"><code>RequestHeader set X-Request-Start "%t"
</code></pre>
<h3 id="haproxy">HAProxy</h3>

<p>HAProxy 1.5+ supports timestamped headers and can be set in the frontend or backend section. We suggest putting this in the frontend to get a more accurate number:</p>
<pre class="highlight  tab-plaintext"><code>http-request set-header X-Request-Start t=%Ts
</code></pre>
<h3 id="nginx">Nginx</h3>

<p>Nginx 1.2.6+ supports the use of the <code class="prettyprint">#{msec}</code> variable. This makes adding the request queuing header straightforward.</p>

<p>General Nginx usage:</p>
<pre class="highlight  tab-plaintext"><code>proxy_set_header X-Request-Start "t=${msec}";
</code></pre>
<p>Passenger 5+:</p>
<pre class="highlight  tab-plaintext"><code>passenger_set_header X_REQUEST_START "t=${msec}";
</code></pre>
<p>Older Passsenger versions:</p>
<pre class="highlight  tab-plaintext"><code>passenger_set_cgi_param X_REQUEST_START "t=${msec}";
</code></pre>
<h2 id="actioncontroller-metal">ActionController::Metal</h2>

<p>Prior to agent version 2.1.26, an extra step was required to instrument <code class="prettyprint">ActionController::Metal</code>
and <span style="white-space: nowrap;"><code class="prettyprint">ActionController::Api</code></span> controllers. After 2.1.26, this is automatic.</p>

<p>The previous instructions which had an explicit <code class="prettyprint">include</code> are no longer
needed, but if that code is still in your controller, it will not harm
anything. It will be ignored by the agent and have no effect.</p>

<h2 id="rack">Rack</h2>

<p>Rack instrumentation is more explicit than Rails instrumentation, since Rack applications can take
nearly any form. After <a href="#ruby_install">installing our agent</a>, instrumenting Rack is a three step process:</p>

<ol>
<li>Configuring the agent</li>
<li>Starting the agent</li>
<li>Wrapping endpoints in tracing</li>
</ol>

<h3 id="rack-config">Configuration</h3>

<p>Rack apps are configured using the same approach as a Rails app: either via a <code class="prettyprint">config/scout_apm.yml</code> config file or environment variables.</p>

<ul>
<li><strong>configuration file</strong>: create a <code class="prettyprint">config/scout_apm.yml</code> file under your application root directory. The file structure is outlined <a href="#ruby-configuration-options">here</a>.</li>
<li><strong>environment variables</strong>: see our docs on configuring the agent via <a href="#ruby-env-vars">environment variables</a>.</li>
</ul>

<h3 id="starting-the-agent">Starting the Agent</h3>

<p>Add the <code class="prettyprint">ScoutApm::Rack.install!</code> startup call as close to the spot you
<code class="prettyprint">run</code> your Rack application as possible.  <span style="white-space: nowrap;"><code class="prettyprint">install!</code></span>
should be called after you require other gems (ActiveRecord, Mongo, etc)
to install instrumentation for those libraries.</p>
<pre class="highlight ruby tab-ruby"><code><span class="c1"># config.ru</span>

<span class="nb">require</span> <span class="s1">'scout_apm'</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">install!</span>

<span class="n">run</span> <span class="no">MyApp</span>
</code></pre>
<h3 id="adding-endpoints">Adding endpoints</h3>

<p>Wrap each endpoint in a call to <code class="prettyprint">ScoutApm::Rack#transaction(name, env)</code>.</p>

<ul>
<li><code class="prettyprint">name</code> - an unchanging string argument for what the endpoint is. Example: <code class="prettyprint">&quot;API User Listing&quot;</code></li>
<li><code class="prettyprint">env</code> - the rack environment hash</li>
</ul>

<p>This may be fairly application specific in details.</p>

<p>Example:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">app</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="s2">"API User Listing"</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">to_json</span>
    <span class="p">[</span><span class="s1">'200'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">},</span> <span class="p">[</span><span class="n">users</span><span class="p">]]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>If you run into any issues, or want advice on naming or wrapping endpoints, contact us at
support@scoutapp.com for additional help.</p>

<h2 id="sinatra">Sinatra</h2>

<p>Instrumenting a Sinatra application is similar to instrumenting a generic <a href="#rack">Rack application</a>.</p>

<h3 id="sinatra-configuration">Configuration</h3>

<p>The agent configuration (API key, app name, etc) follows the same process as the <a href="#rack-config">Rack application config</a>.</p>

<h3 id="sinatra-starting-agent">Starting the agent</h3>

<p>Add the <code class="prettyprint">ScoutApm::Rack.install!</code> startup call as close to the spot you
<code class="prettyprint">run</code> your Sinatra application as possible.  <span style="white-space: nowrap;"><code class="prettyprint">install!</code></span>
should be called <em>after</em> you require other gems (ActiveRecord, Mongo, etc).</p>
<pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'./main'</span>

<span class="nb">require</span> <span class="s1">'scout_apm'</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">install!</span>

<span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</code></pre>
<h3 id="sinatra-transactions">Adding endpoints</h3>

<p>Wrap each endpoint in a call to <code class="prettyprint">ScoutApm::Rack#transaction(name, env)</code>. For example:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="s2">"get /"</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="nf">env</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM pg_catalog.pg_tables"</span><span class="p">)</span>
    <span class="s2">"Hello!"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>See our <a href="#adding-endpoints">Rack docs for adding an endpoint</a> for more details.</p>

<h2 id="ruby-custom-context">Custom Context</h2>

<p><a href="#context">Context</a> lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>It&rsquo;s simple to add <a href="#context">custom context</a> to your app. There are two types of context:</p>

<h3 id="user-context">User Context</h3>

<p>For context used to identify users (ex: email, name):</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">({})</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">(</span><span class="ss">email: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">(</span><span class="ss">email: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">location</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
</code></pre>
<h3 id="general-context">General Context</h3>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">({})</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">account: </span><span class="vi">@account</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">database_shard: </span><span class="vi">@db</span><span class="p">.</span><span class="nf">shard_id</span><span class="p">,</span> <span class="ss">monthly_spend: </span><span class="vi">@account</span><span class="p">.</span><span class="nf">monthly_spend</span><span class="p">)</span>
</code></pre>
<h3 id="default-context">Default Context</h3>

<p>Scout reports the Request URI and the user&rsquo;s remote IP Address by default.</p>

<h3 id="context-types">Context Types</h3>

<p>Context values can be any of the following types:</p>

<ul>
<li>Numeric</li>
<li>String</li>
<li>Boolean</li>
<li>Time</li>
<li>Date</li>
</ul>

<h3 id="context-field-name-restrictions">Context Field Name Restrictions</h3>

<p>Custom context names may contain alphanumeric characters, dashes, and underscores. Spaces are not allowed.</p>

<p>Attempts to add invalid context will be ignored.</p>

<h3 id="example-adding-the-current-users-email-as-context">Example: adding the current user&rsquo;s email as context</h3>

<p>Add the following to your <code class="prettyprint">ApplicationController</code> class:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">before_filter</span> <span class="ss">:set_scout_context</span>
</code></pre>
<p>Create the following method:</p>
<pre class="highlight ruby tab-ruby"><code><span class="k">def</span> <span class="nf">set_scout_context</span>
  <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">(</span><span class="ss">email: </span><span class="n">current_user</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">User</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<h3 id="example-adding-the-monthly-spend-as-context">Example: adding the monthly spend as context</h3>

<p>Add the following line to the <code class="prettyprint">ApplicationController#set_scout_context</code> method defined above:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">monthly_spend: </span><span class="n">current_org</span><span class="p">.</span><span class="nf">monthly_spend</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_org</span>
</code></pre>
<h2 id="ruby-custom-instrumentation">Custom Instrumentation</h2>

<p>Traces that allocate significant amount of time to <code class="prettyprint">Controller</code> or <code class="prettyprint">Job</code> are good candidates to add custom instrumentation. This indicates a significant amount of time is falling outside our default instrumentation.</p>

<h3 id="limits">Limits</h3>

<p>We limit the number of metrics that can be instrumented. Tracking too many unique metrics can impact the performance of our UI. Do not dynamically generate metric types in your instrumentation (ie <code class="prettyprint">self.class.instrument(&quot;user_#{user.id}&quot;, &quot;generate&quot;) { ... })</code> as this can quickly exceed our rate limits.</p>

<h3 id="instrumenting-method-calls">Instrumenting method calls</h3>

<p>To instrument a method call, add the following to the class containing the method:</p>
<pre class="highlight ruby tab-ruby"><code>  <span class="k">class</span> <span class="nc">User</span>
    <span class="kp">include</span> <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Tracer</span>

    <span class="k">def</span> <span class="nf">export_activity</span>
      <span class="c1"># Do export work</span>
    <span class="k">end</span>
    <span class="n">instrument_method</span> <span class="ss">:export_activity</span>
  <span class="k">end</span>
</code></pre>
<p>The call to <code class="prettyprint">instrument_method</code> should be after the method definition.</p>

<h4 id="naming-methods-instrumented-via-instrument_method">Naming methods instrumented via <code class="prettyprint">instrument_method</code></h4>

<p>In the example above, the metric will appear in traces as <code class="prettyprint">User#export_activity</code>. On timeseries charts, the time will be allocated to a <code class="prettyprint">Custom</code> type.</p>

<p><strong>To modify the type</strong>:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">instrument_method</span> <span class="ss">:export_activity</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'Exporting'</span>
</code></pre>
<p>A new <code class="prettyprint">Exporting</code> metric will now appear on charts. The trace item will be displayed as <code class="prettyprint">Exporting/User/export_activity</code>.</p>

<p><strong>To modify the name</strong>:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">instrument_method</span> <span class="ss">:export_activity</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'Exporting'</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'user_activity'</span>
</code></pre>
<p>The trace item will now be displayed as <code class="prettyprint">Exporting/user_activity</code>.</p>

<h3 id="instrumenting-blocks-of-code">Instrumenting blocks of code</h3>

<p>To instrument a method call, add the following:</p>
<pre class="highlight ruby tab-ruby"><code>  <span class="k">class</span> <span class="nc">User</span>
    <span class="kp">include</span> <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Tracer</span>

    <span class="k">def</span> <span class="nf">generate_profile_pic</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">instrument</span><span class="p">(</span><span class="s2">"User"</span><span class="p">,</span> <span class="s2">"generate_profile_pic"</span><span class="p">)</span> <span class="k">do</span>
        <span class="c1"># Do work</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<h4 id="naming-methods-instrumented-via-instrument-type-name">Naming methods instrumented via <code class="prettyprint">instrument(type, name)</code></h4>

<p>In the example above, the metric appear in traces as <code class="prettyprint">User/generate_profile_pic</code>. On timeseries charts, the time will be allocated to a <code class="prettyprint">User</code> type. To modify the type or simply, simply change the <code class="prettyprint">instrument</code> corresponding method arguments.</p>

<h3 id="ruby-testing-instrumentation">Testing instrumentation</h3>

<p>Improper instrumentation can break your application. It&rsquo;s important to test before deploying to production. The easiest way to validate your instrumentation is by running <a href="#devtrace">DevTrace</a> and ensuring the new metric appears as desired.</p>

<p>After restarting your dev server with DevTrace enabled, refresh the browser page and view the trace output. The new metric should appear in the trace:</p>

<p><img src="images/custom_devtrace.png" alt="custom devtrace" /></p>

<h2 id="docker">Docker <img src="images/docker.png" style="float:right;width: 150px" /></h2>

<p>Scout runs within Docker containers without any special configuration.</p>

<p>It&rsquo;s common to configure Docker containers with environment variables. Scout can use <a href="#environment-variables">environment variables</a> instead of the <code class="prettyprint">scout_apm.yml</code> config file.</p>

<h2 id="heroku">Heroku <img src="images/heroku.png" style="float:right;width: 150px" /></h2>

<p>Scout runs on Heroku without any special configuration. When Scout detects that an app is being served via Heroku:</p>

<ul>
<li>Logging is set to <code class="prettyprint">STDOUT</code> vs. logging to a file. Log messages are prefixed with <code class="prettyprint">[Scout]</code> for easy filtering.</li>
<li>The dyno name (ex: <code class="prettyprint">web.1</code>) is reported vs. the dyno hostname. Dyno hostnames are dynamically generated and don&rsquo;t have any meaningful information.</li>
</ul>

<h3 id="configuration">Configuration</h3>

<p>Scout can be configured via environment variables. This means you can use <code class="prettyprint">heroku config:set</code> to configure the agent. For example, you can set the application name that appears in the Scout UI with:</p>
<pre class="highlight shell"><code>heroku config:set <span class="nv">SCOUT_NAME</span><span class="o">=</span><span class="s1">'My Heroku App'</span>
</code></pre>
<p>See the configuration section for more information on the available config settings and environment variable functionality.</p>

<h3 id="using-the-scout-heroku-add-on">Using the Scout Heroku Add-on</h3>

<p>Scout is also available as a <a href="https://elements.heroku.com/addons/scout">Heroku Add-on</a>. The add-on automates setting the proper Heroku config variables during the provisioning process.</p>

<h2 id="cloud-foundry">Cloud Foundry <img src="images/cf_logo.png" style="float:right;width: 150px" /></h2>

<p>Scout runs on Cloud Foundry without any special configuration.</p>

<p>We suggest a few configuration changes in the <code class="prettyprint">scout_apm.yml</code> file to best take advantage of Cloud Foundry:</p>

<ol>
<li>Set <code class="prettyprint">log_file_path: STDOUT</code> to send your the Scout APM log contents to the Loggregator.</li>
<li>Use the application name configured via Cloud Foundry to identify the app.</li>
<li>Override the hostname reported to Scout. Cloud Foundry hostnames are dynamically generated and don&rsquo;t have any meaningful information. We suggest using a combination of the application name and the instance index.</li>
</ol>

<p>A sample config for Cloud Foundry that implements the above suggestions:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">true</span>
  <span class="c1"># use the configured application name to identify the app.</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= ENV['VCAP_APPLICATION'] ? JSON.parse(ENV['VCAP_APPLICATION'])['application_name']</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">APP</span><span class="nv"> </span><span class="s">NAME</span><span class="nv"> </span><span class="s">(#{Rails.env})"</span> <span class="err">%</span><span class="pi">&gt;</span>
  <span class="no"># make logs available to the Loggregator</span>
  <span class="no">log_file_path: STDOUT</span>
  <span class="no"># reports w/a more identifiable instance name using the application name and instance index. ex: rails-sample.0</span>
  <span class="no">hostname: &lt;%= ENV['VCAP_APPLICATION'] ? "#{JSON.parse(ENV['VCAP_APPLICATION'])['application_name']}.#{ENV['CF_INSTANCE_INDEX']}"  : Socket.gethostname %&gt;</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<h2 id="ruby-instrumented-libs">Instrumented Libraries</h2>

<p>The following libraries are currently instrumented:</p>

<ul>
<li>ActiveRecord</li>
<li>ActionView</li>
<li>ActionController</li>
<li>ElasticSearch</li>
<li>HTTPClient</li>
<li>InfluxDB</li>
<li>Mongoid</li>
<li>Net::HTTP</li>
<li>Moped</li>
<li>Middleware</li>
<li>Redis</li>
<li>Sidekiq</li>
<li>DelayedJob</li>
<li>Resque</li>
</ul>

<p>Additionally, <a href="#request-queuing">Scout can also instrument request queuing time</a>.</p>

<p>You can instrument your own code or other libraries via <a href="#ruby-custom-instrumentation">custom instrumentation</a>.</p>

<h2 id="ruby-environments">Environments</h2>

<p>It typically makes sense to treat each environment (production, staging, etc) as a separate application within Scout and ignore the development and test environments. Configure a unique app name for each environment as Scout aggregates data by the app name.</p>

<p>There are 2 approaches:</p>

<h3 id="1-modifying-your-scout_apm-yml-config-file">1. Modifying your scout_apm.yml config file</h3>

<p>Here&rsquo;s an example <code class="prettyprint">scout_apm.yml</code> configuration to achieve this:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "YOUR_APP_NAME (#{Rails.env})" %&gt;</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">true</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<h3 id="2-setting-the-scout_name-environment-variable">2. Setting the SCOUT_NAME environment variable</h3>

<p>Setting the <code class="prettyprint">SCOUT_NAME</code> and <code class="prettyprint">SCOUT_MONITOR</code> environment variables will override settings settings your <code class="prettyprint">scout_apm.yml</code> config file.</p>

<p>To isolate data for a staging environment: <code class="prettyprint">SCOUT_NAME=&quot;YOUR_APP_NAME (Staging)&quot;</code>.</p>

<p>To disable monitoring: <code class="prettyprint">SCOUT_MONITOR=false</code>.</p>

<p>See the full list of <a href="#ruby-configuration-options">configuration options</a>.</p>

<h2 id="disabling-a-node">Disabling a Node</h2>

<p>To disable Scout APM on any node in your environment, just set <code class="prettyprint">monitor: false</code> in your <code class="prettyprint">scout_apm.yml</code> configuration file on that server, and restart your app server. Example:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "YOUR_APP_NAME (#{Rails.env})" %&gt;</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<p>Since the YAML config file allows ERB evaluation, you can even programatically enable/disable nodes based on host name. This example enables Scout APM on web1 through web5:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "YOUR_APP_NAME (#{Rails.env})" %&gt;</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">&lt;%= Socket.gethostname.match(/web[1..5]/) %&gt;</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<p>Aft you&rsquo;ve disabled a node in your configuration file and restarted your app server, the node show up as inactive in the UI after 10 minutes.</p>

<h2 id="ignoring-transactions">Ignoring transactions</h2>

<p>There are a couple of approaches to ignore web requests and background jobs you don&rsquo;t care to instrument. These approaches are listed below.</p>

<h3 id="by-the-web-endpoint-path-name">By the web endpoint path name</h3>

<p>You can ignore requests to web endpoints that match specific paths (like <code class="prettyprint">/health_check</code>). See the <code class="prettyprint">ignore</code> setting in the <a href="#ruby-configuration-options">configuration options</a>.</p>

<h3 id="in-your-code">In your code</h3>

<p>To selectively ignore a web request or background job in your code, add the following within the transaction:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">req</span> <span class="o">=</span> <span class="no">ScoutApm</span><span class="o">::</span><span class="no">RequestManager</span><span class="p">.</span><span class="nf">lookup</span>
<span class="n">req</span><span class="p">.</span><span class="nf">ignore_request!</span>
</code></pre>
<h3 id="ignoring-all-background-jobs">Ignoring all background jobs</h3>

<p>You can ignore all background jobs by setting <code class="prettyprint">enable_background_jobs: false</code> in your configuration file. See the <a href="#ruby-configuration-options">configuration options</a>.</p>

          <h1 id="elixir-agent">Elixir Agent</h1>

<aside class="warning">
Elixir support is in BETA.
</aside>

<h2 id="elixir-requirements">Requirements</h2>

<p>Our Elixir agent supports Phoenix 1.2.0+ and Elixir 1.4+.</p>

<!-- old unique-ified anchor link -->

<p><a name="installation22"></a>
<h2 id="elixir-install">Installation</h2></p>

<aside class="notice">
  A free Scout account is required. <a href="https://apm.scoutapp.com/users/sign_up" target: '_blank'>Signup here</a>.
</aside>

<p>Tailored instructions are provided within our user interface. General instructions:</p>

<div class="install">

 <p class="instruct">
      <span class="step">A</span>Add the <code>scout_apm</code> dependency.
    </p>
    <p class="smaller">Your <code>mix.exs</code> file:
    </p>
    <pre class="terminal"># mix.exs

 def application do
   [mod: {YourApp, []},
    applications: [..., <span>:scout_apm</span>]]
 end

 def deps do
   [{:phoenix, "~> 1.2.0"},
    ...
    <span>{:scout_apm, "~> 0.0"}</span>]
 end</pre>
    <p class="smaller">
      Shell:
    </p>
    <div class="terminal">
      mix deps.get
    </div>
    <p class="instruct">
      <span class="step">B</span><span class="glyphicon glyphicon-download"></span> Download your customized config file, placing it at <code>config/scout_apm.exs</code>.
    </p>
    <p class="smaller">Your customized config file is available within your Scout account. Inside the file, replace <code>"YourApp"</code> with the app name you&rsquo;d like to appear within Scout.
    </p>
    <p class="instruct">
      <span class="step">C</span>Integrate into your Phoenix app.
    </p>
    <p class="smaller"><code>config/config.exs</code>:
    </p>
    <pre class="terminal">
# config/config.exs
import_config "scout_apm.exs"

config :your_app, YourApp.Repo,
  loggers: [{Ecto.LogEntry, :log, []},
            <span>{ScoutApm.Instruments.EctoLogger, :log, []}</span>]</pre>
    <p class="smaller"><code>web/web.ex</code>:
    </p>
    <pre class="terminal"># web/web.ex
defmodule HeroReview.Web do
  def controller do
    quote do
      use Phoenix.Controller
      <span>use ScoutApm.Instrumentation</span>
      ...</pre>

    <p class="instruct">
      <span class="step">D</span>Restart your app.
      <div class="terminal">
        mix phoenix.server
      </div>
    </p>

</div>

<h2 id="elixir-troubleshooting">Troubleshooting</h2>

<p>Not seeing data? <a href="mailto:support@scoutapp.com">Send us an email</a> with the following:</p>

<ul>
<li>A recent sample of your log file (the more, the better).</li>
<li>Your application&rsquo;s <code class="prettyprint">mix.lock</code> file.</li>
</ul>

<p>We typically respond within a couple of hours during the business day.</p>

<h2 id="elixir-configuration">Configuration</h2>

<p>The Elixir agent can be configured via the <code class="prettyprint">config/scout_apm.exs</code> file. A config file with your organization key is available for download as part of the install instructions. A application name and key is required:</p>
<pre class="highlight  tab-plaintext"><code>config :scout_apm,
  name: "Your App", # The app name that will appear within the Scout UI
  key: "YOUR SCOUT KEY"
</code></pre>
<h3 id="configuration-reference">Configuration Reference</h3>

<p>The following configuration settings are available:</p>

<table class="lookup">
  <thead>
    <tr>
      <th>
        Setting&nbsp;Name
      </th>
      <th>
        Description
      </th>
      <th>
        Default
      </th>
      <th>
        Required
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>
        name
      </th>
      <td>
        Name of the application (ex: &lsquo;Photos App&rsquo;).
      </td>
      <td>       
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        monitor
      </th>
      <td>
        Whether monitoring data should be reported.
      </td>
      <td>
        <code>true</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        key
      </th>
      <td>
        The organization API key.
      </td>
      <td></td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        dev_trace
      </th>
      <td>
        Indicates if DevTrace, the Scout development profiler, should be enabled.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        host
      </th>
      <td>
        The protocol + domain where the agent should report.
      </td>
      <td>
        <code>https://apm.scoutapp.com</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        log_level
      </th>
      <td>
        The logging level of the agent. Possible values: <code>:debug</code>, <code>:info</code>, <code>:warn</code>, and <code>:error</code>.
      </td>
      <td>
        <code>:info</code>
      </td>
      <td>
        No
      </td>
    </tr>
  </tbody>
</table>

<h2 id="elixir-upgrade">Updating to the Newest Version</h2>

<div class="install">

 <p class="instruct">
  <span class="step">A</span>Ensure your <code>mix.exs</code> dependency entry for <code>scout_apm</code> is: <code>{:scout_apm, "~> 0.0"}`</code>
 </p>

 <p class="instruct">
  <span class="step">B</span><span class="terminal">mix deps.get scout_apm</span>
 </p>

  <p class="instruct">
    <span class="step">C</span>Recompile and deploy.
 </p>


</div>

<h2 id="elixir-instrumented-libaries">Auto-Instrumented Libraries</h2>

<p>Our <a href="#elixir-install">install instructions</a> walk through instrumenting the following libraries:</p>

<ul>
<li>Phoenix

<ul>
<li>controllers</li>
<li>views</li>
<li>templates</li>
</ul></li>
<li>Ecto 2.0</li>
</ul>

<p>See <a href="/#instrumenting-common-libraries">instrumenting common librariess</a> for guides on instrumenting other Elixir libraries.</p>

<h2 id="instrumenting-common-libraries">Instrumenting Common Libraries</h2>

<p>We&rsquo;ve collected best practices for instrumenting common transactions and timing functions below. If you have a suggestion, <a href="mailto:support@scoutapp.com">please share it</a>. See our <a href="#elixir-custom-instrumentation">custom instrumentation quickstart</a> for more details on adding instrumentation.</p>

<ul>
<li>Transactions

<ul>
<li><a href="#phoenix-channels">Phoenix Channels</a></li>
<li><a href="#genserver-calls">GenServer calls</a></li>
<li><a href="#task-start">Task.start</a></li>
<li><a href="#task-supervisor-start_child">Task.Supervisor.start_child</a></li>
<li><a href="#exq">Exq</a></li>
<li><a href="#absinthe">Absinthe (GraphQL)</a></li>
</ul></li>
<li>Timing

<ul>
<li><a href="#httpoison">HTTPoison</a></li>
<li><a href="#mongodb-ecto">MongoDB Ecto</a></li>
</ul></li>
</ul>

<h3 id="phoenix-channels">Phoenix Channels</h3>

<h4 id="web-or-background-transactions">Web or background transactions?</h4>

<ul>
<li><strong>web</strong>: For channel-related functions that impact the user-facing experience. Time spent in these transactions will appear on your app overboard dashboard and appear in the &ldquo;Web&rdquo; area of the UI.</li>
<li><strong>background</strong>: For functions that don&rsquo;t have an impact on the user-facing experience (example: click-tracking). These will be available in the &ldquo;Background Jobs&rdquo; area of the UI.</li>
</ul>

<h4 id="naming-channel-transactions">Naming channel transactions</h4>

<p>Provide an identifiable name based on the message the <code class="prettyprint">handle_out/</code> or <code class="prettyprint">handle_in/</code> function receives.</p>

<p>An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">FirestormWeb</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">PostsChannel</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">FirestormWeb</span><span class="o">.</span><span class="no">Web</span><span class="p">,</span> <span class="ss">:channel</span>
  <span class="kn">use</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Web" in the UI, named "PostsChannel.update"</span>
  <span class="nv">@transaction</span><span class="p">(</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">web"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">PostsChannel.update"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">handle_out</span><span class="p">(</span><span class="sd">"</span><span class="s2">update"</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">push</span> <span class="n">socket</span><span class="p">,</span> <span class="sd">"</span><span class="s2">update"</span><span class="p">,</span> <span class="no">FetchView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="sd">"</span><span class="s2">index.json"</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<h3 id="genserver-calls">GenServer calls</h3>

<p>It&rsquo;s common to use <code class="prettyprint">GenServer</code> to handle background work outside the web request flow. Suggestions:</p>

<ul>
<li>Treat these as <code class="prettyprint">background</code> transactions</li>
<li>Provide a <code class="prettyprint">name</code> based on the message each <code class="prettyprint">handle_call/</code> function handles.</li>
</ul>

<p>An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Flight</span><span class="o">.</span><span class="no">Checker</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenServer</span>
  <span class="kn">use</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Background Jobs" in the UI, named "Flight.handle_check".</span>
  <span class="nv">@transaction</span><span class="p">(</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">background"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">check"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:check</span><span class="p">,</span> <span class="n">flight</span><span class="p">},</span> <span class="n">_from</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># Do work...</span>
  <span class="k">end</span>
</code></pre>
<h3 id="task-start">Task.start</h3>

<p>These execute asynchronously, so treat as a <code class="prettyprint">background</code> transaction.</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">Task</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="c1"># Will appear under "Background Jobs" in the UI, named "Crawler.crawl".</span>
  <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="ss">:background</span><span class="p">,</span><span class="sd">"</span><span class="s2">Crawler.crawl"</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Crawler</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
<h3 id="task-supervisor-start_child">Task.Supervisor.start_child</h3>

<p>Like <code class="prettyprint">Task.start</code>, these execute asynchronously, so treat as a <code class="prettyprint">background</code> transaction.</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">YourApp</span><span class="o">.</span><span class="no">TaskSupervisor</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="c1"># Will appear under "Background Jobs" in the UI, named "Crawler.crawl".</span>
  <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="ss">:background</span><span class="p">,</span><span class="sd">"</span><span class="s2">Crawler.crawl"</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Crawler</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
<h3 id="exq">Exq</h3>

<p>To instrument <a href="https://github.com/akira/exq">Exq</a> background jobs, <code class="prettyprint">use ScoutApm.Tracing</code>, and add a <code class="prettyprint">@transaction</code> module attribute to each worker&rsquo;s <code class="prettyprint">perform</code> function:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">MyWorker</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Background Jobs" in the UI, named "MyWorker.perform".</span>
  <span class="nv">@transaction</span><span class="p">(</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">background"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">perform</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># do work</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="absinthe">Absinthe</h3>

<p>Requests to the Absinthe plug can be grouped by the GraphQL <code class="prettyprint">operationName</code> under the &ldquo;Web&rdquo; UI by adding <a href="https://gist.github.com/itsderek23/d9435b21c9a44cd9629e93c4e8c2750e" target="_blank">this plug</a> to your pipeline.  </p>

<h3 id="httpoison">HTTPoison</h3>

<p>Download this <a href="https://gist.github.com/itsderek23/50296b49df16b266e47cc04d227d4b4a" target="_blank">ScoutApm.HTTPoison module</a> into your app&rsquo;s <code class="prettyprint">/lib</code> folder, then <code class="prettyprint">alias ScoutApm.HTTPoison</code> when calling <code class="prettyprint">HTTPoison</code> functions:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Demo</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">PageController</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Demo</span><span class="o">.</span><span class="no">Web</span><span class="p">,</span> <span class="ss">:controller</span>
  <span class="c1"># Will route function calls to `HTTPoision` through `ScoutApm.HTTPoison`, which times the execution of the HTTP call.</span>
  <span class="n">alias</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">HTTPoison</span>

  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># "HTTP" will appear on timeseries charts. "HTTP/get" and the url "https://cnn.com" will appear in traces.</span>
    <span class="no">HTTPoison</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sd">"</span><span class="s2">https://cnn.com"</span><span class="p">)</span>
    <span class="n">render</span> <span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">index.html"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="mongodb-ecto">MongoDB Ecto</h3>

<p>Download <a href="https://gist.github.com/itsderek23/051327a152bc4d95451fd76808b8e83f" target="_blank">this example MongoDB Repo module</a> to use inplace of your existing MongoDB Repo module.</p>

<h2 id="elixir-custom-instrumentation">Custom Instrumentation</h2>

<p>You can extend Scout to record additional types of transactions (background jobs, for example) and time the execution of code that fall outside our custom instrumentation.</p>

<p>For full details on instrumentation functions, see our <a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html" target="_blank">ScoutApm.Tracing Hex docs</a>.</p>

<h3 id="transactions-timing">Transactions &amp; Timing</h3>

<p>Scouts instrumentation is divided into 2 areas:</p>

<ol>
<li><strong>Transactions</strong>: these wrap around a flow of work, like a web request or a GenServer call. The UI groups data under transactions. Use <code class="prettyprint">@transaction</code> module attributes and the <code class="prettyprint">transaction/4</code> macro.</li>
<li><strong>Timing</strong>: these measure individual pieces of work, like an HTTP request to an outside service or an Ecto query. Use <code class="prettyprint">@timing</code> module attributes and the <code class="prettyprint">timing/4</code> macro.</li>
</ol>

<h3 id="instrumenting-transactions">Instrumenting transactions</h3>

<p>Via <code class="prettyprint">@transaction</code> module attributes:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">YourApp</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">RoomChannel</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">Channel</span>
  <span class="kn">use</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Web" in the UI, named "YourApp.Web.RoomChannel.join".</span>
  <span class="nv">@transaction</span><span class="p">(</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">web"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="sd">"</span><span class="s2">topic:html"</span><span class="p">,</span> <span class="n">_message</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># Will appear under "Background Jobs" in the UI, named "RoomChannel.ping".</span>
  <span class="nv">@transaction</span><span class="p">(</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">background"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">RoomChannel.ping"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">handle_in</span><span class="p">(</span><span class="sd">"</span><span class="s2">ping"</span><span class="p">,</span> <span class="p">%{</span><span class="sd">"</span><span class="s2">body"</span> <span class="o">=&gt;</span> <span class="n">body</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">broadcast!</span> <span class="n">socket</span><span class="p">,</span> <span class="sd">"</span><span class="s2">new_msg"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">body:</span> <span class="n">body</span><span class="p">}</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
</code></pre>
<p>Via <code class="prettyprint">transaction/4</code>:</p>
<pre class="highlight elixir tab-elixir"><code><span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracking</span>

<span class="k">def</span> <span class="n">do_async_work</span> <span class="k">do</span>
  <span class="no">Task</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
    <span class="c1"># Will appear under "Background Jobs" in the UI, named "Do Work".</span>
    <span class="n">transaction</span><span class="p">(</span><span class="ss">:background</span><span class="p">,</span> <span class="sd">"</span><span class="s2">Do Work"</span><span class="p">)</span> <span class="k">do</span>
      <span class="c1"># Do work...</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<p>See the <a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html" target="_blank">ScoutApm.Tracing Hexdocs</a> for details on instrumenting transactions.</p>

<h3 id="timing-functions-and-blocks-of-code">Timing functions and blocks of code</h3>

<p>Via <code class="prettyprint">@timing</code> module attributes:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Searcher</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Time associated with this function will appear under "Hound" in timeseries charts.</span>
  <span class="c1"># The function will appear as `Hound/open_search` in transaction traces.</span>
  <span class="nv">@timing</span><span class="p">(</span><span class="ss">category:</span> <span class="sd">"</span><span class="s2">Hound"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">open_search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">navigate_to</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Time associated with this function will appear under "Hound" in timeseries charts.</span>
  <span class="c1"># The function will appear as `Hound/homepage` in transaction traces.</span>
  <span class="nv">@timing</span><span class="p">(</span><span class="ss">category:</span> <span class="sd">"</span><span class="s2">Hound"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">homepage"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">open_homepage</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">navigate_to</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<p>Via <code class="prettyprint">timing/4</code>:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">PhoenixApp</span><span class="o">.</span><span class="no">PageController</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">PhoenixApp</span><span class="o">.</span><span class="no">Web</span><span class="p">,</span> <span class="ss">:controller</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">timing</span><span class="p">(</span><span class="sd">"</span><span class="s2">Timer"</span><span class="p">,</span> <span class="sd">"</span><span class="s2">sleep"</span><span class="p">)</span> <span class="k">do</span>
      <span class="ss">:timer</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="m">3000</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">render</span> <span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">index.html"</span>
  <span class="k">end</span>
</code></pre>
<p>See the <a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html" target="_blank">ScoutApm.Tracing Hexdocs</a> for details on timing functions and blocks of code.</p>

<h4 id="limits-on-category-arity">Limits on category arity</h4>

<p>We limit the number of unique categories that can be instrumented. Tracking too many unique category can impact the performance of our UI. Do not dynamically generate categories in your instrumentation (ie <code class="prettyprint">timing(&quot;user_#{user.id}&quot;, &quot;generate&quot;, do: do_work())</code> as this can quickly exceed our rate limits.</p>

<h4 id="adding-a-description">Adding a description</h4>

<p>Call <code class="prettyprint">ScoutApm.Tracing.update_desc/1</code> to add relevant information to the instrumented item. This description is then viewable in traces. An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="n">timing</span><span class="p">(</span><span class="sd">"</span><span class="s2">HTTP"</span><span class="p">,</span> <span class="sd">"</span><span class="s2">GitHub_Avatar"</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">url</span> <span class="o">=</span> <span class="sd">"</span><span class="s2">https://github.com/</span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.png"</span>
  <span class="n">update_desc</span><span class="p">(</span><span class="sd">"</span><span class="s2">GET </span><span class="si">#{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="no">HTTPoison</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<h4 id="tracking-already-executed-time">Tracking already executed time</h4>

<p>Libraries like Ecto log details on executed queries. This includes timing information. To add a trace item for this, use <code class="prettyprint">ScoutApm.Tracing.track</code>. An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">YourApp</span><span class="o">.</span><span class="no">Mongo</span><span class="o">.</span><span class="no">Repo</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Repo</span>

  <span class="c1"># Scout instrumentation of Mongo queries. These appear in traces as "Ecto/Read", "Ecto/Write", etc.</span>
  <span class="k">def</span> <span class="n">log</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
      <span class="sd">"</span><span class="s2">Ecto"</span><span class="p">,</span>
      <span class="n">query_name</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span>
      <span class="n">entry</span><span class="o">.</span><span class="n">query_time</span><span class="p">,</span>
      <span class="ss">:microseconds</span>
    <span class="p">)</span>
    <span class="kn">super</span> <span class="n">entry</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre>
<p>In the example above, the metric will appear in traces as <code class="prettyprint">Ecto/#{query_time(entry)}</code>. On timeseries charts, the time will be allocated to <code class="prettyprint">Ecto</code>.</p>

<p><a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html#track/5" target="_blank">See the scout_apm hex docs</a> for more information on <code class="prettyprint">track/</code>.</p>

<h3 id="elixir-testing-instrumentation">Testing instrumentation</h3>

<p>Improper instrumentation can break your application. It&rsquo;s important to test before deploying to production. The easiest way to validate your instrumentation is by running <a href="#elixir-devtrace">DevTrace</a> and ensuring the new metric appears as desired.</p>

<p>After restarting your app with DevTrace enabled, refresh the browser page and view the trace output. The new metric should appear in the trace.</p>

<h2 id="elixir-custom-context">Custom Context</h2>

<p><a href="#context">Context</a> lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>It&rsquo;s simple to add <a href="#context">custom context</a> to your app. There are two types of context:</p>

<h3 id="user-context">User Context</h3>

<p>For context used to identify users (ex: email, name):</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre>
<h3 id="general-context">General Context</h3>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:account</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:monthly_spend</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">monthly_spend</span><span class="p">)</span>
</code></pre>
<h3 id="default-context">Default Context</h3>

<p>Scout reports the Request URI and the user&rsquo;s remote IP Address by default.</p>

<h3 id="context-value-types">Context Value Types</h3>

<p>Context values can be any of the following types:</p>

<ul>
<li>Printable strings (<code class="prettyprint">String/printable?/1</code> returns <code class="prettyprint">true</code>)</li>
<li>Boolean</li>
<li>Number</li>
</ul>

<h3 id="context-key-restrictions">Context Key Restrictions</h3>

<p>Context keys can be an <code class="prettyprint">Atom</code> or <code class="prettyprint">String</code> with only printable characters. Custom context keys may contain alphanumeric characters, dashes, and underscores. Spaces are not allowed.</p>

<p>Attempts to add invalid context will be ignored.</p>

<h2 id="elixir-environments">Environments</h2>

<p>It typically makes sense to treat each environment (production, staging, etc) as a separate application within Scout. To do so, configure a unique app name for each environment. Scout aggregates data by the app name.</p>

<p>An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="c1"># config/staging.exs</span>

<span class="n">config</span> <span class="ss">:scout_apm</span><span class="p">,</span>
  <span class="ss">name:</span> <span class="sd">"</span><span class="s2">YOUR APP - Staging"</span>
</code></pre>
<!-- old reference -->

<p><a name="enabling-devtrace30"></a>
<h2 id="elixir-devtrace">Enabling DevTrace</h2></p>

<aside class="notice" style="font-size: 12px">
Follow the <a href="#elixir-install">install instructions</a> first. There&rsquo;s no need to download the config file as signup isn&rsquo;t required.
</aside>

<p>To enable <a href="#devtrace">DevTrace</a>, our in-browser profiler:</p>

<table class="help install">
  <tbody>
    <tr>
      <td><span class="step">1</span></td>
      <td>
        <p style="line-height: 170%">
          Add <code>dev_trace: true</code> to the <code>scout_apm</code> section of your <code>config/dev.exs</code>  file:
        </p>
<pre>
# config/dev.exs
config :scout_apm,
  dev_trace: true
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="vertical-align: middle">
        <p style="line-height: initial">Restart your app.</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td style="vertical-align: middle">
        <p style="line-height: initial">Refresh your browser window and look for the speed badge.</p>
      </td>
    </tr>
  </tbody>
</table>

          <h1 id="api">API</h1>

<h2 id="introduction">Introduction</h2>

<p>The ScoutAPM API is currently fairly narrow in scope. It is intended to
support 3rd party dashboards, exporting summary data from your applications.</p>

<p>If you have ideas on API enhancements, please contact us at support@scoutapp.com</p>

<h2 id="authorization">Authorization</h2>

<h3 id="obtaining-a-token">Obtaining a token</h3>

<ol>
<li>Log into the ScoutAPM website</li>
<li>Go to your organization&rsquo;s settings</li>
<li>Enter a name (for your use), and obtain a token</li>
</ol>

<h3 id="sending-authorization">Sending Authorization</h3>

<p>The key must be provided with every request, via one of several methods:</p>

<ul>
<li>An HTTP Header named <code class="prettyprint">X-SCOUT-API</code></li>
<li>As part of the JSON request body, as the top level key: <code class="prettyprint">key</code></li>
<li>A URL query string argument named <code class="prettyprint">key</code></li>
</ul>

<h3 id="response-format">Response Format</h3>

<p>Every endpoint returns a JSON object. The object will at the minimum,
have a <code class="prettyprint">&quot;header&quot;</code> field with embedded status and message fields. If the
endpoint returned results, it will be under a results keys.</p>
<pre class="highlight  tab-plaintext"><code>{
  "header": {
    "status": {
      "code": 200,
      "message": "OK"
    },
    "apiVersion": "0.1"
  },
  "results": { ... }
}
</code></pre>
<h2 id="api-endpoints">API Endpoints</h2>

<h3 id="applications">Applications</h3>

<h4 id="applications-list">Applications List</h4>

<p><code class="prettyprint">/api/v0/apps</code> - returns a list of applications and their ids</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  "apps": [
    {
      "name": "MyApp Staging",
      "id": 100
    },
    {
      "name": "MyApp Production",
      "id": 101
    }
}
</code></pre>
<h4 id="application-detail">Application Detail</h4>

<p><code class="prettyprint">/api/v0/apps/:id</code> - returns information about a specific application</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  "app": {
    "id": 101,
    "name": "MyApp Production"
  }
}
</code></pre>
<h3 id="metrics">Metrics</h3>

<h4 id="known-metric-list">Known Metric List</h4>

<p><code class="prettyprint">/api/v0/apps/:id/metrics</code> returns a list of known metric types</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  availableMetrics": [
    "response_time",
    "errors",
    "throughput"
  ]
}
</code></pre>
<h4 id="metric-data">Metric Data</h4>

<p><code class="prettyprint">/api/v0/apps/:id/metrics/:metric_type</code> - will return a time series dataset for the metric.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li><strong>from</strong> - start time, ISO8601 formatted</li>
<li><strong>to</strong> - end time, ISO8601 formatted</li>
</ul>

<p>These two times must not be more than 2 weeks apart</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  series": {
    "response_time": [
      [
        "2016-05-16T22:00:00Z",
        90.33333333333333
      ],
      [
        "2016-05-16T22:01:00Z",
        86.87233333333333
      ]
    ]
  }
}
</code></pre>
          <h1 id="features">Features</h1>

<p>Scout is Application Monitoring built for modern development teams. It&rsquo;s built to provide the fastest path to a slow line-of-code. <a href="https://apm.scoutapp.com/users/sign_up">Signup for a free trial</a>.</p>

<h2 id="app-performance-overview">App Performance Overview</h2>

<p>The overview page provides an at-a-glance, auto-refreshing view of your app&rsquo;s performance and resource usage (mean response time by category, 95th percentile response time, throughput, error rate, and more). You can quickly dive into endpoint activity via click-and-drag (or pinch-and-expand with a mobile device) on the overview chart.</p>

<p><img src="images/app_show.gif" alt="overview" /></p>

<p>Additionally, you can compare metrics in the overview chart and see how your app&rsquo;s performance compares to different time periods.</p>

<h2 id="endpoint-details">Endpoint Details</h2>

<p>You can view metrics for specific controller-action and background job workers. There is a similar chart interaction to the App Performance Overview page, with one difference: your selection will render an updated list of transaction traces that correspond to the selected time period:
<img src="images/endpoint_show.gif" alt="stream" /></p>

<p>You can sort traces by response time, object allocations, date, and more.</p>

<h2 id="transaction-traces">Transaction Traces</h2>

<p>Scout collects detailed transactions across your endpoints automatically. The transaction traces provide a number of visual queues to direct you to hotspots. Dig into bottlenecks - down to the line-of-code, author, commit date, and deploy time - from this view. </p>

<p><img src="images/transaction_traces.png" alt="transaction traces" /></p>

<h3 id="call-breakdown">Call Breakdown</h3>

<p>Method calls are aggregated together and listed from most expensive to least expensive. The time displayed is the total time across all calls (not the time per-call).</p>

<p><img src="images/stream_show_call_breakdown.png" alt="stream show breakdown" /></p>

<h3 id="sql-queries">SQL Queries</h3>

<p>Scout captures a sanitized version of SQL queries. Click the &ldquo;SQL&rdquo; button next to a call to view details. </p>

<p><img src="images/stream_show_sql_annotated.png" alt="stream show sql" /></p>

<h4 id="dont-see-the-query-next-to-an-sql-call">Don&rsquo;t see the query next to an SQL call?</h4>

<p>For performance reasons, Scout doesn&rsquo;t attempt to sanitize large SQL queries. When this occurs, you won&rsquo;t see an &ldquo;SQL&rdquo; button to view the raw query next to an SQL method call.</p>

<h3 id="code-backtraces">Code Backtraces</h3>

<p>You&rsquo;ll see &ldquo;CODE&rdquo; buttons next to method calls that are &gt;= 500 ms. If you&rsquo;ve enabled the GitHub integration, you can see the line-of-code, associated SQL or HTTP endpoint (if applicable), author, commit date, and deploy time for the relevant slow code.</p>

<p><img src="images/stream_slow_git_annotated.png" alt="stream show git" /></p>

<p>If you don&rsquo;t enable the GitHub integration, you&rsquo;ll see a backtrace.</p>

<h2 id="scoutprof">ScoutProf</h2>

<p>Every millisecond, ScoutProf captures a backtrace of what each thread in your application is currently running.  Over many backtraces, when you combine them, it tells a story of what code paths are taking up the most time in your application.</p>

<p>Compared with our more traditional instrumentation of libraries like <code class="prettyprint">ActiveRecord</code>, <code class="prettyprint">Net::HTTP</code> and similar, ScoutProf works with your custom code.  Now, when your application spends time processing your data in custom application code, or in libraries that Scout doesn&rsquo;t yet instrument, instead of only being able to assign that to a large bucket of <code class="prettyprint">ActionController</code> time, the time can be broken down to exactly what is taking up the most time.</p>

<p>Notice how the time in <code class="prettyprint">ActionController</code> is broken down:</p>

<p><a href="images/scoutprof.png" target="_blank"><img src="images/scoutprof.png" alt="scoutprof" /></a></p>

<p>We still employ our traditional instrumentation, because it can give us deeper insights into common libraries, capturing the SQL being run, or the URL being fetched.</p>

<h3 id="enabling-scoutprof">Enabling ScoutProf</h3>

<p>ScoutProf is a BETA feature. To enable:</p>

<table class="help install">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Modify your <code>Gemfile</code> entry for <code>scout_apm</code>, changing it to: <code>gem 'scout_apm', '~> 3.0.x'</code></p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td><p><code>bundle update scout_apm</code></p></td>
    </tr>
      <tr>
      <td><span class="step">3</span></td>
      <td><p>Deploy</p></td>
    </tr>
  </tbody>
</table>

<p>A <a href="#scoutprof-faq">detailed ScoutProf FAQ</a> is available in our reference area.</p>

<h2 id="database-monitoring">Database Monitoring</h2>

<p>A database is shared resource: one expensive query can trigger a flood of slow queries that impact many web endpoints and background jobs. Scout&rsquo;s database monitoring helps in three primary areas:</p>

<ol>
<li>Identifying the cause of database capacity issues.</li>
<li>Understanding your query workload and which web endpoints and background jobs are the greatest users of database time.</li>
<li>Highlighting changes in query workload and performance metrics vs. the norm.</li>
</ol>

<p>Database metrics appear in two areas of the UI:</p>

<ol>
<li><a href="#database-overview">Database Overview</a></li>
<li><a href="#endpoint-database-breakdown">Web Endpoint &amp; Background Job Breakdown</a></li>
</ol>

<h3 id="database-overview">Database Overview</h3>

<p><img src="images/db_monitoring.png" alt="database monitoring" /></p>

<h4 id="overview-chart">Overview chart</h4>

<p>The database monitoring overview chart helps answer important questions at-a-glance. For example:</p>

<ul>
<li>Is time consumed by queries increasing because throughput is increasing?</li>
<li>Is one type of query showing a dramatic increase in time consumed?</li>
<li>How are query response times changing under load?</li>
</ul>

<p>The overview chart shows the top 4 most time-consuming queries and an aggregate of all other queries vs. overall query throughput.</p>

<h4 id="zooming">Zooming</h4>

<p>The primary interaction point of Scout&rsquo;s database monitoring is the zoom functionality.</p>

<p>If you notice a spike in time spent by database queries, simply click and drag on the overview chart. The queries list will update, showing changes during the zoom window. </p>

<p>Annotations are added to the queries list when zooming:</p>

<ul>
<li>The change in rank, based on % time consumed, of each query. Queries that jump significantly in rank may trigger a dramatic change in database performance.</li>
<li>The % change across metrics in the zoom window vs. the larger timeframe. If the % change is not significant, the metric is faded.</li>
<li>A bullseye appears next to the max query time if the slowest occurrence of this query was executed during the zoom window. This may indicate a single slow query triggered a problem.</li>
</ul>

<h4 id="queries-list">Queries List</h4>

<p>A list of queries, broken down by their ActiveRecord model, operation, and caller (either a web endpoint or background job) is listed below the overview chart.</p>

<p>By default, this list is truncated to display just the most time-consuming queries.</p>

<h4 id="database-events">Database Events</h4>

<p>Scout highlights significant events in database performance in the sidebar. For example, if time spent in database queries increases dramatically, you&rsquo;ll find an insight here. Clicking on an insight jumps to the time window referenced by the insight.</p>

<h3 id="endpoint-database-breakdown">Endpoint Database Breakdown</h3>

<p>A breakdown of time spent per-transaction appears beneath the overview chart for both web endpoints and database metrics. Database queries are broken out in this breakdown:</p>

<p><img src="images/db_monitoring_endpoint.png" alt="database breakdown" /></p>

<h3 id="pricing">Pricing</h3>

<p>Database Monitoring is available as an addon. See your billing page for pricing information.</p>

<h3 id="database-monitoring-library-support">Database Monitoring Library Support</h3>

<p>Scout currently monitors queries executed via ActiveRecord, which includes most relational databases (PostgreSQL, MySQL, etc).</p>

<h2 id="memory-bloat-detection">Memory Bloat Detection</h2>

<p>If a user triggers a request to your Rails application that results in a large number of object allocations (example: loading a large number of ActiveRecord objects), your app may require additional memory. The additional memory required to load the objects in memory is released back very slowly. Therefore, a single memory-hungry request will have a long-term impact on your Rails app&rsquo;s memory usage.</p>

<p>There are 3 specific features of Scout to aid in fixing memory bloat.</p>

<h3 id="memory-bloat-insights">Memory Bloat Insights</h3>

<p>The Insights area of the dashboard identifies controller-actions and background jobs that have triggered significant memory increases. An overview of the object allocation breakdown by tier (ActiveRecord, ActionView, etc) is displayed on the dashboard.</p>

<p><img src="images/memory_insights.png" alt="memory insights" /></p>

<h3 id="memory-traces">Memory Traces</h3>

<p>When inspecting a <a href="#transaction-traces">transaction trace</a>, you&rsquo;ll see a &ldquo;Memory Allocation Breakdown&rdquo; section:</p>

<p><img src="images/memory_trace.png" alt="memory trace" /></p>

<p>For perspective, we display how this trace&rsquo;s allocations compare to the norm.</p>

<h2 id="alerting">Alerting</h2>

<p><img src="images/alerts_chart.png" alt="alerts_chart" /></p>

<p>Alerting keeps your team updated if your app&rsquo;s performance degrades. Alerts can be configured on the app as a whole and on individual endpoints. Metrics include:</p>

<ul>
<li>mean response time</li>
<li>95th percentile response time</li>
<li>Apdex</li>
<li>error rate</li>
<li>throughput</li>
</ul>

<h3 id="alert-conditions">Alert conditions</h3>

<p>Configure alert conditions via the &ldquo;Alerts&rdquo; pill in the UI:</p>

<p><img src="images/alert_conditions.png" alt="alert_conditions" /></p>

<h3 id="notification-groups">Notification groups</h3>

<p>Alerts are sent to a notification group, which is composed of notification channels. You can configure these under your org&rsquo;s settings menu:</p>

<p><img src="images/alert_notification_groups.png" alt="alert notification groups" /></p>

<h2 id="deploy-tracking">Deploy Tracking</h2>

<p><img src="images/deploy_tracking.png" alt="deploy tracking" /></p>

<p>Correlate deploys with your app&rsquo;s performance: Scout&rsquo;s GitHub-enhanced deploy tracking makes it easy to identify the Git branch or tag running now and which team members contributed to every deploy.</p>

<p>Scout tracks your deploys without additional configuration if you are running Capistrano. If you aren&rsquo;t using Capistrano or deploying your app to Heroku, see our <a href="#deploy-tracking-config">deploy tracking configuration docs</a>.</p>

<h3 id="sorting">Sorting</h3>

<p>You can sort by memory allocations throughout the UI: from the list of endpoints, to our pulldowns, to transaction traces.</p>

<p><img src="images/memory_sort.png" alt="memory sort" /></p>

<h2 id="git-integration">Git Integration</h2>

<p>If your code is hosted at GitHub, you can see the <a href="#code-backtraces">relevant slow line-of-code within the Scout user interface</a> when viewing a transaction trace. Additionally, you&rsquo;ll also see the:</p>

<ul>
<li>author</li>
<li>commit time</li>
<li>deploy time</li>
</ul>

<p>Git integration must be configured on the settings page for each app. Scout integrates with GitHub via OAuth. Pick the repository name and branch name used for your application.</p>

<p><img src="images/git_settings_annotated.png" alt="git settings" /></p>

<h2 id="context">Context</h2>

<p>Context lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>Adding custom context is easy - learn how via <a href="#ruby-custom-context">Ruby</a> or <a href="#elixir-custom-context">Elixir</a>.</p>

<p>When viewing a transaction trace, click the &ldquo;Context&rdquo; section to see the context Scout has collected.</p>

<h2 id="endpoints-performance">Endpoints Performance</h2>

<h3 id="endpoints-overview">Endpoints Overview</h3>

<p>The endpoints area within Scout provides a sortable view of your app&rsquo;s overall performance aggregated by endpoint name. Click on an endpoint to view details.</p>

<p><img src="images/endpoints_annotated.png" alt="endpoints overview" /></p>

<h2 id="time-comparisons">Time Comparisons</h2>

<p>You can easily compare the performance of your application between different time periods via the time selection on the top right corner of the UI.</p>

<p><img src="images/time_compare_annotated.png" alt="time compare" /></p>

<h2 id="devtrace">DevTrace</h2>

<p>DevTrace is our development profiler: it&rsquo;s included with our Ruby and Elixir libraries. DevTrace can be used for free without signup. Enabling DevTrace adds a speed badge when navigating your app in development. Clicking the speed badge reveals a shareable transaction trace of the request.</p>

<p><img src="images/devtrace.png" alt="devtrace" /></p>

<p>View our <a href="#ruby-devtrace">Ruby</a> and <a href="#elixir-devtrace">Elixir</a> instructions.</p>

<h2 id="data-retention">Data Retention</h2>

<p>Scout stores 30 days of metrics and seven days of transaction traces.</p>

          <h1 id="service-status">Service Status</h1>

<p>We&rsquo;re transparent about our uptime and service issues. If you appear to be experiencing issues with our service:</p>

<ul>
<li><a href="http://status.scoutapp.com">Check out status site</a>. You can subscribe to service incidents.</li>
<li><a href="mailto:support@scoutapp.com">Email us</a></li>
</ul>

<h1 id="contacting-support">Contacting Support</h1>

<p>Don&rsquo;t hesitate to contact us at <a href="mailto:support@scoutapp.com">support@scoutapp.com</a> any issues. We typically respond in a couple of hours during the business day.</p>

<h1 id="reference">Reference</h1>

<h2 id="how-we-collect-metrics">How we collect metrics</h2>

<p>Scout is engineered to monitor the performance of your mission-critical production applications by providing an easy-install, low-overhead monitoring agent with a hosted SaaS service that values your security. The basic flow:</p>

<ul>
<li>Embed our agent in your application. You don&rsquo;t access to the servers your app is deployed on.</li>
<li>The agent instruments key libraries (database access, controllers, views, etc) using low-overhead instrumentation.</li>
<li>Every minute, the agent connects over https (always) through a 256-bit secure, encrypted connection (the same encryption your bank uses) and sends metrics to our servers.</li>
<li>Over servers store the data.</li>
</ul>

<h2 id="performance-overhead">Performance Overhead</h2>

<p>Our agent is designed to run in production environments and is extensively benchmarked to ensure it performs on high-traffic applications.</p>

<p>Our most recent benchmarks (<em>lower is better</em>):</p>

<p><img src="images/overhead.png" alt="overhead" /></p>

<p>We&rsquo;ve <a href="http://blog.scoutapp.com/articles/2016/02/07/overhead-benchmarks-new-relic-vs-scout">open-sourced our benchmarks</a> so you can test on our own. If your results differ, <a href="mailto:support@scoutapp.com">reach out to us at support@scoutapp.com</a>.</p>

<h3 id="call-aggregation">Call Aggregation</h3>

<p>During a transaction, the Scout agent records each database call, each external HTTP request, each rendering of a view, and several other instrumented libraries. While each individual pieces of this overall trace has a tiny memory footprint, large transactions can sometimes build up thousands and thousands of them.  </p>

<p>To limit our agent&rsquo;s memory usage, we stop recording the details of every instrument after a relatively high limit. Detailed metrics and backtraces are collected for all calls up to the limit and aggregated metrics are collected for calls over the limit.</p>

<h2 id="security">Security</h2>

<p>We take the security of your code metrics extremely seriously. Keeping your data secure is fundamental to our business. Scout is nearing a decade storing critical metrics with our server monitoring product and those same fundamentals are applied here:</p>

<ul>
<li>All data transmitted by our agent to our servers is sent as serialized JSON over SSL.</li>
<li>Our UI is only served under SSL.</li>
<li>When additional data is collected for slow calls (ex: SQL queries), query parameters are sanitized before sending these to our servers.</li>
<li>Our infrastructure resides in an SOC2 compliant datacenter.</li>
</ul>

<h3 id="information-sent-to-our-servers">Information sent to our servers</h3>

<p>The following data is sent to our servers from the agent:</p>

<ul>
<li>Timing information collected from our instrumentation</li>
<li>Gems used by your application</li>
<li>Transaction traces, which include:

<ul>
<li>The URL, including query parameters, of the slow request. This can be modified to exclude query params via the <a href="#configuration-reference"><code>uri_reporting</code></a> configuration option.</li>
<li>IP Address of the client initiating the request</li>
<li>Sanitized SQL query statements</li>
</ul></li>
<li>Process memory and CPU usage</li>
<li>Error counts</li>
</ul>

<h3 id="hipaa-compliance">HIPAA compliance</h3>

<p>While Scout itself is not HIPAA compliant, our agent can be installed safely in HIPAA compliant environments. To ensure user data is properly de-identified:</p>

<ol>
<li>Disable sending HTTP query params if these contain sensitive data via the <code class="prettyprint">uri_reporting</code> config option.</li>
<li>Do not add custom context (like reporting the current user in the session).</li>
</ol>

<p>Email support@scoutapp.com with any questions on security compliance.</p>

<h3 id="git-integration-security">Git Integration</h3>

<p>Scout only needs read-only access to your repository, but unfortunately, Github doesn&rsquo;t currently allow this - they only offer read-write permissions through their OAuth API.</p>

<p>We have asked Github to offer read-only permissions, and they&rsquo;ve said that the feature coming soon. In the mean time, we&rsquo;re limited to the permissions structure Github offers. Our current Git security practices:</p>

<ul>
<li>we don&rsquo;t clone your repository&rsquo;s code; we only pull the commit history</li>
<li>the commit history is secured on our servers according to industry best practices</li>
<li>authentication subsystems within our application ensure your commit history is never exposed to anyone outside your account.</li>
</ul>

<p>All that said, we suggest the following:</p>

<ul>
<li><a href="https://github.com/contact">Contact Github</a> about allowing read-only access. This will ensure it stays top-of-mind.</li>
<li>This is optional and you are able to view backtrace information w/o the integration. It&rsquo;s likely possible to even write a UserScript to open the code locally in your editor or on Github.</li>
</ul>

<h4 id="workaround-for-read-only-github-access">Workaround for read-only Github Access</h4>

<p>With a few extra steps, you can grant Scout read-only access. Here&rsquo;s how:</p>

<ul>
<li>Create a team in your Github organization with read-only access to the respective application repositories.</li>
<li>Create a new Github user and make them a member of that team.</li>
<li>Authenticate with this user.</li>
</ul>

<h2 id="scoutprof-faq">ScoutProf FAQ</h2>

<h3 id="does-scoutprof-work-with-stackprof">Does ScoutProf work with Stackprof?</h3>

<p><a href="#scoutprof">ScoutProf</a> and StackProf are not guaranteed to operate at the same time.  If you wish to use Stackprof, temporarily disable profiling in your config file (<code class="prettyprint">profile: false</code>) or via environment variables (<code class="prettyprint">SCOUT_PROFILE=false</code>). See the agent&rsquo;s <a href="#ruby-configuration-options">configuration options</a>.</p>

<h3 id="how-is-scoutprof-different-than-stackprof">How is ScoutProf different than Stackprof?</h3>

<p>Stackprof was the inspiration for ScoutProf.  Although little original Stackprof code remains, we started with Stackprof&rsquo;s core approach, and integrated it with our APM agent gem, changed it heavily to work with threaded applications, and implemented an easy to understand UI on our trace view.</p>

<h3 id="what-do-sample-counts-mean">What do sample counts mean ?</h3>

<p>ScoutProf attempts to sample your application every millisecond, capturing a snapshot backtrace of what is running in each thread.  For each successful backtrace captured, that is a sample.  Later, when we process the raw backtraces, identical traces get combined and the sample count is how many of each unique backtrace were seen.</p>

<h3 id="why-do-sample-counts-vary">Why do sample counts vary?</h3>

<p>Samples will be paused automatically for a few different reasons:</p>

<ul>
<li>If Ruby is in the middle of a GC run, samples won&rsquo;t be taken.</li>
<li>If the previous sampling hasn&rsquo;t been run, a new sampling request won&rsquo;t be added.</li>
</ul>

<p>The specifics of exactly how often these scenarios happen depend on how and in what order your ruby code runs. Different sample counts can be expected, even for the same endpoint.</p>

<h3 id="what-are-the-scoutprof-requirements">What are the ScoutProf requirements?</h3>

<ul>
<li>A Linux-based operating system</li>
<li>Ruby 2.1+</li>
</ul>

<h3 id="whats-supported-during-beta">What&rsquo;s supported during BETA?</h3>

<p>During our BETA period, ScoutProf has a few limitations:</p>

<ul>
<li>ScoutProf only runs on Linux. Support for additional distros will be added.</li>
<li>ScoutProf only breaks down time spent in ActionController, not ActionView and not Sidekiq. Support for other areas will be added.</li>
</ul>

<p>The ScoutProf-enabled version of <code class="prettyprint">scout_apm</code> can be safely installed on all environments our agent supports: the limitations above only prevent ScoutProf from running.</p>

<h2 id="billing">Billing</h2>

<h3 id="free-trial">Free Trial</h3>

<p>We offer a no-risk, free 14-day trial. Delete your monitored apps before the trial concludes and you don&rsquo;t pay.</p>

<h3 id="billing-date">Billing Date</h3>

<p>Your first bill is 30 days after your signup date.</p>

<h3 id="subscription-style">Subscription Style</h3>

<p>You can choose the subscription style that makes sense for your organization. We offer two subscription styles:</p>

<h4 id="per-server">Per-Server</h4>

<p><strong>This is the default approach</strong>. You are billed for the number of servers that are actively reporting on your billing date.</p>

<h4 id="per-request">Per-Request</h4>

<p>If you have a smaller application or have many smaller instances or Docker containers per-request billing may make more sense. Volume discounts are automatically applied as your application handles more throughput. Contact <a href="mailto:support@scoutapp.com">support@scoutapp.com</a> for pricing options.</p>

<h2 id="replacing-new-relic">Replacing New Relic</h2>

<p>Scout is an attractive <a href="https://scoutapp.com/newrelic-alternative" target="_blank">alternative to New Relic</a> for modern dev teams (frequent deploys, using Git, deploying to many micro instances &amp; containers, using vendors for key infrastructure services like Amazon RDS, etc). We provide a laser-focus on getting to slow custom application code fast vs. wide breadth as debugging slow custom application code is typically the most time-intensive performance optimization work.</p>

<p>In many cases, Scout is able to replace New Relic as-is. However, there are cases where your app has specific needs we currently don&rsquo;t provide. Don&rsquo;t fret - here&rsquo;s some of the more common scenarios and our suggestions for building a monitoring stack you&rsquo;ll love:</p>

<ul>
<li><strong>Exception Monitoring</strong> - we provide metrics on the rate of exceptions but we don&rsquo;t currently provide details on exceptions. Our favorite tool for this is <a href="http://getsentry.com">Sentry</a>:

<ul>
<li>Affordable: starts @ $29/mo.</li>
<li>Realtime exceptions: you&rsquo;ll see new exceptions coming through as-they-happen (every second).</li>
<li>Great UI</li>
<li>Context tracking (easy to see how an exception is impacting which users). We implemented a similar API for our slow request tracking.</li>
</ul></li>
<li><strong>Browser Monitoring (Real User Monitoring)</strong> - there are a number of dedicated tools for both Real User Monitoring (RUM) and synthetic monitoring. You can also continue to use New Relic for browser monitoring and use Scout for application monitoring.</li>
</ul>

<h3 id="our-monitoring-stack">Our Monitoring Stack</h3>

<p>Curious about what a company that lives-and-breathes monitoring (us!) uses to monitor our apps? <a href="http://blog.scoutapp.com/articles/2015/12/02/rails-monitoring-stack-2016">We shared our complete monitoring stack on our blog</a>.</p>

<h3 id="talk-to-us-about-your-monitoring-stack">Talk to us about your monitoring stack</h3>

<p>Don&rsquo;t hesitate to <a href="mailto:support@scoutapp.com">email us</a> if you need to talk through your monitoring stack. Monitoring is something we know and love.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
  <script>
    $.ajax({
      url: "http://apm.scoutapp.com/latest_gem_version",
      dataType: "jsonp"
    }).success(function(response){
      $("#latest-gem-version").html(response.version)
    });

    /**
     * AnchorJS v3.2.0 options and selector
     */

    (function (global) {
      'use strict';
      anchors.options.placement = 'right';

      anchors.add('.content > h2, .content > h3, .content > h4');

    })(window);

  </script>
</html>
