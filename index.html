<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Help Docs ~ Scout APM</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/screen_overrides.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
    <link href="stylesheets/scout.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js"></script>

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Slab:400,700' rel='stylesheet' type='text/css'>

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,700,700italic,800,800italic|Arimo:400,400i,700' rel='stylesheet' type='text/css'>

      <script>
        $(function() {
          setupLanguages([]);
        });
      </script>

    <!-- Segment.io -->
    <script>
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
      analytics.load("vIATKC0XM9jmRNEQfF8kVJXwEChtmd1K");
      analytics.page();
      }}();
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W82W6H5');</script>
    <!-- End Google Tag Manager -->
  </head>

  <body class="index" data-languages="[]">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W82W6H5"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <a href="https://scoutapm.com" target="_blank"><img src="images/logo.png" id="logo" alt="Logo" /></a>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="scout-help-docs">Scout Help Docs</h1>

<p>Welcome to the help site for <strong><a href="https://scoutapm.com">Scout Application Monitoring</a></strong>. Don&rsquo;t have an account? <a href="https://scoutapm.com/info/pricing" target="_blank">Get started</a>.</p>

<p>Browse through the sidebar, search, <a href="mailto:support@scoutapm.com">email us</a>, or <a href="http://slack.scoutapm.com" target="_blank">join our Slack community</a>. We&rsquo;re here to help.</p>

<div id="overview_container">
  <div>
    <h3>
      <img src="images/ruby.png" alt="ruby" />
      <a href="#ruby-agent">Ruby Agent</a>
    </h3>
    <p>
      View our docs for installing, configuring, and troubleshooting the Scout Ruby agent.
    </p>
  </div>

  <div>
    <h3>
      <img src="images/elixir.png" alt="elixir" />
      <a href="#elixir-agent">Elixir Agent</a>
    </h3>
    <p>
      View our docs for installing, configuring, and troubleshooting the Scout Elixir agent.
    </p>
  </div>

  <div>
    <h3>
        <img src="images/python.png" alt="python" />
        <a href="#python-agent">Python Agent</a></h3>
    </h3>
    <p>
      View our docs for installing, configuring, and troubleshooting the Scout Python agent.
    </p>
  </div>

  <div>
    <h3>
        <img src="images/php.png" alt="php" />
        <a href="#php-agent">PHP Agent</a></h3>
    </h3>
    <p>
      View our docs for installing, configuring, and troubleshooting the Scout PHP agent.
    </p>
  </div>
</div>

<h2 id="overview">Overview</h2>

<p>Scout Application Monitoring is a lightweight, production-grade application monitoring service built for modern development teams. Just embed our agent in your application: we handle the rest. </p>

<p>Here&rsquo;s an overview of the key functionality in our application monitoring service:</p>

<h3 id="agents">Agents</h3>

<p>We support Ruby on Rails, Elixir, Python, and PHP apps.</p>

<p>Our agent is designed to run in production environments and has low overhead. Every minute, the agent transmits metrics to our service over SSL. </p>

<p>There&rsquo;s nothing to install on your servers.</p>

<h3 id="user-interface">User Interface</h3>

<p>A complete overview of the Scout UX is available in the <a href="#features">features</a> area of this help site.</p>

          <h1 id="ruby-agent">Ruby Agent</h1>

<h2 id="ruby-requirements">Requirements</h2>

<p>Our Ruby agent supports Ruby on Rails 2.2+ and Ruby 1.8.7+. See a <a href="#ruby-instrumented-libs">list of libraries we auto-instrument</a>.</p>

<p><a href="#memory-bloat-detection">Memory Bloat detection</a> and <a href="#scoutprof">ScoutProf</a> require Ruby 2.1+.</p>

<h2 id="ruby_install">Installation</h2>

<p>Tailored instructions are provided within our user interface. General instructions:</p>

<table class="help install install_ruby">
  <tbody>
      <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
              <p>Your Gemfile:</p>
<pre>
gem 'scout_apm'
</pre>

        <p><strong>Shell:</strong></p>

<pre>
bundle install
</pre>
      </td>
    </tr>
    <tr>
        <td><span class="step">2</span></td>
        <td><p>Download your customized config file*, placing it at <code>config/scout_apm.yml</code>.</p>
        <p class="smaller">Your customized config file is available within your Scout account.</p>
      </td>
    </tr>
    <tr>
        <td><span class="step">3</span></td>
        <td><p>Deploy.</p></td>
    </tr>
    </tbody>
</table>

<p>
* - If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets the required settings via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a> and a configuration file isn&rsquo;t required.
</p>

<h2 id="ruby-troubleshooting">Troubleshooting</h2>

<h3 id="no-data">No Data</h3>

<p>Not seeing any data?</p>

<aside class="notice">Using Heroku? View our <a href="https://devcenter.heroku.com/articles/scout#troubleshooting">Heroku-specific troubleshooting instructions.</a></aside>

<table class="help">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Is there a <code>log/scout_apm.log</code> file?</p>
        <p><strong style="color:gray">Yes:</strong></p>
        <p>Examine the log file for error messages:</p>
<pre>
tail -n1000 log/scout_apm.log | grep "Starting monitoring" -A20
</pre>
        <p>
          See something noteworthy? Proceed to <a href="#step7">to the last step</a>. Otherwise, continue to step 2.
        </p>
        <p><strong style="color:gray">No:</strong></p>
        <p>
          The gem was never initialized by the application.</p>
        <p>
          Ensure that the <code>scout_apm</code> gem is not restricted to a specific <code>group</code> in your <code>Gemfile</code>. For example, the configuration below would prevent <code>scout_apm</code> from loading in a <code>staging</code> environment:
        </p>
<pre>
group :production do
  gem 'unicorn'
  gem 'scout_apm'
end
</pre>
        <p><a href="#step7">Jump to the last step</a> if <code>scout_apm</code> is correctly configured in your <code>Gemfile</code>.</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td>
        <p>Was the <code><strong>scout_apm</strong></code> gem deployed with your application?</p>
<pre>
bundle list scout_apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td>
        <p>Did you download the config file, placing it in <code><strong>config/scout_apm.yml</strong></code>?</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">4</span>
      </td>
      <td>
        <p>
          Did you restart the app and let it run for a while?
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">5</span>
      </td>
      <td>
        <a name="step5"></a>
        <p>Are you sure the application has processed any requests?</p>
<pre>
tail -n1000 log/production.log | grep "Processing"
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">6</span>
      </td>
      <td>
        <p>
          Using Unicorn?
        </p>
        <p>Add the <code>preload_app true</code> directive to your Unicorn config file. <a href="https://unicorn.bogomips.org/Unicorn/Configurator.html#method-i-preload_app">Read more</a> in the Unicorn docs.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <a name="step7"></a>
        <span class="step">7</span>
      </td>
      <td>
        <p>
          Oops! Still not seeing any data? Check out the <a href="https://github.com/scoutapp/scout_apm_ruby/issues">GitHub issues</a> and <a href="mailto:support@scoutapm.com">send us an email</a> with the following:
        </p>
        <ul>
          <li>The last 1000 lines of your <code>log/scout_apm.log</code> file, if the file exists:<br/><code>tail -n1000 log/scout_apm.log</code>.
          </li>
          <li>Your application&rsquo;s gems <code>bundle list</code>.
          </li>
          <li>
            Rails version
          </li>
          <li>
            Application Server (examples: Passenger, Thin, etc.)
          </li>
          <li>
            Web Server (examples: Apache, Nginx, etc.)
          </li>
        </ul>
        <p>
          We typically respond within a couple of hours during the business day.
        </p>
      </td>
    </tr>
  </tbody>
</table>

<h3 id="significant-time-spent-in-controller-or-job">Significant time spent in &ldquo;Controller&rdquo; or &ldquo;Job&rdquo;</h3>

<p>When viewing a transaction trace, you may see time spent in the &ldquo;controller&rdquo; or &ldquo;job&rdquo; layers. This is time that falls outside of Scout&rsquo;s default instrumentation. There are two options for gathering additional instrumentation:</p>

<ol>
<li><a href="#ruby-custom-instrumentation">Custom Instrumentation</a> - use our API to instrument pieces of code that are potential bottlenecks.</li>
<li><a href="#scoutprof">ScoutProf</a> - install our BETA agent which adds ScoutProf. ScoutProf breaks down time spent within the controller layer. Note that ScoutProf does not instrument background jobs.</li>
</ol>

<h3 id="missing-memory-metrics">Missing memory metrics</h3>

<p>Memory allocation metrics require the following:</p>

<ul>
<li>Ruby version 2.1+</li>
<li><code class="prettyprint">scout_apm</code> version 2.0+</li>
</ul>

<p>If the above requirements are not met, Scout continues to function but does not report allocation-related metrics.</p>

<h2 id="updating-to-the-newest-version">Updating to the Newest Version</h2>

<p>The latest version of <code class="prettyprint">scout_apm</code> is <code><span id="latest-gem-version">SEE CHANGELOG</span></code>.</p>

<table class="help install">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Ensure your Gemfile entry for Scout is: <code>gem 'scout_apm'</code> </p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td><p>Run <code> bundle update scout_apm</code></p></td>
    </tr>
      <tr>
      <td><span class="step">3</span></td>
      <td><p>Re-deploy your application.</p></td>
    </tr>
  </tbody>
</table>

<p>The gem version changelog is <a href="https://github.com/scoutapp/scout_apm_ruby/blob/master/CHANGELOG.markdown">available here</a>.<br>
<h2 id="ruby-configuration-options">Configuration Options</h2></p>

<p>The Ruby agent can be configured via the <code class="prettyprint">config/scout_apm.yml</code> Yaml file and/or environment variables. A config file with your organization key is available for download as part of the install instructions.</p>

<h3 id="erb-evaluation">ERB evaluation</h3>

<p>ERB is evaluated when loading the config file. For example, you can set the app name based on the hostname:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "ProjectPlanner.io (#{Rails.env})" %&gt;</span>
</code></pre>
<h3 id="ruby-configuration-reference">Configuration Reference</h3>

<p>The following configuration settings are available:</p>

<table class="lookup">
  <thead>
    <tr>
      <th>
        Setting&nbsp;Name
      </th>
      <th>
        Description
      </th>
      <th>
        Default
      </th>
      <th>
        Required
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>
        name
      </th>
      <td>
        Name of the application (ex: &lsquo;Photos App&rsquo;).
      </td>
      <td>
        <code>Rails.application.class.to_s.
           sub(/::Application$/, '')</code>
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        key
      </th>
      <td>
        The organization API key.
      </td>
      <td></td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        monitor
      </th>
      <td>
        Whether monitoring should be enabled.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        log_level
      </th>
      <td>
        The logging level of the agent.
      </td>
      <td>
        <code>INFO</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        log_file_path
      </th>
      <td>The path to the <code>scout_apm.log</code> log file directory. Use <code>stdout</code> to log to STDOUT.
      </td>
      <td>
        <code>Environment#root+log/</code>&nbsp;or <code>STDOUT</code> if running on Heroku.
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        hostname
      </th>
      <td>
        The hostname the metrics should be aggregrated under.
      </td>
      <td>
        <code>Socket.gethostname</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        proxy
      </th>
      <td>Specify the proxy URL (ex: <code>https://proxy</code>) if a proxy is required.
      </td>
      <td></td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        host
      </th>
      <td>
        The protocol + domain where the agent should report.
      </td>
      <td>
        <code>https://scoutapm.com</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        uri_reporting
      </th>
      <td>
        By default Scout reports the URL and filtered query parameters with transaction traces. Sensitive parameters in the URL will be redacted. To exclude query params entirely, use
        <code>path</code>.
      </td>
      <td>
        <code>filtered_params</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        disabled_instruments
      </th>
      <td>
        An Array of instruments that Scout should not install. Each Array element should should be a string-ified, case-sensitive class name (ex: <code>['Elasticsearch','HttpClient']</code>). The default installed instruments can be viewed in the <a href="https://github.com/scoutapp/scout_apm_ruby/tree/master/lib/scout_apm/instruments" target="_blank">agent source</a>.
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        ignore
      </th>
      <td>
        An Array of web endpoints that Scout should not instrument. Routes that match the prefixed path (ex: <code>['/health', '/status']</code>) will be ignored by the agent.
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        enable_background_jobs
      </th>
      <td>
        Indicates if background jobs should be monitored.
      </td>
      <td>
        <code>true</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>dev_trace</th>
      <td>
        Indicates if DevTrace, the Scout development profiler, should be enabled. Note this setting only applies
        to the development environment.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>No</td>
    </tr>
    <tr>
      <th>profile</th>
      <td>
        Indicates if ScoutProf, the Scout code profiler, should be enabled.
      </td>
      <td>
        <code>true</code>
      </td>
      <td>No</td>
    </tr>
    <tr>
      <th>revision_sha</th>
      <td>
        The Git SHA that corresponds to the version of the app being deployed.
      </td>
      <td>
        <a href="#ruby-deploy-tracking-config">See docs</a>
      </td>
      <td>No</td>
    </tr>
    <tr>
      <th>detailed_middleware</th>
      <td>
        When true, the time spent in each middleware is visible in transaction traces vs. an aggregrate across all middlewares. This
        adds additional overhead and is disabled by default as middleware is an uncommon bottleneck.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>No</td>
    </tr>
    <tr>
      <th>collect_remote_ip</th>
      <td>
        Automatically capture end user IP addresses as part of each trace&rsquo;s context.
      </td>
       <td>
         <code>true</code>
       </td>
      <td>No</td>
    </tr>
    <tr>
      <th>timeline_traces</th>
      <td>
        Send traces in both the summary and <a href="#timeline-transaction-trace">timeline</a> formats.
      </td>
       <td>
         <code>true</code>
       </td>
      <td>No</td>
    </tr>
    <tr>
      <th id="auto_instruments_config">auto_instruments</th>
      <td>
        Instrument custom code with <a href="#autoinstruments">AutoInstruments</a>.
      </td>
       <td>
         <code>false</code>
       </td>
      <td>No</td>
    </tr>
    <tr>
      <th id="auto_instruments_ignore_config">auto_instruments_ignore</th>
      <td>
        Excludes the listed files names from being autoinstrumented. Ex: <code>['application_controller']</code>.
      </td>
       <td>
         <code>[]</code>
       </td>
      <td>No</td>
    </tr>
  </tbody>
</table>

<h3 id="ruby-env-vars">Environment Variables</h3>

<p>You can also configure Scout APM via environment variables. <em>Environment variables override settings provided in</em> <code class="prettyprint">scout_apm.yml</code>.</p>

<p>To configure Scout via enviroment variables, uppercase the config key and prefix it with <code class="prettyprint">SCOUT</code>. For example, to set the key via environment variables:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">export</span> <span class="no">SCOUT_KEY</span><span class="o">=</span><span class="no">YOURKEY</span>
</code></pre>
<h2 id="ruby-deploy-tracking-config">Deploy Tracking Config</h2>

<p>Scout can <a href="#deploy-tracking">track deploys</a>, making it easier to correlate changes in your app to performance. To enable deploy tracking, first ensure you are on the latest version of <code class="prettyprint">scout_apm</code>. See our <a href="#updating-to-the-newest-version">upgrade instructions</a>.</p>

<p>Scout identifies deploys via the following:</p>

<ol>
<li>If you are using Capistrano, no extra configuration is required. Scout reads the contents of the <code class="prettyprint">REVISION</code> and/or <code class="prettyprint">revisions.log</code> file and parses out the SHA of the most recent release.</li>
<li>If you are using Heroku, enable <a href="https://devcenter.heroku.com/articles/dyno-metadata">Dyno Metadata</a>. This adds a <code class="prettyprint">HEROKU_SLUG_COMMIT</code> environment variable to your dynos, which Scout then associates with deploys.</li>
<li>If you are deploying via a custom approach, set a <code class="prettyprint">SCOUT_REVISION_SHA</code> environment variable equal to the SHA of your latest release.</li>
<li>If the app resides in a Git repo, Scout parses the output of <code class="prettyprint">git rev-parse --short HEAD</code> to determine the revision SHA.</li>
</ol>

<h2 id="ruby-devtrace">Enabling DevTrace</h2>

<p>To enable <a href="#devtrace">DevTrace</a>, our in-browser profiler:</p>

<table class="help install">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Ensure you are on the latest version of <code>scout_apm</code>.
          See our <a href="#updating-to-the-newest-version">upgrade instructions</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td>
        <p style="line-height: 170%">
          Add <code>dev_trace: true</code> to the <code>development</code> section of your <code>scout_apm.yml</code> config file or start your local Rails server with:
          <code>SCOUT_DEV_TRACE=true rails server</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td>
        <p>Refresh your browser window and look for the speed badge.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="ruby-server-timing">Server Timing</h2>

<p>View performance metrics (time spent in ActiveRecord, Redis, etc) for each of your app&rsquo;s requests in Chrome’s Developer tools with the <a href="https://github.com/scoutapp/ruby_server_timing">server_timing</a> gem. Production-safe.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/scout-blog/ruby_server_timing.png" alt="server timing" /></p>

<p>For install instructions and configuration options, see <a href="https://github.com/scoutapp/ruby_server_timing">server_timing</a> on GitHub.</p>

<h2 id="request-queuing">Request Queuing</h2>

<p>Scout can measure the time it takes a request to reach your Rails app from farther upstream (a load balancer or web server). This appears in Scout as &ldquo;Request Queuing&rdquo; and provides an indication of your application&rsquo;s capacity. Large request queuing time is an indication that your app needs more capacity.</p>

<p><img src="images/request_queue_annotated.png" alt="request queuing" /></p>

<p>To see this metric within Scout, you need to configure your upstream software, adding an HTTP header that our agent reads. This is typically a one-line change.</p>

<h3 id="http-header">HTTP Header</h3>

<p>The Scout agent depends on an HTTP request header set by an upstream load balancer (ex: HAProxy) or web server (ex: Apache, Ngnix).</p>

<p><strong>Protip:</strong> We suggest adding the header as early as possible in your infrastructure. This ensures you won&rsquo;t miss performance issues that appear before the header is set.</p>

<p>The agent will read any of the following headers as the start time of the request:</p>
<pre class="highlight ruby tab-ruby"><code><span class="sx">%w(X-Queue-Start X-Request-Start X-QUEUE-START X-REQUEST-START x-queue-start x-request-start)</span>
</code></pre>
<p>Include a value in the format <code class="prettyprint">t=MICROSECONDS_SINCE_EPOCH</code> where <code class="prettyprint">MICROSECONDS_SINCE_EPOCH</code> is an integer value of the number of microseconds that have elapsed since the beginning of Unix epoch.</p>

<p><strong>Nearly any front-end HTTP server or load balancer can be configured to add this header.</strong> Some examples are below.</p>

<h3 id="ruby-heroku-request-queue">Heroku</h3>

<p>Time in queue is automatically collected for apps deployed on Heroku. This measures the time from when a request hits the Heroku router and when your app begins processing the request.</p>

<h3 id="apache">Apache</h3>

<p>Apache&rsquo;s <strong>mod_headers</strong> module includes a <code class="prettyprint">%t</code> variable that is formatted for Scout usage. To enable request queue reporting, add this code to your Apache config:</p>
<pre class="highlight  tab-plaintext"><code>RequestHeader set X-Request-Start "%t"
</code></pre>
<h4 id="apache-request-queuing-and-file-uploads">Apache Request Queuing and File Uploads</h4>

<p>If you are using Apache, you may observe a spike in queue time within Scout for actions that process large file uploads. Apache adds the <code class="prettyprint">X-Request-Start</code> header as soon as the request hits Apache. So, all of the time spent uploading a file will be reported as queue time.</p>

<p>This is different from Nginx, which will first buffer the file to a tmp file on disk, then once the upload is complete, add headers to the request.</p>

<h3 id="haproxy">HAProxy</h3>

<p>HAProxy 1.5+ supports timestamped headers and can be set in the frontend or backend section. We suggest putting this in the frontend to get a more accurate number:</p>
<pre class="highlight  tab-plaintext"><code>http-request set-header X-Request-Start t=%Ts
</code></pre>
<h3 id="nginx">Nginx</h3>

<p>Nginx 1.2.6+ supports the use of the <code class="prettyprint">#{msec}</code> variable. This makes adding the request queuing header straightforward.</p>

<p>General Nginx usage:</p>
<pre class="highlight  tab-plaintext"><code>proxy_set_header X-Request-Start "t=${msec}";
</code></pre>
<p>Passenger 5+:</p>
<pre class="highlight  tab-plaintext"><code>passenger_set_header X-Request-Start "t=${msec}";
</code></pre>
<p>Older Passsenger versions:</p>
<pre class="highlight  tab-plaintext"><code>passenger_set_cgi_param X-REQUEST-START "t=${msec}";
</code></pre>
<p>Note: The Nginx option is local to the <a href="https://www.phusionpassenger.com/library/config/nginx/reference/#this-configuration-option-is-not-inherited-across-contexts">location block</a>, and isn&rsquo;t inherited.</p>

<h2 id="actioncontroller-metal">ActionController::Metal</h2>

<p>Prior to agent version 2.1.26, an extra step was required to instrument <code class="prettyprint">ActionController::Metal</code>
and <span style="white-space: nowrap;"><code class="prettyprint">ActionController::Api</code></span> controllers. After 2.1.26, this is automatic.</p>

<p>The previous instructions which had an explicit <code class="prettyprint">include</code> are no longer
needed, but if that code is still in your controller, it will not harm
anything. It will be ignored by the agent and have no effect.</p>

<h2 id="rack">Rack</h2>

<p>Rack instrumentation is more explicit than Rails instrumentation, since Rack applications can take
nearly any form. After <a href="#ruby_install">installing our agent</a>, instrumenting Rack is a three step process:</p>

<ol>
<li>Configuring the agent</li>
<li>Starting the agent</li>
<li>Wrapping endpoints in tracing</li>
</ol>

<h3 id="rack-config">Configuration</h3>

<p>Rack apps are configured using the same approach as a Rails app: either via a <code class="prettyprint">config/scout_apm.yml</code> config file or environment variables.</p>

<ul>
<li><strong>configuration file</strong>: create a <code class="prettyprint">config/scout_apm.yml</code> file under your application root directory. The file structure is outlined <a href="#ruby-configuration-options">here</a>.</li>
<li><strong>environment variables</strong>: see our docs on configuring the agent via <a href="#ruby-env-vars">environment variables</a>.</li>
</ul>

<h3 id="starting-the-agent">Starting the Agent</h3>

<p>Add the <code class="prettyprint">ScoutApm::Rack.install!</code> startup call as close to the spot you
<code class="prettyprint">run</code> your Rack application as possible.  <span style="white-space: nowrap;"><code class="prettyprint">install!</code></span>
should be called after you require other gems (ActiveRecord, Mongo, etc)
to install instrumentation for those libraries.</p>
<pre class="highlight ruby tab-ruby"><code><span class="c1"># config.ru</span>

<span class="nb">require</span> <span class="s1">'scout_apm'</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">install!</span>

<span class="n">run</span> <span class="no">MyApp</span>
</code></pre>
<h3 id="adding-endpoints">Adding endpoints</h3>

<p>Wrap each endpoint in a call to <code class="prettyprint">ScoutApm::Rack#transaction(name, env)</code>.</p>

<ul>
<li><code class="prettyprint">name</code> - an unchanging string argument for what the endpoint is. Example: <code class="prettyprint">&quot;API User Listing&quot;</code></li>
<li><code class="prettyprint">env</code> - the rack environment hash</li>
</ul>

<p>This may be fairly application specific in details.</p>

<p>Example:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">app</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="s2">"API User Listing"</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">to_json</span>
    <span class="p">[</span><span class="s1">'200'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">},</span> <span class="p">[</span><span class="n">users</span><span class="p">]]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>If you run into any issues, or want advice on naming or wrapping endpoints, contact us at
support@scoutapm.com for additional help.</p>

<h2 id="sinatra">Sinatra</h2>

<p>Instrumenting a Sinatra application is similar to instrumenting a generic <a href="#rack">Rack application</a>.</p>

<h3 id="sinatra-configuration">Configuration</h3>

<p>The agent configuration (API key, app name, etc) follows the same process as the <a href="#rack-config">Rack application config</a>.</p>

<h3 id="sinatra-starting-agent">Starting the agent</h3>

<p>Add the <code class="prettyprint">ScoutApm::Rack.install!</code> startup call as close to the spot you
<code class="prettyprint">run</code> your Sinatra application as possible.  <span style="white-space: nowrap;"><code class="prettyprint">install!</code></span>
should be called <em>after</em> you require other gems (ActiveRecord, Mongo, etc).</p>
<pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'./main'</span>

<span class="nb">require</span> <span class="s1">'scout_apm'</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">install!</span>

<span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</code></pre>
<h3 id="sinatra-transactions">Adding endpoints</h3>

<p>Wrap each endpoint in a call to <code class="prettyprint">ScoutApm::Rack#transaction(name, env)</code>. For example:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Rack</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="s2">"get /"</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="nf">env</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM pg_catalog.pg_tables"</span><span class="p">)</span>
    <span class="s2">"Hello!"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>See our <a href="#adding-endpoints">Rack docs for adding an endpoint</a> for more details.</p>

<h2 id="ruby-custom-context">Custom Context</h2>

<p><a href="#context">Context</a> lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>It&rsquo;s simple to add <a href="#context">custom context</a> to your app. There are two types of context:</p>

<h3 id="user-context">User Context</h3>

<p>For context used to identify users (ex: email, name):</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">({})</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">(</span><span class="ss">email: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">(</span><span class="ss">email: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">location</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
</code></pre>
<h3 id="general-context">General Context</h3>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">({})</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">account: </span><span class="vi">@account</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">database_shard: </span><span class="vi">@db</span><span class="p">.</span><span class="nf">shard_id</span><span class="p">,</span> <span class="ss">monthly_spend: </span><span class="vi">@account</span><span class="p">.</span><span class="nf">monthly_spend</span><span class="p">)</span>
</code></pre>
<h3 id="default-context">Default Context</h3>

<p>Scout reports the Request URI and the user&rsquo;s remote IP Address by default.</p>

<h3 id="context-types">Context Types</h3>

<p>Context values can be any of the following types:</p>

<ul>
<li>Numeric</li>
<li>String</li>
<li>Boolean</li>
<li>Time</li>
<li>Date</li>
</ul>

<h3 id="context-field-name-restrictions">Context Field Name Restrictions</h3>

<p>Custom context names may contain alphanumeric characters, dashes, and underscores. Spaces are not allowed.</p>

<p>Attempts to add invalid context will be ignored.</p>

<h3 id="example-adding-the-current-users-email-as-context">Example: adding the current user&rsquo;s email as context</h3>

<p>Add the following to your <code class="prettyprint">ApplicationController</code> class:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">before_filter</span> <span class="ss">:set_scout_context</span>
</code></pre>
<p>Create the following method:</p>
<pre class="highlight ruby tab-ruby"><code><span class="k">def</span> <span class="nf">set_scout_context</span>
  <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add_user</span><span class="p">(</span><span class="ss">email: </span><span class="n">current_user</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">User</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<h3 id="example-adding-the-monthly-spend-as-context">Example: adding the monthly spend as context</h3>

<p>Add the following line to the <code class="prettyprint">ApplicationController#set_scout_context</code> method defined above:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Context</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">monthly_spend: </span><span class="n">current_org</span><span class="p">.</span><span class="nf">monthly_spend</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_org</span>
</code></pre>
<h2 id="ruby-custom-instrumentation">Custom Instrumentation</h2>

<p>Traces that allocate significant amount of time to <code class="prettyprint">Controller</code> or <code class="prettyprint">Job</code> are good candidates to add custom instrumentation. This indicates a significant amount of time is falling outside our default instrumentation.</p>

<h3 id="limits">Limits</h3>

<p>We limit the number of metrics that can be instrumented. Tracking too many unique metrics can impact the performance of our UI. Do not dynamically generate metric types in your instrumentation (ie <code class="prettyprint">self.class.instrument(&quot;user_#{user.id}&quot;, &quot;generate&quot;) { ... })</code> as this can quickly exceed our rate limits.</p>

<h3 id="instrumenting-method-calls">Instrumenting method calls</h3>

<p>To instrument a method call, add the following to the class containing the method:</p>
<pre class="highlight ruby tab-ruby"><code>  <span class="k">class</span> <span class="nc">User</span>
    <span class="kp">include</span> <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Tracer</span>

    <span class="k">def</span> <span class="nf">export_activity</span>
      <span class="c1"># Do export work</span>
    <span class="k">end</span>
    <span class="n">instrument_method</span> <span class="ss">:export_activity</span>
  <span class="k">end</span>
</code></pre>
<p>The call to <code class="prettyprint">instrument_method</code> should be after the method definition.</p>

<h4 id="naming-methods-instrumented-via-instrument_method">Naming methods instrumented via <code class="prettyprint">instrument_method</code></h4>

<p>In the example above, the metric will appear in traces as <code class="prettyprint">User#export_activity</code>. On timeseries charts, the time will be allocated to a <code class="prettyprint">Custom</code> type.</p>

<p><strong>To modify the type</strong>:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">instrument_method</span> <span class="ss">:export_activity</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'Exporting'</span>
</code></pre>
<p>A new <code class="prettyprint">Exporting</code> metric will now appear on charts. The trace item will be displayed as <code class="prettyprint">Exporting/User/export_activity</code>.</p>

<p><strong>To modify the name</strong>:</p>
<pre class="highlight ruby tab-ruby"><code><span class="n">instrument_method</span> <span class="ss">:export_activity</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'Exporting'</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'user_activity'</span>
</code></pre>
<p>The trace item will now be displayed as <code class="prettyprint">Exporting/user_activity</code>.</p>

<h3 id="instrumenting-blocks-of-code">Instrumenting blocks of code</h3>

<p>To instrument a block of code, add the following:</p>
<pre class="highlight ruby tab-ruby"><code>  <span class="k">class</span> <span class="nc">User</span>
    <span class="kp">include</span> <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Tracer</span>

    <span class="k">def</span> <span class="nf">generate_profile_pic</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">instrument</span><span class="p">(</span><span class="s2">"User"</span><span class="p">,</span> <span class="s2">"generate_profile_pic"</span><span class="p">)</span> <span class="k">do</span>
        <span class="c1"># Do work</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<h4 id="naming-methods-instrumented-via-instrument-type-name">Naming methods instrumented via <code class="prettyprint">instrument(type, name)</code></h4>

<p>In the example above, the metric appear in traces as <code class="prettyprint">User/generate_profile_pic</code>. On timeseries charts, the time will be allocated to a <code class="prettyprint">User</code> type. To modify the type or simply, simply change the <code class="prettyprint">instrument</code> corresponding method arguments.</p>

<h3 id="ruby-renaming-transactions">Renaming transactions</h3>

<p>There may be cases where you require more control over how Scout names transactions. For example, if you have a controller-action that renders both JSON and HTML formats and the rendering time varies significantly between the two, it may make sense to define a unique transaction name for each.</p>

<p>Use <code class="prettyprint">ScoutApm::Transaction#rename</code>:</p>
<pre class="highlight ruby tab-ruby"><code><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>                              
    <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="s2">"posts/foobar"</span><span class="p">)</span>                                   
    <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>                    
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>In the example above, the default name for the transaction is <code class="prettyprint">posts/index</code>, which appears as <code class="prettyprint">PostsController#index</code> in the Scout UI. Renaming the transaction to <code class="prettyprint">posts/foobar</code> identifies the transaction as <code class="prettyprint">PostsController#foobar</code> in the Scout UI.  </p>

<p>Do not generate highly cardinality transaction names (ex: <code class="prettyprint">ScoutApm::Transaction.rename(&quot;posts/foobar_#{current_user.id}&quot;)</code>) as we limit the number of transactions that can be tracked. High-cardinality transaction names can quickly surpass this limit.</p>

<h3 id="ruby-testing-instrumentation">Testing instrumentation</h3>

<p>Improper instrumentation can break your application. It&rsquo;s important to test before deploying to production. The easiest way to validate your instrumentation is by running <a href="#devtrace">DevTrace</a> and ensuring the new metric appears as desired.</p>

<p>After restarting your dev server with DevTrace enabled, refresh the browser page and view the trace output. The new metric should appear in the trace:</p>

<p><img src="images/custom_devtrace.png" alt="custom devtrace" /></p>

<h2 id="rake-rails-runner">Rake + Rails Runner</h2>

<p>Scout doesn&rsquo;t have a dedicated API for instrumenting <code class="prettyprint">rake</code> tasks or transactions called via <code class="prettyprint">rails runner</code>. Instead, we suggest creating basic wrapper tasks that spawn a background job in a <a href="#ruby-instrumented-libs">framework we support</a>. These jobs are automatically monitored by Scout and appear in the Scout UI under &ldquo;background jobs&rdquo;.</p>

<p>For example, the following is a CronJob that triggers the execution of an <code class="prettyprint">IntercomSync</code> background job:</p>
<pre class="highlight  tab-plaintext"><code>10 * * * * cd /home/deploy/your_app/current &amp;&amp; rails runner 'IntercomSync.perform_later'
</code></pre>
<h2 id="sneakers">Sneakers</h2>

<p>Scout doesn&rsquo;t instrument <a href="https://github.com/jondot/sneakers">Sneakers</a> (a background processing framework for Ruby and RabbitMQ) automatically. To add Sneakers instrumentation:</p>

<ul>
<li><a href="https://gist.github.com/itsderek23/685c7485a3bd020b6cdd9b1d61cb847f">Download the contents of this gist</a>. Place the file inside your application&rsquo;s <code class="prettyprint">/lib</code> folder or similar.</li>
<li>In <code class="prettyprint">config/boot.rb</code>, add: <code class="prettyprint">require File.expand_path(&#39;lib/scout_sneakers.rb&#39;, __FILE__)</code></li>
<li>In your <code class="prettyprint">Worker</code> class, immediately following the <code class="prettyprint">work</code> method, add<br/><code class="prettyprint">include ScoutApm::BackgroundJobIntegrations::Sneakers::Instruments</code>.</li>
</ul>

<p>This treats calls to the <code class="prettyprint">work</code> method as distinct transactions, named with the worker class.</p>

<p>Example usage:</p>
<pre class="highlight ruby tab-ruby"><code><span class="k">class</span> <span class="nc">BaseWorker</span>
  <span class="kp">include</span> <span class="no">Sneakers</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="c1"># Do work</span>
  <span class="k">end</span>
  <span class="c1"># This MUST be included AFTER the work method is defined.</span>
  <span class="kp">include</span> <span class="no">ScoutApm</span><span class="o">::</span><span class="no">BackgroundJobIntegrations</span><span class="o">::</span><span class="no">Sneakers</span><span class="o">::</span><span class="no">Instruments</span>
<span class="k">end</span>
</code></pre>
<h2 id="docker">Docker <img src="images/docker.png" style="float:right;width: 150px" /></h2>

<p>Scout runs within Docker containers without any special configuration.</p>

<p>It&rsquo;s common to configure Docker containers with environment variables. Scout can use <a href="#environment-variables">environment variables</a> instead of the <code class="prettyprint">scout_apm.yml</code> config file.</p>

<h2 id="heroku">Heroku <img src="images/heroku.png" style="float:right;width: 150px" /></h2>

<p>Scout runs on Heroku without any special configuration. When Scout detects that an app is being served via Heroku:</p>

<ul>
<li>Logging is set to <code class="prettyprint">STDOUT</code> vs. logging to a file. Log messages are prefixed with <code class="prettyprint">[Scout]</code> for easy filtering.</li>
<li>The dyno name (ex: <code class="prettyprint">web.1</code>) is reported vs. the dyno hostname. Dyno hostnames are dynamically generated and don&rsquo;t have any meaningful information.</li>
</ul>

<h3 id="heroku-configuration">Configuration</h3>

<p>Scout can be configured via environment variables. This means you can use <code class="prettyprint">heroku config:set</code> to configure the agent. For example, you can set the application name that appears in the Scout UI with:</p>
<pre class="highlight shell"><code>heroku config:set <span class="nv">SCOUT_NAME</span><span class="o">=</span><span class="s1">'My Heroku App'</span>
</code></pre>
<p>See the configuration section for more information on the available config settings and environment variable functionality.</p>

<h3 id="using-the-scout-heroku-add-on">Using the Scout Heroku Add-on</h3>

<p>Scout is also available as a <a href="https://elements.heroku.com/addons/scout">Heroku Add-on</a>. The add-on automates setting the proper Heroku config variables during the provisioning process.</p>

<h2 id="cloud-foundry">Cloud Foundry <img src="images/cf_logo.png" style="float:right;width: 150px" /></h2>

<p>Scout runs on Cloud Foundry without any special configuration.</p>

<p>We suggest a few configuration changes in the <code class="prettyprint">scout_apm.yml</code> file to best take advantage of Cloud Foundry:</p>

<ol>
<li>Set <code class="prettyprint">log_file_path: STDOUT</code> to send your the Scout APM log contents to the Loggregator.</li>
<li>Use the application name configured via Cloud Foundry to identify the app.</li>
<li>Override the hostname reported to Scout. Cloud Foundry hostnames are dynamically generated and don&rsquo;t have any meaningful information. We suggest using a combination of the application name and the instance index.</li>
</ol>

<p>A sample config for Cloud Foundry that implements the above suggestions:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">true</span>
  <span class="c1"># use the configured application name to identify the app.</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= ENV['VCAP_APPLICATION'] ? JSON.parse(ENV['VCAP_APPLICATION'])['application_name']</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">APP</span><span class="nv"> </span><span class="s">NAME</span><span class="nv"> </span><span class="s">(#{Rails.env})"</span> <span class="err">%</span><span class="pi">&gt;</span>
  <span class="no"># make logs available to the Loggregator</span>
  <span class="no">log_file_path: STDOUT</span>
  <span class="no"># reports w/a more identifiable instance name using the application name and instance index. ex: rails-sample.0</span>
  <span class="no">hostname: &lt;%= ENV['VCAP_APPLICATION'] ? "#{JSON.parse(ENV['VCAP_APPLICATION'])['application_name']}.#{ENV['CF_INSTANCE_INDEX']}"  : Socket.gethostname %&gt;</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<h2 id="ruby-instrumented-libs">Instrumented Libraries</h2>

<p>The following libraries are currently instrumented:</p>

<ul>
<li>Datastores

<ul>
<li>ActiveRecord</li>
<li>ElasticSearch</li>
<li>Mongoid</li>
<li>Moped</li>
<li>Redis</li>
</ul></li>
<li>Rack frameworks

<ul>
<li>Rails</li>
<li>Sinatra</li>
<li>Grape</li>
<li>Middleware</li>
</ul></li>
<li>Rails libraries

<ul>
<li>ActionView</li>
<li>ActionController</li>
</ul></li>
<li>External HTTP calls

<ul>
<li>HTTPClient</li>
<li>Net::HTTP</li>
</ul></li>
<li>Background Job Processing

<ul>
<li>Sidekiq</li>
<li>DelayedJob</li>
<li>Resque</li>
<li>Sneakers</li>
<li>Shoryuken</li>
</ul></li>
</ul>

<p>Additionally, <a href="#request-queuing">Scout can also instrument request queuing time</a>.</p>

<p>You can instrument your own code or other libraries via <a href="#ruby-custom-instrumentation">custom instrumentation</a>.</p>

<h2 id="ruby-environments">Environments</h2>

<p>It typically makes sense to treat each environment (production, staging, etc) as a separate application within Scout and ignore the development and test environments. Configure a unique app name for each environment as Scout aggregates data by the app name.</p>

<p>There are 2 approaches:</p>

<h3 id="1-modifying-your-scout_apm-yml-config-file">1. Modifying your scout_apm.yml config file</h3>

<p>Here&rsquo;s an example <code class="prettyprint">scout_apm.yml</code> configuration to achieve this:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "YOUR_APP_NAME (#{Rails.env})" %&gt;</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">true</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<h3 id="2-setting-the-scout_name-environment-variable">2. Setting the SCOUT_NAME environment variable</h3>

<p>Setting the <code class="prettyprint">SCOUT_NAME</code> and <code class="prettyprint">SCOUT_MONITOR</code> environment variables will override settings settings your <code class="prettyprint">scout_apm.yml</code> config file.</p>

<p>To isolate data for a staging environment: <code class="prettyprint">SCOUT_NAME=&quot;YOUR_APP_NAME (Staging)&quot;</code>.</p>

<p>To disable monitoring: <code class="prettyprint">SCOUT_MONITOR=false</code>.</p>

<p>See the full list of <a href="#ruby-configuration-options">configuration options</a>.</p>

<h2 id="disabling-a-node">Disabling a Node</h2>

<p>To disable Scout APM on any node in your environment, just set <code class="prettyprint">monitor: false</code> in your <code class="prettyprint">scout_apm.yml</code> configuration file on that server, and restart your app server. Example:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "YOUR_APP_NAME (#{Rails.env})" %&gt;</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<p>Since the YAML config file allows ERB evaluation, you can even programatically enable/disable nodes based on host name. This example enables Scout APM on web1 through web5:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;%= "YOUR_APP_NAME (#{Rails.env})" %&gt;</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">YOUR_KEY</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="s">&lt;%= Socket.gethostname.match(/web[1..5]/) %&gt;</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre>
<p>Aft you&rsquo;ve disabled a node in your configuration file and restarted your app server, the node show up as inactive in the UI after 10 minutes.</p>

<h2 id="ignoring-transactions">Ignoring transactions</h2>

<p>There are a couple of approaches to ignore web requests and background jobs you don&rsquo;t care to instrument. These approaches are listed below.</p>

<h3 id="by-the-web-endpoint-path-name">By the web endpoint path name</h3>

<p>You can ignore requests to web endpoints that match specific paths (like <code class="prettyprint">/health_check</code>). See the <code class="prettyprint">ignore</code> setting in the <a href="#ruby-configuration-options">configuration options</a>.</p>

<h3 id="in-your-code">In your code</h3>

<p>To selectively ignore a web request or background job in your code, add the following within the transaction:</p>
<pre class="highlight ruby tab-ruby"><code><span class="no">ScoutApm</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">ignore!</span>
</code></pre>
<h3 id="sampling-web-requests">Sampling web requests</h3>

<p>Use probability sampling to limit the number of web requests Scout analyzes:</p>
<pre class="highlight ruby tab-ruby"><code><span class="c1"># app/controllers/application_controller.rb</span>
<span class="n">before_action</span> <span class="ss">:sample_requests_for_scout</span>

<span class="k">def</span> <span class="nf">sample_requests_for_scout</span>
  <span class="c1"># Sample rate should range from 0-1:</span>
  <span class="c1"># * 0: captures no requests</span>
  <span class="c1"># * 0.75: captures 75% of requests</span>
  <span class="c1"># * 1: captures all requests</span>
  <span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">75</span>

  <span class="k">if</span> <span class="nb">rand</span> <span class="o">&gt;</span> <span class="n">sample_rate</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="s2">"[Scout] Ignoring request: </span><span class="si">#{</span><span class="n">request</span><span class="p">.</span><span class="nf">original_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="no">ScoutApm</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">ignore!</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="ignoring-all-background-jobs">Ignoring all background jobs</h3>

<p>You can ignore all background jobs by setting <code class="prettyprint">enable_background_jobs: false</code> in your configuration file. See the <a href="#ruby-configuration-options">configuration options</a>.</p>

<h2 id="overhead-considerations">Overhead Considerations</h2>

<p>Scout is built for production monitoring and is engineered to add minimal overhead. We test against several open-source benchmarks on significant releases to prevent releasing performance regressions.</p>

<p>There are a couple of scenarios worth mentioning where more overhead than expected may be observed.</p>

<h3 id="enabling-the-detailed_middleware-option">Enabling the detailed_middleware option</h3>

<p>By default, Scout aggregates all middleware timings together into a single &ldquo;Middleware&rdquo; category. Scout can provide a detailed breakdown of middleware timings by setting <code class="prettyprint">detailed_middleware: true</code> in the configuration settings.</p>

<p>This is <code class="prettyprint">false</code> by default as instrumenting each piece of middleware adds additional overhead. It&rsquo;s common for Rails apps to use more than a dozen pieces of middleware. Typically, time spent in middleware is very small and isn&rsquo;t worth instrumenting. Additionally, most of these middleware pieces are maintained by third-parties and are thus more difficult to optimize.</p>

<h3 id="resque-instrumentation">Resque Instrumentation</h3>

<p>Since Resque works by forking a child process to run each job and exiting immediately when the job is finished, our instrumentation needs a way to aggregate the timing results and traces into a central store before reporting the information to our service. To support Resque, the Resque child process sends a simple payload to the parent which is listening via WEBRick on localhost. As long as there is one WEBRick instance listening on the configured port, then any Resque children will be able to send results back to it.</p>

<p>The overhead is usually small, but it is more significant than instrumenting background job frameworks like Sidekiq and DelayedJob that do not use forking. The lighter the jobs are, more overhead is incurred in the serialization and reporting to WEBRick. In our testing, for jobs that took ~18 ms each, we found that the overhead is about ~8%. If your jobs take longer than that, on average, the overhead will be lower.</p>

          <h1 id="elixir-agent">Elixir Agent</h1>

<h2 id="elixir-requirements">Requirements</h2>

<p>Our Elixir agent supports Phoenix 1.2.0+, Ecto 2.0+, and Elixir 1.4+.</p>

<!-- old unique-ified anchor link -->

<p><a name="installation22"></a>
<h2 id="elixir-install">Installation</h2></p>

<p>Tailored instructions are provided within our user interface. General instructions for a Phoenix 1.3+ app:</p>

<div class="install">
 <p class="instruct">
      <span class="step">A</span>Add the <code>scout_apm</code> dependency.
    </p>
    <p class="smaller">Your <code>mix.exs</code> file:
    </p>
    <pre class="terminal"># mix.exs

 def deps do
   [{:phoenix, "~> 1.4.0"},
    ...
    <span>{:scout_apm, "~> 1.0"}</span>]
 end</pre>
    <p class="smaller">If your Mixfile manually specifies <code>applications</code>, <code>:scout_apm</code> must be added:</p>
    <pre class="terminal"># mix.exs
 def application do
   [mod: {YourApp, []},
    applications: [..., <span>:scout_apm</span>]]
 end
 </pre>
    <p class="smaller">
      Shell:
    </p>
    <div class="terminal">
      mix deps.get
    </div>

    <p class="instruct">
      <span class="step">B</span><span class="glyphicon glyphicon-download"></span> Download your customized config file, placing it at <code>config/scout_apm.exs</code>.
    </p>
    <p class="smaller">Your customized config file is available within your Scout account. Inside the file, replace <code>"YourApp"</code> with the app name you&rsquo;d like to appear within Scout.
    </p>
    <p class="instruct">
      <span class="step">C</span>Integrate into your Phoenix app.
    </p>

    <p class="smaller">Instrument Controllers. In <code>lib/your_app_web.ex</code>:
    </p>
    <pre class="terminal"># lib/your_app_web.ex
defmodule YourApp.Web do
  def controller do
    quote do
      use Phoenix.Controller
      <span>use ScoutApm.Instrumentation</span>
      ...</pre>

    <p class="smaller">Instrument Templates. In <code>config/config.exs</code>:
    </p>
<pre class="terminal">
# config/config.exs
<span>config :phoenix, :template_engines,
  eex: ScoutApm.Instruments.EExEngine,
  exs: ScoutApm.Instruments.ExsEngine</span>
</pre>

<p class="instruct">
  <span class="step">D</span>Integrate Ecto
</p>

    <p class="smaller">Using <strong>Ecto 2.x?</strong>. In <code>config/config.exs</code>:</p>
    <pre class="terminal">
# config/config.exs
<span>import_config "scout_apm.exs"</span>

<span>config :your_app, YourApp.Repo,
  loggers: [{Ecto.LogEntry, :log, []},
            {ScoutApm.Instruments.EctoLogger, :log, []}]</span></pre>


    <p class="smaller">Using <strong>Ecto 3.x?</strong>. In <code>lib/my_app/application.ex</code>:</p>
<pre class="terminal">
# lib/my_app/application.ex
defmodule MyApp.Application do
  use Application

  def start(_type, _args) do
    import Supervisor.Spec
    children = [
        # ...
    ]
<span>
    :ok = ScoutApm.Instruments.EctoTelemetry.attach(MyApp.Repo)
</span>
    # ...
    Supervisor.start_link(children, opts)
  end
end
</pre>


    <p class="instruct">
      <span class="step">E</span>Restart your app.
      <div class="terminal">
        mix phx.server
      </div>
    </p>

</div>

<h2 id="elixir-troubleshooting">Troubleshooting</h2>

<p>Not seeing data?</p>

<table class="help">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td><td>
        <p>Examine your log file for any lines that match <code>Scout</code>.</p>

        <p>Look for:</p>

<pre class="terminal">
[info] Setup ScoutApm.Watcher on ScoutApm.Store
[info] Setup ScoutApm.Watcher on ScoutApm.Config
[info] Setup ScoutApm.Watcher on ScoutApm.PersistentHistogram
[info] Setup ScoutApm.Watcher on ScoutApm.Logger
[info] Setup ScoutApm.Watcher on ScoutApm.Supervisor</pre>

        <p>
          If none of the above appears, ensure <code>scout_apm</code> was added as a dependency. See the first step in the <a href="#elixir-install">Elixir install instructions</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td>
      <p>Run <code>mix scout.test_config</code> in your terminal to check for any configuration issues</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td>
        <p>Is <code>use ScoutApm.Instrumentation</code> specified in <em>every</em> controller module you wish to instrument?</p>

        <p>
          This step is frequently missed if you are using multiple controller modules. See the third step in the <a href="#elixir-install">Elixir install instructions</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">4</span>
      </td>
      <td>
        <p>Still stuck? Email us.</p>

        The following process helps us resolve issues faster:
         <ul>
            <li>Increase the log level of <code>scout_apm</code> by setting <code>log_level: "debug"</code> in your <code>config/scout_apm.exs</code> file and restart your app.</li>
            <li>
              Wait five minutes, then email <a href="mailto:support@scoutapm.com">support@scoutapm.com</a> 
              your log output and the application&rsquo;s <code>mix.lock</code> file.</li>
          </ul>

        <p>We typically respond within a couple of hours during the business day.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="elixir-configuration">Configuration</h2>

<p>The Elixir agent can be configured via the <code class="prettyprint">config/scout_apm.exs</code> file. A config file with your organization key is available for download as part of the install instructions. A application name and key is required:</p>
<pre class="highlight  tab-plaintext"><code>config :scout_apm,
  name: "Your App", # The app name that will appear within the Scout UI
  key: "YOUR SCOUT KEY"
</code></pre>
<p>Alternately, you can also use environment variables of your choosing by formatting your configuration as a tuple
with :system as the first value and the environment variable expected as the second.</p>
<pre class="highlight  tab-plaintext"><code>config :scout_apm,
  name: { :system, "SCOUT_APP_NAME" },
  key: { :system, "SCOUT_APP_KEY" }
</code></pre>
<h3 id="configuration-reference">Configuration Reference</h3>

<p>The following configuration settings are available:</p>

<table class="lookup">
  <thead>
    <tr>
      <th>
        Setting&nbsp;Name
      </th>
      <th>
        Description
      </th>
      <th>
        Default
      </th>
      <th>
        Required
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>
        name
      </th>
      <td>
        Name of the application (ex: &lsquo;Photos App&rsquo;).
      </td>
      <td>       
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        monitor
      </th>
      <td>
        Whether monitoring data should be reported.
      </td>
      <td>
        <code>true</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        key
      </th>
      <td>
        The organization API key.
      </td>
      <td></td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        dev_trace
      </th>
      <td>
        Indicates if DevTrace, the Scout development profiler, should be enabled.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        host
      </th>
      <td>
        The protocol + domain where the agent should report.
      </td>
      <td>
        <code>https://scoutapm.com</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        log_level
      </th>
      <td>
        The logging level of the agent. Possible values: <code>:debug</code>, <code>:info</code>, <code>:warn</code>, and <code>:error</code>.
      </td>
      <td>
        <code>:info</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        revision_sha
      </th>
      <td>
        The Git SHA associated with this release.
      </td>
      <td>
        <a href="#elixir-deploy-tracking-config">See docs</a>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        ignore
      </th>
      <td>
        An array of URL prefixes to ignore in the Scout Plug instrumentation. Routes that match the prefixed path (ex: <code>['/health', '/status']</code>) will be ignored by the agent.
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_dir
      </th>
      <td>
        Path to create the directory which will store the <a href="#core-agent">Core Agent</a>.
      </td>
      <td>
        <code>/tmp/scout_apm_core</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_download
      </th>
      <td>
        Whether to download the <a href="#core-agent">Core Agent</a> automatically, if needed.
      </td>
      <td>
        <code>True</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_launch
      </th>
      <td>
        Whether to start the <a href="#core-agent">Core Agent</a> automatically, if needed.
      </td>
      <td>
        <code>True</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_tcp_ip
      </th>
      <td>
        The TCP IP address the <a href="#core-agent">Core Agent</a> uses to communicate with your application.
      </td>
      <td>
        <code>{127, 0, 0, 1}</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_tcp_port
      </th>
      <td>
        The TCP port the <a href="#core-agent">Core Agent</a> uses to communicate with your application.
      </td>
      <td>
        <code>9000</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_triple
      </th>
      <td>
        If you are running a MUSL based Linux (such as ArchLinux), you may need to explicitly specify the platform triple. E.g. <code>x86_64-unknown-linux-musl</code>
      </td>
      <td>
        Auto detected
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        hostname
      </th>
      <td>
        The host registered with the <a href="#core-agent">.
      </td>
      <td>
      </td>
      <td>
        No
      </td>
    </tr>
  </tbody>
</table>

<h2 id="elixir-upgrade">Updating to the Newest Version</h2>

<div class="install">

 <p class="instruct">
  <span class="step">A</span>Ensure your <code>mix.exs</code> dependency entry for <code>scout_apm</code> is: <code>{:scout_apm, "~> 0.0"}`</code>
 </p>

 <p class="instruct">
  <span class="step">B</span><span class="terminal">mix deps.get scout_apm</span>
 </p>

  <p class="instruct">
    <span class="step">C</span>Recompile and deploy.
 </p>


</div>

<h2 id="elixir-deploy-tracking-config">Deploy Tracking Config</h2>

<p>Scout can <a href="#deploy-tracking">track deploys</a>, making it easier to correlate changes in your app to performance. To enable deploy tracking, first ensure you are on the latest version of <code class="prettyprint">scout_apm</code>. See our <a href="#elixir-upgrade">upgrade instructions</a>.</p>

<p>Scout identifies deploys via the following:</p>

<ol>
<li>A <code class="prettyprint">revision_sha</code> config setting.</li>
<li>A <code class="prettyprint">SCOUT_REVISION_SHA</code> environment variable equal to the SHA of your latest release.</li>
<li>If you are using Heroku, enable <a href="https://devcenter.heroku.com/articles/dyno-metadata">Dyno Metadata</a>. This adds a <code class="prettyprint">HEROKU_SLUG_COMMIT</code> environment variable to your dynos, which Scout then associates with deploys.</li>
</ol>

<h2 id="elixir-instrumented-libaries">Auto-Instrumented Libraries</h2>

<p>Our <a href="#elixir-install">install instructions</a> walk through instrumenting the following libraries:</p>

<ul>
<li>Phoenix

<ul>
<li>controllers</li>
<li>views</li>
<li>templates</li>
</ul></li>
<li>Ecto 2.0/3.0</li>
<li>Slime Templates</li>
</ul>

<p>See <a href="/#instrumenting-common-libraries">instrumenting common libraries</a> for guides on instrumenting other Elixir libraries.</p>

<h2 id="instrumenting-common-libraries">Instrumenting Common Libraries</h2>

<p>We&rsquo;ve collected best practices for instrumenting common transactions and timing functions below. If you have a suggestion, <a href="mailto:support@scoutapm.com">please share it</a>. See our <a href="#elixir-custom-instrumentation">custom instrumentation quickstart</a> for more details on adding instrumentation.</p>

<ul>
<li>Transactions

<ul>
<li><a href="#phoenix-channels">Phoenix Channels</a></li>
<li><a href="#plug-chunked-response-http-streaming">Plug Chunked Response</a></li>
<li><a href="#genserver-calls">GenServer calls</a></li>
<li><a href="#task-start">Task.start</a></li>
<li><a href="#task-supervisor-start_child">Task.Supervisor.start_child</a></li>
<li><a href="#exq">Exq</a></li>
<li><a href="#absinthe">Absinthe (GraphQL)</a></li>
</ul></li>
<li>Timing

<ul>
<li><a href="#httpoison">HTTPoison</a></li>
<li><a href="#mongodb-ecto">MongoDB Ecto</a></li>
</ul></li>
</ul>

<h3 id="phoenix-channels">Phoenix Channels</h3>

<h4 id="web-or-background-transactions">Web or background transactions?</h4>

<ul>
<li><strong>web</strong>: For channel-related functions that impact the user-facing experience. Time spent in these transactions will appear on your app overboard dashboard and appear in the &ldquo;Web&rdquo; area of the UI.</li>
<li><strong>background</strong>: For functions that don&rsquo;t have an impact on the user-facing experience (example: click-tracking). These will be available in the &ldquo;Background Jobs&rdquo; area of the UI.</li>
</ul>

<h4 id="naming-channel-transactions">Naming channel transactions</h4>

<p>Provide an identifiable name based on the message the <code class="prettyprint">handle_out/</code> or <code class="prettyprint">handle_in/</code> function receives.</p>

<p>An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">FirestormWeb</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">PostsChannel</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">FirestormWeb</span><span class="o">.</span><span class="no">Web</span><span class="p">,</span> <span class="ss">:channel</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Web" in the UI, named "PostsChannel.update"</span>
  <span class="nv">@transaction_opts</span> <span class="p">[</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">web"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">PostsChannel.update"</span><span class="p">]</span>
  <span class="n">deftransaction</span> <span class="n">handle_out</span><span class="p">(</span><span class="sd">"</span><span class="s2">update"</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">push</span> <span class="n">socket</span><span class="p">,</span> <span class="sd">"</span><span class="s2">update"</span><span class="p">,</span> <span class="no">FetchView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="sd">"</span><span class="s2">index.json"</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="plug-chunked-response-http-streaming">Plug Chunked Response (HTTP Streaming)</h3>

<p>In a Plug application, a chunked response needs to be instrumented directly, rather than relying on
the default Scout instrumentation Plug. The key part is to <code class="prettyprint">start_layer</code> beforehand, and then call
<code class="prettyprint">before_send</code> after the chunked response is complete.</p>
<pre class="highlight  tab-plaintext"><code>def chunked(conn, _params) do
  # The "Controller" argument is required, and should not be changed. The second argument is the
  # name this endpoint will appear as in the Scout UI. The `action_name` function determines this
  # automatically.
  ScoutApm.TrackedRequest.start_layer("Controller", ScoutApm.Plugs.ControllerTimer.action_name(conn))

  conn =
    conn
    |&gt; put_resp_content_type("text/plain")
    |&gt; send_chunked(200)

  {:ok, conn} =
    Repo.transaction(fn -&gt;
      Example.build_chunked_query(...)
      |&gt; Enum.reduce_while(conn, fn data, conn -&gt;
        case chunk(conn, data) do
          {:ok, conn} -&gt;
            {:cont, conn}

          {:error, :closed} -&gt;
            {:halt, conn}
        end
      end)
    end)

  ScoutApm.Plugs.ControllerTimer.before_send(conn)

  conn
end
</code></pre>
<p>Then have the default instrumentation ignore the endpoint&rsquo;s URL prefix (since it is manually instrumented now).
See the <a href="#ignore-1">ignore configuration</a> for more details.</p>
<pre class="highlight  tab-plaintext"><code>config :scout_apm,
  name: "My Scout App Name",
  key: "My Scout Key",
  ignore: ["/chunked"]
</code></pre>
<h3 id="genserver-calls">GenServer calls</h3>

<p>It&rsquo;s common to use <code class="prettyprint">GenServer</code> to handle background work outside the web request flow. Suggestions:</p>

<ul>
<li>Treat these as <code class="prettyprint">background</code> transactions</li>
<li>Provide a <code class="prettyprint">name</code> based on the message each <code class="prettyprint">handle_call/</code> function handles.</li>
</ul>

<p>An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Flight</span><span class="o">.</span><span class="no">Checker</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenServer</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Background Jobs" in the UI, named "Flight.handle_check".</span>
  <span class="nv">@transaction_opts</span> <span class="p">[</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">background"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">check"</span><span class="p">]</span>
  <span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:check</span><span class="p">,</span> <span class="n">flight</span><span class="p">},</span> <span class="n">_from</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># Do work...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="task-start">Task.start</h3>

<p>These execute asynchronously, so treat as a <code class="prettyprint">background</code> transaction.</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">Task</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="c1"># Will appear under "Background Jobs" in the UI, named "Crawler.crawl".</span>
  <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="ss">:background</span><span class="p">,</span><span class="sd">"</span><span class="s2">Crawler.crawl"</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Crawler</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
<h3 id="task-supervisor-start_child">Task.Supervisor.start_child</h3>

<p>Like <code class="prettyprint">Task.start</code>, these execute asynchronously, so treat as a <code class="prettyprint">background</code> transaction.</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">YourApp</span><span class="o">.</span><span class="no">TaskSupervisor</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="c1"># Will appear under "Background Jobs" in the UI, named "Crawler.crawl".</span>
  <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="ss">:background</span><span class="p">,</span><span class="sd">"</span><span class="s2">Crawler.crawl"</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Crawler</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
<h3 id="exq">Exq</h3>

<p>To instrument <a href="https://github.com/akira/exq">Exq</a> background jobs, <code class="prettyprint">import ScoutApm.Tracing</code>, use <code class="prettyprint">deftransaction</code> to define the function, and add a <code class="prettyprint">@transaction_opts</code> module attribute to optionally override the name and type:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">MyWorker</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Background Jobs" in the UI, named "MyWorker.perform".</span>
  <span class="nv">@transaction_opts</span> <span class="p">[</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">background"</span><span class="p">]</span>
  <span class="n">deftransaction</span> <span class="n">perform</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># do work</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="absinthe">Absinthe</h3>

<p>Requests to the Absinthe plug can be grouped by the GraphQL <code class="prettyprint">operationName</code> under the &ldquo;Web&rdquo; UI by adding <a href="https://gist.github.com/itsderek23/d9435b21c9a44cd9629e93c4e8c2750e" target="_blank">this plug</a> to your pipeline.  </p>

<h3 id="httpoison">HTTPoison</h3>

<p>Download this <a href="https://gist.github.com/itsderek23/048eaf813af4a1a31a219d75221eb7b7" target="_blank">Demo.HTTPClient module</a> (you can rename to something more fitting) into your app&rsquo;s <code class="prettyprint">/lib</code> folder, then <code class="prettyprint">alias Demo.HTTPClient</code> when calling <code class="prettyprint">HTTPoison</code> functions:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Demo</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">PageController</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Demo</span><span class="o">.</span><span class="no">Web</span><span class="p">,</span> <span class="ss">:controller</span>
  <span class="c1"># Will route function calls to `HTTPoision` through `Demo.HTTPClient`, which times the execution of the HTTP call.</span>
  <span class="n">alias</span> <span class="no">Demo</span><span class="o">.</span><span class="no">HTTPClient</span>

  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># "HTTP" will appear on timeseries charts. "HTTP/get" and the url "https://cnn.com" will appear in traces.</span>
    <span class="k">case</span> <span class="no">HTTPClient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sd">"</span><span class="s2">https://cnn.com"</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">%</span><span class="no">HTTPoison</span><span class="o">.</span><span class="no">Response</span><span class="p">{}</span> <span class="o">=</span> <span class="n">response</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="c1"># do something with response</span>
        <span class="n">render</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">index.html"</span><span class="p">)</span>
      <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="p">%</span><span class="no">HTTPoison</span><span class="o">.</span><span class="no">Error</span><span class="p">{}</span> <span class="o">=</span> <span class="n">error</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="c1"># do something with error</span>
        <span class="n">render</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">error.html"</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="no">HTTPClient</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sd">"</span><span class="s2">https://cnn.com"</span><span class="p">,</span> <span class="sd">"</span><span class="s2">"</span><span class="p">)</span>
    <span class="no">HTTPClient</span><span class="o">.</span><span class="n">get!</span><span class="p">(</span><span class="sd">"</span><span class="s2">http://localhost:4567"</span><span class="p">)</span>
    <span class="n">render</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">index.html"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="mongodb-ecto">MongoDB Ecto</h3>

<p>Download <a href="https://gist.github.com/itsderek23/051327a152bc4d95451fd76808b8e83f" target="_blank">this example MongoDB Repo module</a> to use inplace of your existing MongoDB Repo module.</p>

<h2 id="elixir-custom-instrumentation">Custom Instrumentation</h2>

<p>You can extend Scout to record additional types of transactions (background jobs, for example) and time the execution of code that fall outside our auto instrumentation.</p>

<p>For full details on instrumentation functions, see our <a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html" target="_blank">ScoutApm.Tracing Hex docs</a>.</p>

<h3 id="transactions-timing">Transactions &amp; Timing</h3>

<p>Scout’s instrumentation is divided into 2 areas:</p>

<ol>
<li><strong>Transactions</strong>: these wrap around a flow of work, like a web request or a GenServer call. The UI groups data under transactions. Use the <code class="prettyprint">deftransaction/2</code> macro or wrap blocks of code with the <code class="prettyprint">transaction/4</code> macro.</li>
<li><strong>Timing</strong>: these measure individual pieces of work, like an HTTP request to an outside service or an Ecto query, and displays timing information within a transaction trace. Use the <code class="prettyprint">deftiming/2</code> macro or the <code class="prettyprint">timing/4</code> macro.</li>
</ol>

<h3 id="instrumenting-transactions">Instrumenting transactions</h3>

<h4 id="deftransaction-macro-example">deftransaction Macro Example</h4>

<p>Replace your function <code class="prettyprint">def</code> with <code class="prettyprint">deftransaction</code> to instrument it. You can override the name and type by setting the <code class="prettyprint">@transaction_opts</code> attribute right before the function.</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">YourApp</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">RoomChannel</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">Channel</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Will appear under "Web" in the UI, named "YourApp.Web.RoomChannel.join".</span>
  <span class="nv">@transaction_opts</span> <span class="p">[</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">web"</span><span class="p">]</span>
  <span class="n">deftransaction</span> <span class="n">join</span><span class="p">(</span><span class="sd">"</span><span class="s2">topic:html"</span><span class="p">,</span> <span class="n">_message</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># Will appear under "Background Jobs" in the UI, named "RoomChannel.ping".</span>
  <span class="nv">@transaction_opts</span> <span class="p">[</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">background"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">RoomChannel.ping"</span><span class="p">]</span>
  <span class="n">deftransaction</span> <span class="n">handle_in</span><span class="p">(</span><span class="sd">"</span><span class="s2">ping"</span><span class="p">,</span> <span class="p">%{</span><span class="sd">"</span><span class="s2">body"</span> <span class="o">=&gt;</span> <span class="n">body</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">broadcast!</span> <span class="n">socket</span><span class="p">,</span> <span class="sd">"</span><span class="s2">new_msg"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">body:</span> <span class="n">body</span><span class="p">}</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
</code></pre>
<h4 id="transaction-4-example">transaction/4 Example</h4>

<p>Wrap the block of code you&rsquo;d like to instrument with <code class="prettyprint">transaction/4</code>:</p>
<pre class="highlight elixir tab-elixir"><code><span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracking</span>

<span class="k">def</span> <span class="n">do_async_work</span> <span class="k">do</span>
  <span class="no">Task</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
    <span class="c1"># Will appear under "Background Jobs" in the UI, named "Do Work".</span>
    <span class="n">transaction</span><span class="p">(</span><span class="ss">:background</span><span class="p">,</span> <span class="sd">"</span><span class="s2">Do Work"</span><span class="p">)</span> <span class="k">do</span>
      <span class="c1"># Do work...</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<p>See the <a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html" target="_blank">ScoutApm.Tracing Hexdocs</a> for details on instrumenting transactions.</p>

<h3 id="timing-functions-and-blocks-of-code">Timing functions and blocks of code</h3>

<h4 id="deftiming-macro-example">deftiming Macro Example</h4>

<p>Replace your function <code class="prettyprint">def</code> with <code class="prettyprint">deftiming</code> to instrument it. You can override the name and category by setting the <code class="prettyprint">@timing_opts</code> attribute right before the function.</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Searcher</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="c1"># Time associated with this function will appear under "Hound" in timeseries charts.</span>
  <span class="c1"># The function will appear as `Hound/open_search` in transaction traces.</span>
  <span class="nv">@timing_opts</span> <span class="p">[</span><span class="ss">category:</span> <span class="sd">"</span><span class="s2">Hound"</span><span class="p">]</span>
  <span class="n">deftiming</span> <span class="n">open_search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">navigate_to</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Time associated with this function will appear under "Hound" in timeseries charts.</span>
  <span class="c1"># The function will appear as `Hound/homepage` in transaction traces.</span>
  <span class="nv">@timing_opts</span> <span class="p">[</span><span class="ss">category:</span> <span class="sd">"</span><span class="s2">Hound"</span><span class="p">,</span> <span class="ss">name:</span> <span class="sd">"</span><span class="s2">homepage"</span><span class="p">]</span>
  <span class="n">deftiming</span> <span class="n">open_homepage</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">navigate_to</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<h4 id="timing-4-example">timing/4 Example</h4>

<p>Wrap the block of code you&rsquo;d like to instrument with <code class="prettyprint">timing/4</code>:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">PhoenixApp</span><span class="o">.</span><span class="no">PageController</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">PhoenixApp</span><span class="o">.</span><span class="no">Web</span><span class="p">,</span> <span class="ss">:controller</span>
  <span class="kn">import</span> <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span>

  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">timing</span><span class="p">(</span><span class="sd">"</span><span class="s2">Timer"</span><span class="p">,</span> <span class="sd">"</span><span class="s2">sleep"</span><span class="p">)</span> <span class="k">do</span>
      <span class="ss">:timer</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="m">3000</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">render</span> <span class="n">conn</span><span class="p">,</span> <span class="sd">"</span><span class="s2">index.html"</span>
  <span class="k">end</span>
</code></pre>
<p>See the <a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html" target="_blank">ScoutApm.Tracing Hexdocs</a> for details on timing functions and blocks of code.</p>

<h4 id="limits-on-category-arity">Limits on category arity</h4>

<p>We limit the number of unique categories that can be instrumented. Tracking too many unique category can impact the performance of our UI. Do not dynamically generate categories in your instrumentation (ie <code class="prettyprint">timing(&quot;user_#{user.id}&quot;, &quot;generate&quot;, do: do_work())</code> as this can quickly exceed our rate limits.</p>

<h4 id="adding-a-description">Adding a description</h4>

<p>Call <code class="prettyprint">ScoutApm.Tracing.update_desc/1</code> to add relevant information to the instrumented item. This description is then viewable in traces. An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="n">timing</span><span class="p">(</span><span class="sd">"</span><span class="s2">HTTP"</span><span class="p">,</span> <span class="sd">"</span><span class="s2">GitHub_Avatar"</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">url</span> <span class="o">=</span> <span class="sd">"</span><span class="s2">https://github.com/</span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.png"</span>
  <span class="n">update_desc</span><span class="p">(</span><span class="sd">"</span><span class="s2">GET </span><span class="si">#{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="no">HTTPoison</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<h4 id="tracking-already-executed-time">Tracking already executed time</h4>

<p>Libraries like Ecto log details on executed queries. This includes timing information. To add a trace item for this, use <code class="prettyprint">ScoutApm.Tracing.track</code>. An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">YourApp</span><span class="o">.</span><span class="no">Mongo</span><span class="o">.</span><span class="no">Repo</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Ecto</span><span class="o">.</span><span class="no">Repo</span>

  <span class="c1"># Scout instrumentation of Mongo queries. These appear in traces as "Ecto/Read", "Ecto/Write", etc.</span>
  <span class="k">def</span> <span class="n">log</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">ScoutApm</span><span class="o">.</span><span class="no">Tracing</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
      <span class="sd">"</span><span class="s2">Ecto"</span><span class="p">,</span>
      <span class="n">query_name</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span>
      <span class="n">entry</span><span class="o">.</span><span class="n">query_time</span><span class="p">,</span>
      <span class="ss">:microseconds</span>
    <span class="p">)</span>
    <span class="kn">super</span> <span class="n">entry</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre>
<p>In the example above, the metric will appear in traces as <code class="prettyprint">Ecto/#{query_time(entry)}</code>. On timeseries charts, the time will be allocated to <code class="prettyprint">Ecto</code>.</p>

<p><a href="https://hexdocs.pm/scout_apm/ScoutApm.Tracing.html#track/5" target="_blank">See the scout_apm hex docs</a> for more information on <code class="prettyprint">track/</code>.</p>

<h3 id="elixir-testing-instrumentation">Testing instrumentation</h3>

<p>Improper instrumentation can break your application. It&rsquo;s important to test before deploying to production. The easiest way to validate your instrumentation is by running <a href="#elixir-devtrace">DevTrace</a> and ensuring the new metric appears as desired.</p>

<p>After restarting your app with DevTrace enabled, refresh the browser page and view the trace output. The new metric should appear in the trace.</p>

<h2 id="elixir-custom-context">Custom Context</h2>

<p><a href="#context">Context</a> lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>It&rsquo;s simple to add <a href="#context">custom context</a> to your app. There are two types of context:</p>

<h3 id="user-context">User Context</h3>

<p>For context used to identify users (ex: email, name):</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre>
<h3 id="general-context">General Context</h3>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
<p>Examples:</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:account</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="no">ScoutApm</span><span class="o">.</span><span class="no">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:monthly_spend</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">monthly_spend</span><span class="p">)</span>
</code></pre>
<h3 id="default-context">Default Context</h3>

<p>Scout reports the Request URI and the user&rsquo;s remote IP Address by default.</p>

<h3 id="context-value-types">Context Value Types</h3>

<p>Context values can be any of the following types:</p>

<ul>
<li>Printable strings (<code class="prettyprint">String/printable?/1</code> returns <code class="prettyprint">true</code>)</li>
<li>Boolean</li>
<li>Number</li>
</ul>

<h3 id="context-key-restrictions">Context Key Restrictions</h3>

<p>Context keys can be an <code class="prettyprint">Atom</code> or <code class="prettyprint">String</code> with only printable characters. Custom context keys may contain alphanumeric characters, dashes, and underscores. Spaces are not allowed.</p>

<p>Attempts to add invalid context will be ignored.</p>

<h2 id="elixir-environments">Environments</h2>

<p>It typically makes sense to treat each environment (production, staging, etc) as a separate application within Scout. To do so, configure a unique app name for each environment. Scout aggregates data by the app name.</p>

<p>An example:</p>
<pre class="highlight elixir tab-elixir"><code><span class="c1"># config/staging.exs</span>

<span class="n">config</span> <span class="ss">:scout_apm</span><span class="p">,</span>
  <span class="ss">name:</span> <span class="sd">"</span><span class="s2">YOUR APP - Staging"</span>
</code></pre>
<h2 id="elixir-ignoring-transactions">Ignoring Transactions</h2>

<p>There are a couple of approaches to ignore web requests and background jobs you don&rsquo;t care to instrument. These approaches are listed below.</p>

<h3 id="by-the-web-endpoint-path-name">By the web endpoint path name</h3>

<p>You can ignore requests to web endpoints that match specific paths (like <code class="prettyprint">/health_check</code>). See the <code class="prettyprint">ignore</code> setting in the <a href="#elixir-configuration">configuration options</a>.</p>

<h3 id="in-your-code">In your code</h3>

<p>To selectively ignore a web request or background job in your code, add the following within the transaction:</p>
<pre class="highlight elixir tab-elixir"><code><span class="no">ScoutApm</span><span class="o">.</span><span class="no">TrackedRequest</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>
</code></pre>
<!-- old reference -->

<p><a name="enabling-devtrace30"></a>
<h2 id="elixir-devtrace">Enabling DevTrace</h2></p>

<aside class="notice" style="font-size: 12px">
Follow the <a href="#elixir-install">install instructions</a> first. There&rsquo;s no need to download the config file as signup isn&rsquo;t required.
</aside>

<p>To enable <a href="#devtrace">DevTrace</a>, our in-browser profiler:</p>

<table class="help install">
  <tbody>
    <tr>
      <td><span class="step">1</span></td>
      <td>
        <p style="line-height: 170%">
          Add <code>dev_trace: true</code> to the <code>scout_apm</code> section of your <code>config/dev.exs</code>  file:
        </p>
<pre>
# config/dev.exs
config :scout_apm,
  dev_trace: true
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="vertical-align: middle">
        <p style="line-height: initial">Restart your app.</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">3</span>
      </td>
      <td style="vertical-align: middle">
        <p style="line-height: initial">Refresh your browser window and look for the speed badge.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="elixir-server-timing">Server Timing</h2>

<p>View performance metrics (time spent in Controller, Ecto, etc) for each of your app&rsquo;s requests in Chrome’s Developer tools with the <a href="https://github.com/scoutapp/elixir_plug_server_timing">plug_server_timing</a> package. Production-safe.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/scout-blog/elixir_server_timing.png" alt="server timing" /></p>

<p>For install instructions and configuration options, see <a href="https://github.com/scoutapp/elixir_plug_server_timing">plug_server_timing</a> on GitHub.</p>

          <h1 id="python-agent">Python Agent</h1>

<p>Scout&rsquo;s Python agent supports many popular libraries to instrument template rendering, SQL queries, template rendering, and more.
The package is called <code class="prettyprint">scout-apm</code> <a href="https://pypi.org/project/scout-apm">on PyPI</a>.
Source code and issues can be found on our <a href="https://github.com/scoutapp/scout_apm_python">scout_apm_python</a> GitHub repository.</p>

<h2 id="python-requirements">Requirements</h2>

<p><code class="prettyprint">scout-apm</code> requires :</p>

<ul>
<li>Python 2.7 or 3.4+</li>
<li>A POSIX operating system, such as Linux or macOS (<a href="https://github.com/scoutapp/scout_apm_python/issues/101">Request Windows support</a>).</li>
</ul>

<h2 id="python-instrumented-libraries">Instrumented Libraries</h2>

<p>Scout provides instrument for most of the popular Python libraries. Instrumentation may require some configuration (<code class="prettyprint">Django</code>) or is automatically applied (<code class="prettyprint">Requests</code>) by our agent.</p>

<h3 id="some-configuration-required">Some configuration required</h3>

<p>The libraries below require a small number of configuration updates. Click on the respective library for instructions.</p>

<ul>
<li><a href="#bottle">Bottle</a></li>
<li><a href="#celery">Celery</a></li>
<li><a href="#dash">Dash</a></li>
<li><a href="#django">Django</a>

<ul>
<li>Middleware</li>
<li>Templates (compiling &amp; rendering)</li>
<li>Template blocks</li>
<li>SQL queries</li>
</ul></li>
<li><a href="#dramatiq">Dramatiq</a></li>
<li><a href="#falcon">Falcon</a></li>
<li><a href="#flask">Flask</a></li>
<li><a href="#flask-sqlalchemy">Flask SQLAlchemy</a></li>
<li><a href="#huey">Huey</a></li>
<li><a href="#nameko">Nameko</a></li>
<li><a href="#pyramid">Pyramid</a></li>
<li><a href="#sqlalchemy">SQLAlchemy</a></li>
</ul>

<h3 id="automatically-applied">Automatically applied</h3>

<p>The libraries below are automatically detected by the agent during the startup process and do not require explicit configuration to add instrumentation.</p>

<ul>
<li>ElasticSearch</li>
<li>Jinja2</li>
<li>PyMongo</li>
<li>Redis</li>
<li>Requests</li>
<li>UrlLib3</li>
</ul>

<p>You can instrument your own code or other libraries via <a href="#python-custom-instrumentation">custom instrumentation</a>. You can suggest additional libraries you&rsquo;d like Scout to instrument <a href="https://github.com/scoutapp/scout_apm_python/issues">on GitHub</a>.</p>

<h2 id="bottle">Bottle</h2>

<p>General instructions for a Bottle app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Add Scout to your Bottle config:</p>

<pre style="width:initial">
from scout_apm.bottle import ScoutPlugin

app = bottle.default_app()
app.config.update({
    "scout.name": "YOUR_APP_NAME",
    "scout.key": "YOUR_KEY",
    "scout.monitor": True,
})

scout = ScoutPlugin()
bottle.install(scout)
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> and remove the call to <code>app.config.update</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="celery">Celery</h2>

<p>Scout supports Celery 3.1+.</p>

<p>Add the following to instrument Celery workers:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Configure Scout in your <code>settings.py</code> file:</p>
<pre class="terminal" style="width: initial">
<span>import scout_apm.celery</span>
<span>from scout_apm.api import Config</span>
from celery import Celery

app = Celery('tasks', backend='redis://localhost', broker='redis://localhost')
<span>
Config.set(
    key="[AVAILABLE IN THE SCOUT UI]",
    name="Same as Web App Name",
    monitor=True,
)
</span>
<span>scout_apm.celery.install()</span>
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> instead of calling <code>Config.set</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
        <p>Tasks will appear in the &ldquo;Background Jobs&rdquo; area of the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="dash">Dash</h2>

<p><a href="https://dash.plot.ly/">Plotly Dash</a> is built on top of Flask. Therefore you should use the Scout Flask integration with the underlying Flask application object. For example:</p>

<pre style="width:500px">
import dash
from scout_apm.flask import ScoutApm

app = dash.Dash("myapp")
app.config.suppress_callback_exceptions = True
flask_app = app.server

# Setup as per Flask integration
ScoutApm(flask_app)
flask_app.config["SCOUT_NAME"] = "A FRIENDLY NAME FOR YOUR APP"
</pre>

<p>For full instructions, see <a href="#flask">the Flask integration</a>.</p>

<h2 id="django">Django</h2>

<p>Scout supports Django 1.8+.</p>

<p>General instructions for a Django app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Configure Scout in your <code>settings.py</code> file:</p>
<pre style="width:500px">
# settings.py
INSTALLED_APPS = [
    "scout_apm.django",  # should be listed first
    # ... other apps ...
]

# Scout settings
SCOUT_MONITOR = True
SCOUT_KEY = "[AVAILABLE IN THE SCOUT UI]"
SCOUT_NAME = "A FRIENDLY NAME FOR YOUR APP"
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> instead of providing these settings in <code>settings.py</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h3 id="middleware">Middleware</h3>

<p>Scout automatically inserts its middleware into your settings on Django startup in its <a href="https://docs.djangoproject.com/en/dev/ref/applications/#django.apps.AppConfig.ready"><code class="prettyprint">AppConfig.ready()</code></a>.
It adds one at the very start of the middleware stack, and one at the end, allowing it to profile your middleware and views.</p>

<p>This normally works just fine.
However, if you need to customize the middleware order or prevent your settings being changed, you can include the Scout middleware classes in your settings yourself.
Scout will detect this and not automatically insert its middleware.</p>

<p>If you do customize, your metrics will be affected.
Anything included before the first <em>middleware timing</em> middleware will not be profiled by Scout at all (unless you add custom instrumentation).
Anything included after the <em>view</em> middleware will be profiled as part of your view, rather than as middleware.</p>

<p>To add the middleware if you&rsquo;re using new-style Django middleware in the <a href="https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-MIDDLEWARE"><code class="prettyprint">MIDDLEWARE</code> setting</a>, which was added in Django 1.10:</p>

<pre style="width:500px">
# settings.py
MIDDLEWARE = [
    # ... any middleware to run first ...
    "scout_apm.django.middleware.MiddlewareTimingMiddleware",
    # ... your normal middleware stack ...
    "scout_apm.django.middleware.ViewTimingMiddleware",
    # ... any middleware to run last ...
]
</pre>

<p>To add the middleware if you&rsquo;re using old-style Django middleware in the <a href="https://docs.djangoproject.com/en/1.8/ref/settings/#std:setting-MIDDLEWARE_CLASSES"><code class="prettyprint">MIDDLEWARE_SETTINGS</code> setting</a>, which was removed in Django 2.0:</p>

<pre style="width:500px">
# settings.py
MIDDLEWARE_CLASSES = [
    # ... any middleware to run first ...
    "scout_apm.django.middleware.OldStyleMiddlewareTimingMiddleware",
    # ... your normal middleware stack ...
    "scout_apm.django.middleware.OldStyleViewMiddleware",
    # ... any middleware to run last ...
]
</pre>

<h2 id="dramatiq">Dramatiq</h2>

<p>Scout supports Dramatiq 1.0+.</p>

<p>Add the following to instrument Dramatiq workers:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Add Scout to your Dramatiq broker:</p>
<pre class="terminal" style="width: initial">
import dramatiq
from dramatiq.brokers.rabbitmq import RabbitmqBroker
<span>from scout_apm.dramatiq import ScoutMiddleware</span>
<span>from scout_apm.api import Config</span>

broker = RabbitmqBroker()
<span>broker.add_middleware(ScoutMiddleware(), before=broker.middleware[0].__class__)</span>

<span>
Config.set(
    key="[AVAILABLE IN THE SCOUT UI]",
    name="Same as Web App Name",
    monitor=True,
)
</span>
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> instead of calling <code>Config.set</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
        <p>Tasks will appear in the &ldquo;Background Jobs&rdquo; area of the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="falcon">Falcon</h2>

<p>Scout supports Falcon 2.0+.</p>

<p>General instructions for a Falcon app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Attach the Scout middleware to your Falcon app:</p>

<pre style="width:initial">
import falcon
from scout_apm.falcon import ScoutMiddleware

scout_middleware = ScoutMiddleware(config={
    "key": "[AVAILABLE IN THE SCOUT UI]",
    "monitor": True,
    "name": "A FRIENDLY NAME FOR YOUR APP",
})
api = falcon.API(middleware=[ScoutMiddleware()])
# Required for accessing extra per-request information
scout_middleware.set_api(api)
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> and pass an empty dictionary to <code>config</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="flask">Flask</h2>

<p>Scout supports Flask 0.10+.</p>

<p>General instructions for a Flask app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Configure Scout inside your Flask app:</p>

<pre style="width:initial">
from scout_apm.flask import ScoutApm

# Setup a flask 'app' as normal

# Attach ScoutApm to the Flask App
ScoutApm(app)

# Scout settings
app.config["SCOUT_MONITOR"] = True
app.config["SCOUT_KEY"] = "[AVAILABLE IN THE SCOUT UI]"
app.config["SCOUT_NAME"] = "A FRIENDLY NAME FOR YOUR APP"
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> and remove the calls to <code>app.config</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<p>If your app uses <code class="prettyprint">flask-sqlalchemy</code>, <a href="#flask-sqlalchemy">see below</a> for additional instrumentation instructions.</p>

<h2 id="flask-sqlalchemy">Flask SQLAlchemy</h2>

<p>Instrument <a href="https://flask-sqlalchemy.palletsprojects.com/"><code class="prettyprint">flask-sqlalchemy</code></a> queries:</p>
<pre class="highlight py tab-python"><code><span class="kn">from</span> <span class="nn">scout_apm.flask.sqlalchemy</span> <span class="kn">import</span> <span class="n">instrument_sqlalchemy</span>

<span class="c"># Assuming something like engine = create_engine('sqlite:///:memory:', echo=True)</span>
<span class="n">instrument_sqlalchemy</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre>
<h2 id="huey">Huey</h2>

<p>Scout supports Huey 2.0+.</p>

<p>Add the following to instrument your Huey application:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Add Scout to your Huey application:</p>
<pre class="terminal" style="width: initial">
from huey import SqliteHuey
<span>from scout_apm.api import Config</span>
<span>from scout_apm.huey import attach_scout</span>

broker = SqliteHuey()

<span>
Config.set(
    monitor=True,
    name="A FRIENDLY NAME FOR YOUR APP",
    key="[AVAILABLE IN THE SCOUT UI]",
)</span>
<span>attach_scout(huey)</span>
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> instead of calling <code>Config.set()</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
        <p>Tasks will appear in the &ldquo;Background Jobs&rdquo; area of the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="nameko">Nameko</h2>

<p>General instructions for a Nameko app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Configure scout once in the root of your app, and add a `ScoutReporter` to each Nameko service:</p>

<pre style="width:initial">
from scout_apm.api import Config
from scout_apm.nameko import ScoutReporter


Config.set(
    key="[AVAILABLE IN THE SCOUT UI]",
    name="A FRIENDLY NAME FOR YOUR APP",
    monitor=True,
)

class Service(object):
    name = "myservice"

    scout = ScoutReporter()

    @http("GET", "/")
    def home(self, request):
        return "Welcome home."
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> and remove the call to <code>Config.set</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="pyramid">Pyramid</h2>

<p>General instructions for a Pyramid app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Add Scout to your Pyramid config:</p>

<pre style="width:initial">
import scout_apm.pyramid

if __name__ == "__main__":
    with Configurator() as config:
        config.add_settings(
            SCOUT_KEY="[AVAILABLE IN THE SCOUT UI]",
            SCOUT_MONITOR=True,
            SCOUT_NAME="A FRIENDLY NAME FOR YOUR APP"
        )
        config.include("scout_apm.pyramid")

        # Rest of your config...
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> and remove the call to <code>config.add_settings</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="sqlalchemy">SQLAlchemy</h2>

<p>Instrument SQLAlchemy queries:</p>
<pre class="highlight py tab-python"><code><span class="kn">from</span> <span class="nn">scout_apm.sqlalchemy</span> <span class="kn">import</span> <span class="n">instrument_sqlalchemy</span>

<span class="c"># Assuming something like engine = create_engine('sqlite:///:memory:', echo=True)</span>
<span class="n">instrument_sqlalchemy</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre>
<h2 id="starlette">Starlette</h2>

<p>Scout supports Starlette 0.12+.</p>

<p>General instructions for a Starlette app:</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scout-apm</code> package:</p>
<pre style="width:500px">
pip install scout-apm
</pre>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Configure Scout and attach its middleware to your Starlette app:</p>

<pre class="terminal" style="width: initial">
<span>from scout_apm.api import Config</span>
<span>from scout_apm.async_.starlette import ScoutMiddleware</span>
from starlette.applications import Starlette

app = Starlette()

<span>Config.set(
    key="[AVAILABLE IN THE SCOUT UI]",
    name="A FRIENDLY NAME FOR YOUR APP",
    monitor=True,
)</span>
<span># Should be *last* call to add_middleware, so it's the outermost and can</span>
<span>track all requests</span>
<span>app.add_middleware(ScoutMiddleware)</span>
</pre>

<p>If you wish to configure Scout via environment variables, use <code>SCOUT_MONITOR</code>, <code>SCOUT_NAME</code> and <code>SCOUT_KEY</code> and remove the call to <code>Config.set</code>.</p>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h2 id="python-troubleshooting">Troubleshooting</h2>

<p>Not seeing data? Email support@scoutapm.com with:</p>

<ul>
<li>A link to your app within Scout (if applicable)</li>
<li>Your Python version</li>
<li>The name of the framework and version you are trying to instrument, e.g. Flask 0.10.</li>
</ul>

<p>We typically respond within a couple of hours during the business day.</p>

<h2 id="python-configuration">Configuration Reference</h2>

<table class="lookup">
  <thead>
    <tr>
      <th>
        Setting&nbsp;Name
      </th>
      <th>
        Description
      </th>
      <th>
        Default
      </th>
      <th>
        Required
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>
        key
      </th>
      <td>
        The organization API key.
      </td>
      <td>
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        name
      </th>
      <td>
        Name of the application (ex: &lsquo;Photos App&rsquo;).
      </td>
      <td>
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        monitor
      </th>
      <td>
        Whether monitoring data should be reported.
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        hostname
      </th>
      <td>
        The hostname the metrics should be aggregrated under.
      </td>
      <td>
        <code>hostname</code>
      </td>
      <td>
        Yes
      </td>
    </tr>
    <tr>
      <th>
        revision_sha
      </th>
      <td>
        The Git SHA associated with this release.
      </td>
      <td>
        <a href="#python-deploy-tracking-config">See docs</a>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        scm_subdirectory
      </th>
      <td>
        The relative path from the base of your Git repo to the directory which contains your application code.
      </td>
      <td>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_dir
      </th>
      <td>
        Path to create the directory which will store the <a href="#core-agent">Core Agent</a>.
      </td>
      <td>
        <code>/tmp/scout_apm_core</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_download
      </th>
      <td>
        Whether to download the <a href="#core-agent">Core Agent</a> automatically, if needed.
      </td>
      <td>
        <code>True</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_launch
      </th>
      <td>
        Whether to start the <a href="#core-agent">Core Agent</a> automatically, if needed.
      </td>
      <td>
        <code>True</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_permissions
      </th>
      <td>
        The permission bits to set when creating the directory of the <a href="#core-agent">.
      </td>
      <td>
        <code>700</code>
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_triple
      </th>
      <td>
        If you are running a MUSL based Linux (such as ArchLinux), you may need to explicitly specify the platform triple. E.g. <code>x86_64-unknown-linux-musl</code>
      </td>
      <td>
        Auto detected
      </td>
      <td>
        No
      </td>
    </tr>
    <tr>
      <th>
        core_agent_log_level
      </th>
      <td>
        The log level of the core agent process.
        This should be one of: <code>"trace"</code>, <code>"debug"</code>, <code>"info"</code>, <code>"warn"</code>, <code>"error"</code>.
        <br>
        <br>
        This does not affect the log level of the Python library.
        To change that, directly configure the python <code>logging</code> module as per <a href="#python-logging">the below documentation</a>.
        <br>
        <br>
        Prior to version 2.6.0, this was called `log_level`. That name now works as an alias, but is deprecated and will log a warning.
      </td>
      <td>
        <code>"info"</code>
      </td>
      <td>
        No
      </td>
    </tr>
  </tbody>
</table>

<h3 id="python-env-vars">Environment Variables</h3>

<p>You can also configure Scout APM via environment variables. <em>Environment variables override settings provided from within Python.</em></p>

<p>To configure Scout via environment variables, uppercase the config key and prefix it with <code class="prettyprint">SCOUT</code>. For example, to set the key via environment variables:</p>
<pre class="highlight  tab-plaintext"><code>export SCOUT_KEY=YOURKEY
</code></pre>
<h2 id="python-environments">Environments</h2>

<p>It typically makes sense to treat each environment (production, staging, etc) as a separate application within Scout and ignore the development and test environments. Configure a unique app name for each environment as Scout aggregates data by the app name.</p>

<p>A common approach is to set a <code class="prettyprint">SCOUT_NAME</code> environment variable that includes the app environment:</p>
<pre class="highlight  tab-plaintext"><code>export SCOUT_NAME="YOUR_APP_NAME (Staging)"
</code></pre>
<p>This will override the <code class="prettyprint">SCOUT_NAME</code> value provided in your <code class="prettyprint">settings.py</code> file.</p>

<h2 id="python-logging">Logging</h2>

<p>Scout logs via the built-in Python logger, which means you can add a handler to the <code class="prettyprint">scout_apm</code> package. If you don&rsquo;t setup logging, use the examples below as a starting point.</p>

<h3 id="log-levels">Log Levels</h3>

<p>The following log levels are available:</p>

<ul>
<li>CRITICAL</li>
<li>ERROR</li>
<li>WARNING</li>
<li>INFO</li>
<li>DEBUG</li>
</ul>

<h3 id="django-logging">Django Logging</h3>

<p>To log Scout agent output in your Django application, copy the following into your <code class="prettyprint">settings.py</code> file:</p>
<pre class="highlight python tab-python"><code><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'version'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">'disable_existing_loggers'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">'formatters'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'stdout'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'format'</span><span class="p">:</span> <span class="s">'</span><span class="si">%(asctime)</span><span class="s">s </span><span class="si">%(levelname)</span><span class="s">s </span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span>
            <span class="s">'datefmt'</span><span class="p">:</span> <span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">dT</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S</span><span class="si">%</span><span class="s">z'</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">'handlers'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'stdout'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'class'</span><span class="p">:</span> <span class="s">'logging.StreamHandler'</span><span class="p">,</span>
            <span class="s">'formatter'</span><span class="p">:</span> <span class="s">'stdout'</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s">'scout_apm'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'level'</span><span class="p">:</span> <span class="s">'DEBUG'</span><span class="p">,</span>
            <span class="s">'class'</span><span class="p">:</span> <span class="s">'logging.FileHandler'</span><span class="p">,</span>
            <span class="s">'filename'</span><span class="p">:</span> <span class="s">'scout_apm_debug.log'</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">'root'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'handlers'</span><span class="p">:</span> <span class="p">[</span><span class="s">'stdout'</span><span class="p">],</span>
        <span class="s">'level'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'LOG_LEVEL'</span><span class="p">,</span> <span class="s">'DEBUG'</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s">'loggers'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'scout_apm'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'handlers'</span><span class="p">:</span> <span class="p">[</span><span class="s">'scout_apm'</span><span class="p">],</span>
            <span class="s">'level'</span><span class="p">:</span> <span class="s">'DEBUG'</span><span class="p">,</span>
            <span class="s">'propagate'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre>
<h3 id="flask-logging">Flask Logging</h3>

<p>Add the following your Flask app:</p>
<pre class="highlight python tab-python"><code><span class="n">dictConfig</span><span class="p">({</span>
    <span class="s">'version'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">'disable_existing_loggers'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">'formatters'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'stdout'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'format'</span><span class="p">:</span> <span class="s">'</span><span class="si">%(asctime)</span><span class="s">s </span><span class="si">%(levelname)</span><span class="s">s </span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span>
            <span class="s">'datefmt'</span><span class="p">:</span> <span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">dT</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S</span><span class="si">%</span><span class="s">z'</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">'handlers'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'stdout'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'class'</span><span class="p">:</span> <span class="s">'logging.StreamHandler'</span><span class="p">,</span>
            <span class="s">'formatter'</span><span class="p">:</span> <span class="s">'stdout'</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s">'scout_apm'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'level'</span><span class="p">:</span> <span class="s">'DEBUG'</span><span class="p">,</span>
            <span class="s">'class'</span><span class="p">:</span> <span class="s">'logging.FileHandler'</span><span class="p">,</span>
            <span class="s">'filename'</span><span class="p">:</span> <span class="s">'scout_apm_debug.log'</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">'root'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'handlers'</span><span class="p">:</span> <span class="p">[</span><span class="s">'stdout'</span><span class="p">],</span>
        <span class="s">'level'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'LOG_LEVEL'</span><span class="p">,</span> <span class="s">'DEBUG'</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s">'loggers'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'scout_apm'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'handlers'</span><span class="p">:</span> <span class="p">[</span><span class="s">'scout_apm'</span><span class="p">],</span>
            <span class="s">'level'</span><span class="p">:</span> <span class="s">'DEBUG'</span><span class="p">,</span>
            <span class="s">'propagate'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">})</span>
</code></pre>
<p>If <code class="prettyprint">LOGGING</code> is already defined, merge the above into the existing Dictionary.</p>

<h3 id="celery-logging">Celery Logging</h3>

<p>Add the following to our default Celery configuration:</p>
<pre class="highlight  tab-plaintext"><code>import logging
logging.basicConfig(level='DEBUG')
</code></pre>
<h3 id="custom-instrumentation-logging">Custom Instrumentation logging</h3>

<p>If you&rsquo;ve <a href="#python-custom-instrumentation">custom Scout instrumentation</a>, add the following to record the agent logs:</p>
<pre class="highlight  tab-plaintext"><code>import logging
logging.basicConfig(level='DEBUG')
</code></pre>
<h2 id="python-custom-instrumentation">Custom Instrumentation</h2>

<p>You can extend Scout to trace transactions outside our officially supported frameworks (e.g. Cron jobs and micro web frameworks) and time the execution of code that falls outside our auto instrumentation.</p>

<h3 id="transactions-timing">Transactions &amp; Timing</h3>

<p>Scout’s instrumentation is divided into 2 areas:</p>

<ol>
<li><strong>Transactions</strong>: these wrap around a flow of work, like a web request or Cron job. The UI groups data under transactions. Use the <code class="prettyprint">@scout_apm.api.WebTransaction()</code> decorator or wrap blocks of code via the <code class="prettyprint">with scout_apm.api.WebTransaction(&#39;&#39;)</code> context manager.</li>
<li><strong>Timing</strong>: these measure individual pieces of work, like an HTTP request to an outside service and display timing information within a transaction trace. Use the <code class="prettyprint">@scout_apm.api.instrument()</code> decorator or the <code class="prettyprint">with scout_apm.api.instrument() as instrument</code> context manager.</li>
</ol>

<h3 id="instrumenting-transactions">Instrumenting transactions</h3>

<p>A transaction groups a sequence of work under in the Scout UI. These are used to generate transaction traces. For example, you may create a transaction that wraps around the entire execution of a Python script that is ran as a Cron Job.</p>

<h4 id="python-transaction-limits">Limits</h4>

<p>We limit the number of unique transactions that can be instrumented. Tracking too many unique transactions can impact the performance of our UI. Do not dynamically generate transaction names in your instrumentation (i.e. <code class="prettyprint">with scout_apm.api.WebTransaction(&#39;update_user_&quot;+user.id&#39;)</code>) as this can quickly exceed our rate limits. Use <a href="#python-custom-context">context</a> to add high-dimensionality information instead.</p>

<h4 id="getting-started">Getting Started</h4>

<p>Import the API module and configure Scout:</p>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">scout_apm.api</span>

<span class="c"># A dict containing the configuration for APM.</span>
<span class="c"># See our Python help docs for all configuration options.</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"My App Name"</span><span class="p">,</span>
    <span class="s">"key"</span><span class="p">:</span> <span class="s">"APM_Key"</span><span class="p">,</span>
    <span class="s">"monitor"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>

<span class="c"># The `install()` method must be called early on within your app code in order</span>
<span class="c"># to install the APM agent code and instrumentation.</span>
<span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</code></pre>
<h4 id="python-web-or-background">Web or Background transactions?</h4>

<p>Scout distinguishes between two types of transactions:</p>

<ul>
<li><code class="prettyprint">WebTransaction</code>: For transactions that impact the user-facing experience. Time spent in these transactions will appear on your app overboard dashboard and appear in the &ldquo;Web&rdquo; area of the UI.</li>
<li><code class="prettyprint">BackgroundTransaction</code>: For transactions that don&rsquo;t have an impact on the user-facing experience (example: cron jobs). These will be available in the &ldquo;Background Jobs&rdquo; area of the UI.</li>
</ul>

<h4 id="python-transaction-explicit">Explicit</h4>
<pre class="highlight py tab-python"><code><span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">WebTransaction</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s">"Foo"</span><span class="p">)</span>  <span class="c"># or BackgroundTransaction.start()</span>
<span class="c"># do some app work</span>
<span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">WebTransaction</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre>
<h4 id="python-transaction-context-manager">As a context manager</h4>
<pre class="highlight py tab-python"><code><span class="k">with</span> <span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">WebTransaction</span><span class="p">(</span><span class="s">"Foo"</span><span class="p">):</span>  <span class="c"># or BackgroundTransaction()</span>
    <span class="c"># do some app work</span>
</code></pre>
<h4 id="python-transaction-decorator">As a decorator</h4>
<pre class="highlight py tab-python"><code><span class="nd">@scout_apm.api.WebTransaction</span><span class="p">(</span><span class="s">"Foo"</span><span class="p">)</span>  <span class="c"># or BackgroundTransaction()</span>
<span class="k">def</span> <span class="nf">my_foo_action</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="c"># do some app work</span>
</code></pre>
<h4 id="cron-job-example">Cron Job Example</h4>
<pre class="highlight python tab-python"><code><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">scout_apm.api</span>

<span class="c"># A dict containing the configuration for APM.</span>
<span class="c"># See our Python help docs for all configuration options.</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"My App Name"</span><span class="p">,</span>
    <span class="s">"key"</span><span class="p">:</span> <span class="s">"YOUR_SCOUT_KEY"</span><span class="p">,</span>
    <span class="s">"monitor"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>

<span class="c"># The `install()` method must be called early on within your app code in order</span>
<span class="c"># to install the APM agent code and instrumentation.</span>
<span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="c"># Will appear under Background jobs in the Scout UI</span>
<span class="k">with</span> <span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">BackgroundTransaction</span><span class="p">(</span><span class="s">"Foo"</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://httpbin.org/status/418"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
<h3 id="ignoring-transactions">Ignoring Transactions</h3>

<p>If you don&rsquo;t want to track the current transaction, at any point you can call <code class="prettyprint">ignore_transaction()</code> to ignore it:</p>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">scout_apm.api</span>

<span class="k">if</span> <span class="n">is_health_check</span><span class="p">():</span>
    <span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">ignore_transaction</span><span class="p">()</span>
</code></pre>
<p>You can use this whether the transaction was started from a built-in integration or custom instrumentation.</p>

<h3 id="renaming-transactions">Renaming Transactions</h3>

<p>If you want to rename the current transaction, call <code class="prettyprint">rename_transaction()</code> with the new name:</p>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">scout_apm.api</span>

<span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">rename_transaction</span><span class="p">(</span><span class="s">"Controller/"</span> <span class="o">+</span> <span class="n">derive_graphql_name</span><span class="p">())</span>
</code></pre>
<p>You can use this whether the transaction was started from a built-in integration or custom instrumentation.</p>

<h3 id="timing-functions-and-blocks-of-code">Timing functions and blocks of code</h3>

<p>Traces that allocate significant amount of time to <code class="prettyprint">View</code>, <code class="prettyprint">Job</code>, or <code class="prettyprint">Template</code> are good candidates to add custom instrumentation. This indicates a significant amount of time is falling outside our default instrumentation.</p>

<h4 id="python-span-limits">Limits</h4>

<p>We limit the number of metrics that can be instrumented. Tracking too many unique metrics can impact the performance of our UI. Do not dynamically generate metric types in your instrumentation (ie <code class="prettyprint">with scout_apm.api.instrument(&quot;Computation_for_user_&quot; + user.email)</code>) as this can quickly exceed our rate limits.</p>

<p>For high-cardinality details, use tags: <code class="prettyprint">with scout_apm.api.instrument(&quot;Computation&quot;, tags={&quot;user&quot;: user.email})</code>.</p>

<h4 id="python-span-getting-started">Getting Started</h4>

<p>Import the API module:</p>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">scout_apm.api</span>

<span class="c"># or to not use the whole prefix on each call:</span>
<span class="kn">from</span> <span class="nn">scout_apm.api</span> <span class="kn">import</span> <span class="n">instrument</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{},</span> <span class="n">kind</span><span class="o">=</span><span class="s">"Custom"</span><span class="p">)</span>
</code></pre>
<ul>
<li><code class="prettyprint">name</code> - A semi-detailed version of what the section of code is. It should be static between different invocations of the method. Individual details like a user ID, or counts or other data points can be added as tags. Names like <code class="prettyprint">retreive_from_api</code> or <code class="prettyprint">GET</code> are good names.</li>
<li><code class="prettyprint">kind</code> - A high level area of the application. This defaults to <code class="prettyprint">Custom</code>. Your whole application should have a very low number of unique strings here. In our built-in instruments, this is things like <code class="prettyprint">Template</code> and <code class="prettyprint">SQL</code>. For custom instrumentation, it can be strings like <code class="prettyprint">MongoDB</code> or <code class="prettyprint">HTTP</code> or similar. This should not change based on input or state of the application.</li>
<li><code class="prettyprint">tags</code> - A dictionary of key/value pairs. Key should be a string, but value can be any json-able structure. High-cardinality fields like a user ID are permitted.</li>
</ul>

<h4 id="python-span-context-manager">As a context manager</h4>

<p>Wrap a section of code in a unique &ldquo;span&rdquo; of work.</p>

<p>The yielded object can be used to add additional tags individually.</p>
<pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="s">"Computation 1"</span><span class="p">)</span> <span class="k">as</span> <span class="n">instrument</span><span class="p">:</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="s">"record_count"</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="c"># Work</span>

    <span class="k">with</span> <span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="s">"Computation 2"</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s">"filtered_record_count"</span><span class="p">:</span> <span class="mi">50</span><span class="p">})</span> <span class="k">as</span> <span class="n">instrument</span><span class="p">:</span>
        <span class="c"># Work</span>
</code></pre>
<h4 id="python-span-decorator">As a decorator</h4>

<p>Wraps a whole function, timing the execution of specified function within a transaction trace. This uses the same API as the ContextManager style.</p>
<pre class="highlight python tab-python"><code><span class="nd">@scout_apm.api.instrument</span><span class="p">(</span><span class="s">"Computation"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="c"># Work</span>
</code></pre>
<h2 id="python-custom-context">Custom Context</h2>

<p><a href="#context">Context</a> lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>It&rsquo;s simple to add <a href="#context">custom context</a> to your app:</p>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">scout_apm.api</span>
<span class="c"># scout_apm.api.Context.add(key, value)</span>
<span class="n">scout_apm</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Context</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">"user_email"</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</code></pre>
<h3 id="context-key-restrictions">Context Key Restrictions</h3>

<p>The Context <code class="prettyprint">key</code> must be a <code class="prettyprint">String</code> with only printable characters. Custom context keys may contain alphanumeric characters, dashes, and underscores. Spaces are not allowed.</p>

<p>Attempts to add invalid context will be ignored.</p>

<h3 id="context-value-types">Context Value Types</h3>

<p>Context values can be any json-serializable type. Examples:</p>

<ul>
<li><code class="prettyprint">&quot;1.1.1.1&quot;</code></li>
<li><code class="prettyprint">&quot;free&quot;</code></li>
<li><code class="prettyprint">100</code></li>
</ul>

<h2 id="python-upgrade">Updating to the Newest Version</h2>
<pre class="highlight sh tab-shell"><code>pip install scout-apm --upgrade
</code></pre>
<p>The package changelog is <a href="https://github.com/scoutapp/scout_apm_python/blob/master/CHANGELOG.md">available here</a>.</p>

<h2 id="python-deploy-tracking-config">Deploy Tracking Config</h2>

<p>Scout can <a href="#deploy-tracking">track deploys</a>, making it easier to correlate specific deploys to changes in performance.</p>

<p>Scout identifies deploys via the following approaches:</p>

<ul>
<li>Setting the <code class="prettyprint">revision_sha</code> configuration value:</li>
</ul>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">scout_apm.api</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="n">Config</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">revision_sha</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">"git rev-parse HEAD"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>  <span class="c"># if the app directory is a git repo</span>
</code></pre>
<ul>
<li>Setting a <code class="prettyprint">SCOUT_REVISION_SHA</code> environment variable equal to the SHA of your latest release.</li>
<li>If you are using Heroku, enable <a href="https://devcenter.heroku.com/articles/dyno-metadata">Dyno Metadata</a>. This adds a <code class="prettyprint">HEROKU_SLUG_COMMIT</code> environment variable to your dynos, which Scout then associates with deploys.</li>
</ul>

          <h1 id="php-agent">PHP Agent</h1>

<p>Scout&rsquo;s PHP agent supports many popular libraries to instrument middleware, request times, SQL queries, and more.
The base package is called <code class="prettyprint">scoutapp/scout-apm-php</code>, and Laravel instrumentation
is in the <code class="prettyprint">scoutapp/scout-apm-laravel</code>. See our install instructions for more details..</p>

<p>Source code and issues can be found on our <a href="https://github.com/scoutapp/scout-apm-php">scout-apm-php</a> GitHub repository.</p>

<h2 id="php-requirements">Requirements</h2>

<p><code class="prettyprint">scout-apm-php</code> requires:</p>

<ul>
<li>PHP</li>
<li>A POSIX operating system, such as Linux or macOS.</li>
</ul>

<h2 id="php-instrumented-libraries">Instrumented Libraries</h2>

<p>Scout provides instrumentation for Laravel.</p>

<h3 id="php-some-configuration-required">Some configuration required</h3>

<p>The libraries below require a small number of configuration updates. Click on
the respective library for instructions.</p>

<ul>
<li><a href="#laravel">Laravel</a>

<ul>
<li>Middleware</li>
<li>Controllers</li>
<li>SQL queries</li>
</ul></li>
</ul>

<p>You can instrument your own code or other libraries via <a href="#php-custom-instrumentation">custom instrumentation</a>.
You can suggest additional libraries you&rsquo;d like Scout to instrument
<a href="https://github.com/scoutapp/scout-apm-php/issues">on GitHub</a>.</p>

<h2 id="laravel">Laravel</h2>

<p>Scout supports Laravel 5.5+.</p>

<table class="help install install_ruby">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scoutapp/scout-apm-laravel</code> package:</p>
<pre style="width:500px">
composer require scoutapp/scout-apm-laravel
</pre>
<p>
Note that the <code>scout-apm-php</code> package will automatically be included. It does
not need to be installed directly.
</p>
      </td>
    </tr>
    <tr style="display:none">
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Install the <code>scoutapm</code> php extension (optional, recommended):</p>
<pre style="width:500px">
sudo pecl install scoutapm
</pre>
<p>
Several instruments require the native extension to be included, including timing of <code>libcurl</code> and <code>file_get_contents</code>.

For more information, or to compile manually, the <a href="https://github.com/scoutapp/scout-apm-php-ext">README</a> has additional instructions.
</p>
      </td>
    </tr>
    <tr>
      <td>
        <span class="step">2</span>
      </td>
      <td style="padding-top: 15px">
        <p>Configure Scout in your <code>.env</code> file:</p>
<pre style="width:500px">
# Scout settings
SCOUT_MONITOR=true
SCOUT_KEY="[AVAILABLE IN THE SCOUT UI]"
SCOUT_NAME="A FRIENDLY NAME FOR YOUR APP"
</pre>

<p>
If you&rsquo;ve installed Scout via the Heroku Addon, the provisioning process automatically sets <code>SCOUT_MONITOR</code> and <code>SCOUT_KEY</code> via <a href="https://devcenter.heroku.com/articles/config-vars">config vars</a>. Only <code>SCOUT_NAME</code> is required.
</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">3</span></td>
      <td style="padding-top: 15px">
        <p>Deploy.</p>
        <p>It takes approximatively five minutes for your data to first appear within the Scout UI.</p>
      </td>
    </tr>
  </tbody>
</table>

<h3 id="php-middleware">Middleware</h3>

<p>Scout automatically inserts its middleware into your application on Laravel startup.</p>

<p>It adds one at the very start of the middleware stack, and one at the end,
allowing it to profile your middleware and controllers.</p>

<h2 id="php-troubleshooting">Troubleshooting</h2>

<p>Not seeing data? Email support@scoutapm.com with:</p>

<ul>
<li>A link to your app within Scout (if applicable)</li>
<li>Your PHP version</li>
<li>The name of the framework and version you are trying to instrument, e.g. Laravel 5.8</li>
</ul>

<p>We typically respond within a couple of hours during the business day.</p>

<h2 id="php-configuration">Configuration Reference</h2>

<table class="lookup">
  <thead>
    <tr>
      <th>
        Setting&nbsp;Name
      </th>
      <th>
        Description
      </th>
      <th>
        Default
      </th>
      <th>
        Required
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SCOUT_KEY</th>
      <td>
        The organization API key.
      </td>
      <td></td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>SCOUT_NAME</th>
      <td>
        Name of the application (ex: &lsquo;Photos App&rsquo;).
      </td>
      <td></td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>SCOUT_MONITOR</th>
      <td>
        Whether monitoring data should be reported.
      </td>
      <td><code>false</code></td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>SCOUT_REVISION_SHA</th>
      <td>
        The Git SHA associated with this release.
      </td>
      <td><a href="#php-deploy-tracking-config">See docs</a></td>
      <td>No</td>
    </tr>
  </tbody>
</table>

<h2 id="php-environments">Environments</h2>

<p>It typically makes sense to treat each environment (production, staging, etc)
as a separate application within Scout and ignore the development and test
environments. Configure a unique app name for each environment as Scout
aggregates data by the app name.</p>

<h2 id="php-logging">Logging</h2>

<p>Scout logs internal activity via a configured <code class="prettyprint">Psr\Log\LoggerInterface</code>. The
Laravel instruments automatically wire up the framework&rsquo;s logger to the
agent&rsquo;s logging.</p>

<p>If required, you can override this by changing the container service <code class="prettyprint">log</code>.</p>

<h2 id="php-custom-instrumentation">Custom Instrumentation</h2>

<p>You can extend Scout to trace transactions outside our officially supported
libraries (e.g. Cron jobs and other web frameworks) and time the execution of
sections of code that falls outside our provided instrumentation.</p>

<h3 id="php-transactions-timing">Transactions & Timing</h3>

<p>Scout’s instrumentation is divided into 2 areas:</p>

<ol>
<li><strong>Transactions</strong>: these wrap around an entire flow of work, like a web
request or Cron job. The Scout Web UI groups data under transactions.</li>
<li><strong>Timing</strong>: these measure small pieces of code that occur inside of a
transaction, like an HTTP request to an outside service, or a database call.
This is displayed within a transaction trace in the UI.</li>
</ol>

<h3 id="php-instrumenting-transactions">Instrumenting Transactions</h3>

<p>A transaction groups a sequence of work under in the Scout UI. These are used
to generate transaction traces. For example, you may create a transaction that
wraps around the entire execution of a PHP script that is ran as a Cron Job.</p>

<p>The Laravel instrumentation does this all for you. You only will need to
manually instrument transactions in special cases. Contact us at
support@scoutapm.com for help.</p>

<h4 id="php-transaction-limits">Limits</h4>

<p>We limit the number of unique transactions that can be instrumented. Tracking
too many uniquely named transactions can impact the performance of the UI. Do not
dynamically generate transaction names in your instrumentation as this can quickly
exceed our rate limits. Use <a href="#php-custom-context">context</a> to add
high-dimensionality information instead.</p>

<h4 id="php-web-or-background">Web or Background transactions?</h4>

<p>Scout distinguishes between two types of transactions:</p>

<ul>
<li><code class="prettyprint">WebTransaction</code>: For transactions that impact the user-facing experience.
Time spent in these transactions will appear on your app overboard dashboard
and appear in the &ldquo;Web&rdquo; area of the UI.</li>
<li><code class="prettyprint">BackgroundTransaction</code>: For transactions that don&rsquo;t have an impact on the
user-facing experience (example: cron jobs). These will be available in the
&ldquo;Background Jobs&rdquo; area of the UI.</li>
</ul>
<pre class="highlight php tab-php"><code>$agent-&gt;webTransaction("GET Users", function() { ... your code ... });
$agent-&gt;send();
</code></pre>
<h3 id="php-timing-blocks">Timing functions and blocks of code</h3>

<p>In existing transactions, both automatically created with Laravel instruments,
and also manually created, you can time sections of code that are interesting
to your application.</p>

<p>Traces that allocate significant amount of time to <code class="prettyprint">Controller</code> or <code class="prettyprint">Job</code> layers
are good candidates to add custom instrumentation. This indicates a significant
amount of time is falling outside our default instrumentation.</p>

<h4 id="php-span-limits">Limits</h4>

<p>We limit the number of metrics that can be instrumented. Tracking too many
unique metrics can impact the performance of our UI. Do not dynamically
generate metric types in your instrumentation as this can quickly exceed our
rate limits.</p>

<p>For high-cardinality details, use tags.</p>

<h4 id="php-span-getting-started">Getting Started</h4>

<p>With existing code like:</p>
<pre class="highlight  tab-plaintext"><code>$request = new ServiceRequest();
$request-&gt;setApiVersion($version);
</code></pre>
<p>It is wrapped with instrumentation:</p>
<pre class="highlight  tab-plaintext"><code>// At top, with other imports
use Scoutapm\Laravel\Facades\ScoutApm;

// Replacing the above code
$request = ScoutApm::instrument(
    "Custom", // Kind
    "Building Service Request", // Name
    function ($span) use ($version) {
        $request = new ServiceRequest();
        $request-&gt;setApiVersion($version);
        return $request;
    }
);
</code></pre>
<ul>
<li><code class="prettyprint">kind</code> - A high level area of the application. This defaults to <code class="prettyprint">Custom</code>.
Your whole application should have a very low number of unique strings here.
In our built-in instruments, this is things like <code class="prettyprint">Template</code> and <code class="prettyprint">SQL</code>. For
custom instrumentation, it can be strings like <code class="prettyprint">MongoDB</code> or <code class="prettyprint">HTTP</code> or
similar. This should not change based on input or state of the application.</li>
<li><code class="prettyprint">name</code> - A semi-detailed version of what the section of code is. It should be
static between different invocations of the method. Individual details like a
user ID, or counts or other data points can be added as tags. Names like
<code class="prettyprint">retreive_from_api</code> or <code class="prettyprint">GET</code> are good names.</li>
<li><code class="prettyprint">span</code> - An object that represents instrumenting this section of code. You
can set tags on it by calling <code class="prettyprint">$span-&gt;tag(&quot;key&quot;, &quot;value&quot;)</code></li>
<li><code class="prettyprint">tags</code> - A dictionary of key/value pairs. Key should be a string, but value
can be any json-able structure. High-cardinality fields like a user ID are
permitted.</li>
</ul>

<h2 id="php-custom-context">Custom Context</h2>

<p><a href="#context">Context</a> lets you see the key attributes of requests. For example,
you can add custom context to answer critical questions like:</p>

<ul>
<li>Which plan was the customer who had a slow request on?</li>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>It&rsquo;s simple to add <a href="#context">custom context</a> to your app:</p>
<pre class="highlight php tab-php"><code>use Scoutapm\Laravel\Facades\ScoutApm; // Laravel only: Add near the other use statements

ScoutApm::addContext("Key", "Value");

// or if you have an $agent instance:
$agent-&gt;addContext("Key", "Value");
</code></pre>
<h3 id="php-context-key-restrictions">Context Key Restrictions</h3>

<p>The Context <code class="prettyprint">key</code> must be a <code class="prettyprint">String</code> with only printable characters. Custom
context keys may contain alphanumeric characters, dashes, and underscores.
Spaces are not allowed.</p>

<p>Attempts to add invalid context will be ignored.</p>

<h3 id="php-context-value-types">Context Value Types</h3>

<p>Context values can be any json-serializable type. Examples:</p>

<ul>
<li><code class="prettyprint">&quot;1.1.1.1&quot;</code></li>
<li><code class="prettyprint">&quot;free&quot;</code></li>
<li><code class="prettyprint">100</code></li>
</ul>

<h2 id="php-upgrade">Updating to the Newest Version</h2>
<pre class="highlight sh tab-shell"><code>composer update scout-apm-laravel
</code></pre>
<p>The package changelog is <a href="https://github.com/scoutapp/scout-apm-php/blob/master/CHANGELOG.md">available here</a>.</p>

<h2 id="php-deploy-tracking-config">Deploy Tracking Config</h2>

<p>Scout can <a href="#deploy-tracking">track deploys</a>, making it easier to correlate
specific deploys to changes in performance.</p>

<p>Scout identifies deploys via the following approaches:</p>

<ul>
<li>Detecting the current git sha (this is automatically detected when <code class="prettyprint">composer install</code> is run)</li>
</ul>

          <h1 id="core-agent">Core Agent</h1>

<p>Some of the languages instrumented by Scout depend on a standalone binary for collecting and reporting data. We call this binary the Core Agent.</p>

<p>If the Core Agent is required for your language, the Scout agent library for that language will handle downloading, configuring, and launching the Core Agent automatically. However, you may manually manage the Core Agent through configuration options.</p>

<p>Builds of the Core Agent are available for these platforms and architectures:</p>

<p>Linux i686 (glibc)
Linux x86-64 (glibc)
Linux i686 (musl)
Linux x86-64 (musl)
OSX/Darwin x86-64</p>

<h1 id="other-languages">Other languages</h1>

<aside class="notice">The Core Agent API is in our tech preview program.</aside>

<p>Want to add tracing but Scout doesn&rsquo;t support your app&rsquo;s language? You can instrument just about anything (assuming you can communicate via a Unix Domain Socket) with Scout&rsquo;s <a href="https://github.com/scoutapp/core-agent-api">Core Agent API</a>. For information, view the <a href="https://github.com/scoutapp/core-agent-api">Core Agent API on GitHub</a>.</p>

          <h1 id="features">Features</h1>

<p>Scout is Application Monitoring built for modern development teams. It&rsquo;s built to provide the fastest path to a slow line-of-code. <a href="https://scoutapm.com/users/sign_up">Signup for a trial</a>.</p>

<h2 id="app-performance-overview">App Performance Overview</h2>

<p>The overview page provides an at-a-glance, auto-refreshing view of your app&rsquo;s performance and resource usage (mean response time by category, 95th percentile response time, throughput, error rate, and more). You can quickly dive into endpoint activity via click-and-drag (or pinch-and-expand with a mobile device) on the overview chart.</p>

<p><img src="images/app_show.gif" alt="overview" /></p>

<p>Additionally, you can compare metrics in the overview chart and see how your app&rsquo;s performance compares to different time periods.</p>

<h2 id="endpoint-details">Endpoint Details</h2>

<p>You can view metrics for specific controller-action and background job workers. There is a similar chart interaction to the App Performance Overview page, with one difference: your selection will render an updated list of transaction traces that correspond to the selected time period:
<img src="images/endpoint_show.gif" alt="stream" /></p>

<p>You can sort traces by response time, object allocations, date, and more.</p>

<h2 id="transaction-traces">Transaction Traces</h2>

<p>Scout collects detailed transactions across your web endpoints and background jobs automatically. The transaction traces provide a number of visual queues to direct you to hotspots. Dig into bottlenecks - down to the line-of-code, author, commit date, and deploy time - from this view.</p>

<p><img src="images/trace_timeline.png" alt="transaction traces" /></p>

<h3 id="sql-queries">SQL Queries</h3>

<p>Scout captures a sanitized version of SQL queries. Click the &ldquo;SQL&rdquo; button next to a call to view details.</p>

<p><img src="images/stream_show_sql_annotated.png" alt="stream show sql" /></p>

<h4 id="dont-see-an-sql-button-next-to-a-database-query">Don&rsquo;t see an SQL button next to a database query?</h4>

<p>Scout collects a sanitized version of SQL queries and displays these in transaction traces. To limit agent overhead sanitizing queries, we do not collect query statements with more than 16k characters.</p>

<p>This limit was raised to 16k characters from 4k characters in version 2.3.3 of the Ruby agent after determining the higher threshold was safe for production environments. If you have an older version of <code class="prettyprint">scout_apm</code>, <a href="#updating-to-the-newest-version">update to the latest</a>.</p>

<h3 id="code-backtraces">Code Backtraces</h3>

<p>You&rsquo;ll see &ldquo;CODE&rdquo; buttons next to method calls that are &gt;= 500 ms. <a href="#github">If you&rsquo;ve enabled the GitHub integration</a>, you can see the line-of-code, associated SQL or HTTP endpoint (if applicable), author, commit date, and deploy time for the relevant slow code.</p>

<p><img src="images/stream_slow_git_annotated.png" alt="stream show git" /></p>

<p>If you don&rsquo;t enable the GitHub integration, you&rsquo;ll see a backtrace.</p>

<h3 id="trace-views">Trace Views</h3>

<p>There are two displays for showing the details of a transaction trace:</p>

<ul>
<li><strong>Summary View</strong> - Method calls are aggregated together and ordered from most to least expensive.</li>
<li><strong>Timeline View</strong> - Shows the execution order of calls as they occur during the transaction.</li>
</ul>

<h4 id="summary-view">Summary View</h4>

<p>Method calls are aggregated together and listed from most expensive to least expensive. The time displayed is the total time across all calls (not the time per-call).</p>

<p><img src="images/stream_show_call_breakdown.png" alt="stream show breakdown" /></p>

<h4 id="timeline-view">Timeline View</h4>

<p>See the execution order of your code.</p>

<p><img src="images/trace_timeline_annotated.png" alt="trace timeline" /></p>

<p>The timeline view is especially helpful for:</p>

<ul>
<li>understanding the distribution of <code class="prettyprint">Controller</code> time across a request. Is there a lot of time spent in your custom code at the beginning of a request? Is it spread out? Is it at the end of a request?</li>
<li>understanding the timing of distinct SQL queries. Is one instance of many nearly identical queries slow or all of them?</li>
<li>getting the complete picture of parent and children method calls. How many SQL calls are being triggered by the same view partial?</li>
</ul>

<h5 id="upgrading-to-the-timeline-view">Upgrading to the timeline view</h5>

<p>If you see a message in the UI prompting you to upgrade, <a href="#updating-to-the-newest-version">follow our Ruby agent upgrade instructions</a> to update to the latest agent, which supports sending the timeline trace format.</p>

<h5 id="timeline-view-limitations">Timeline view limitations</h5>

<ul>
<li>Ruby-only</li>
<li>No ScoutProf support</li>
<li>No support for background jobs</li>
<li>No DevTrace support</li>
</ul>

<h2 id="trace-explorer">Trace Explorer</h2>

<p>What was the slowest request yesterday? How has the app performed for <code class="prettyprint">user@domain.com</code>? Which endpoints are generating the bulk of slow requests? Trace Explorer lets you quickly filter the transaction traces collected by Scout, giving you answers to your unique questions.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/scout-blog/s_vs_nr/crossfilter.gif" alt="crossfilter" /></p>

<p>Trace Explorer is accessed via the &ldquo;Traces&rdquo; navigation link when viewing an app.</p>

<h3 id="how-to-use-trace-explorer">How to use Trace Explorer</h3>

<p>There are two main areas of Trace Explorer:</p>

<ul>
<li><strong>Dimension Histograms</strong> - the top portion of the page generates a histogram representation for a number of trace dimensions (the response time distribution, count of traces by endpoints, and a display for each piece of <a href="#context">custom context</a>). Selecting a specific area of a chart filters the transactions to just the selected data.</li>
<li><strong>List of transaction traces</strong> - the bottom portion of the page lists the <a href="#transaction-traces">individual traces</a>. The traces are updated to reflect those that match any filtered dimensions. You can increase the height of this pane by clicking and dragging the top portion of the pane. Clicking on a trace URI opens the transaction trace in a new browser tab.</li>
</ul>

<h2 id="autoinstruments">AutoInstruments</h2>

<aside class="notice">AutoInstruments is in our BETA program.</aside>

<p>In many apps, more than 30% of the time spent in a transaction is within custom code written by your development team. In traces, this shows up as time spent in &ldquo;Controller&rdquo; or &ldquo;Job&rdquo;. AutoInstruments helps break down the time spent in your custom code without the need to add custom instrumentation on your own.</p>

<p>AutoInstruments instruments code expressions in Ruby on Rails controllers by instrumenting Ruby’s Abstract Syntax Tree (<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>) as code is loaded. These code expressions then appear in traces, just like the many libraries Scout already instruments:</p>

<p><img src="images/auto_instrument_trace.png" alt="auto instruments trace" /></p>

<p>In the screenshot of a trace above, 68% of the time would be allocated to the <code class="prettyprint">Controller</code> without enabling AutoInstruments. With AutoInstruments enabled, <code class="prettyprint">Controller</code> time is just 3% of the request and we can clearly see that most of the time is spent inside two method calls.</p>

<p>AutoInstruments is currently available for Ruby on Rails applications.</p>

<h3 id="enabling-autoinstruments">Enabling AutoInstruments</h3>

<p>AutoInstruments is a BETA feature and available to apps using Ruby 2.3.1+. To enable:</p>

<table class="help install">
  <tbody>
    <tr>
      <td><span class="step">1</span></td>
      <td><p>Within your Rails app&rsquo;s directory, run:</p><pre>bundle update scout_apm</pre>
<p>AutoInstruments was released in <code>scout_apm</code> version 2.6.0.</p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td><p>Set the <code>auto_instruments</code> <a href="auto_instruments_config">config option</a> to <code>true</code>.</p>

      If you are using a config file:
<pre>
# config/scout_apm.yml
production:
  auto_instruments: true</pre>

        If you are using environment variables:
<pre>
SCOUT_AUTO_INSTRUMENTS=true</pre>
      </td>


    </tr>

      <tr>
      <td><span class="step">3</span></td>
      <td><p>Deploy</p></td>
    </tr>
  </tbody>
</table>

<p>A <a href="#autoinstruments-faq">detailed AutoInstruments FAQ</a> is available in our reference area.</p>

<h2 id="scoutprof">ScoutProf</h2>

<aside class="notice">ScoutProf will be deprecated and succeeded by <a href="#autoinstruments">AutoInstruments</a>.</aside>

<p>Every millisecond, ScoutProf captures a backtrace of what each thread in your application is currently running.  Over many backtraces, when you combine them, it tells a story of what code paths are taking up the most time in your application.</p>

<p>Compared with our more traditional instrumentation of libraries like <code class="prettyprint">ActiveRecord</code>, <code class="prettyprint">Net::HTTP</code> and similar, ScoutProf works with your custom code.  Now, when your application spends time processing your data in custom application code, or in libraries that Scout doesn&rsquo;t yet instrument, instead of only being able to assign that to a large bucket of <code class="prettyprint">ActionController</code> time, the time can be broken down to exactly what is taking up the most time.</p>

<p>Notice how the time in <code class="prettyprint">ActionController</code> is broken down:</p>

<p><a href="images/scoutprof.png" target="_blank"><img src="images/scoutprof.png" alt="scoutprof" /></a></p>

<p>We still employ our traditional instrumentation, because it can give us deeper insights into common libraries, capturing the SQL being run, or the URL being fetched.</p>

<h3 id="enabling-scoutprof">Enabling ScoutProf</h3>

<p>ScoutProf is a BETA feature. To enable:</p>

<table class="help install">
  <tbody>
    <tr>
      <td>
        <span class="step">1</span>
      </td>
      <td>
        <p>Modify your <code>Gemfile</code> entry for <code>scout_apm</code>, changing it to: <code>gem 'scout_apm', '~> 3.0.x'</code></p>
      </td>
    </tr>
    <tr>
      <td><span class="step">2</span></td>
      <td><p><code>bundle update scout_apm</code></p></td>
    </tr>
      <tr>
      <td><span class="step">3</span></td>
      <td><p>Deploy</p></td>
    </tr>
  </tbody>
</table>

<p>A <a href="#scoutprof-faq">detailed ScoutProf FAQ</a> is available in our reference area.</p>

<h2 id="database-monitoring">Database Monitoring</h2>

<p>When the database monitoring addon is enabled, you&rsquo;ll gain access to both a high-level overview of your database query performance and detailed information on specific queries. Together, these pieces make it easier to get to the source of slow query performance.</p>

<h3 id="database-queries-overview">Database Queries Overview</h3>

<p>The high-level view helps you identify where to start:</p>

<p><a href="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/overview.png"><img alt="overview" src="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/overview.png"/></a></p>

<p>The chart at the top shows your app&rsquo;s most time-consuming queries over time. Beneath the chart, you&rsquo;ll find a sortable list of queries grouped by a label (for Rails apps, this is the ActiveRecord model and operation) and the caller (a web endpoint or a background job):</p>

<p>This high-level view is engineered to reduce the investigation time required to:</p>

<ul>
<li><strong>identify slow queries</strong>: it&rsquo;s easy for queries to become more inefficient over time as the size of your data grows. Sorting queries by &ldquo;95th percentile response time&rdquo; and &ldquo;mean response time&rdquo; makes it easy to identify your slowest queries.</li>
<li><strong>solve capacity issues</strong>: an overloaded database can have a dramatic impact on your app&rsquo;s performance. Sorting the list of queries by &ldquo;% time consumed&rdquo; shows you which queries are consuming the most time in your database.</li>
</ul>

<h4 id="zooming">Zooming</h4>

<p><strong>If there is a spike in time consumed or throughput, you can easily see what changed during that period</strong>. Click and drag over the area of interest on the chart:</p>

<p><a href="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/zoom.png"><img alt="zoom" src="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/zoom.png" /></a></p>

<p>Annotations are added to the queries list when zooming:</p>

<ul>
<li>The change in rank, based on % time consumed, of each query. Queries that jump significantly in rank may trigger a dramatic change in database performance.</li>
<li>The % change across metrics in the zoom window vs. the larger timeframe. If the % change is not significant, the metric is faded.</li>
</ul>

<h4 id="database-events">Database Events</h4>

<p>Scout highlights significant events in database performance in the sidebar. For example, if time spent in database queries increases dramatically, you&rsquo;ll find an insight here. Clicking on an insight jumps to the time window referenced by the insight.</p>

<h3 id="database-query-details">Database Query Details</h3>

<p>After identifying an expensive query, you need to see where the query is called and the underlying SQL. Click on a query to reveal details:</p>

<p><a href="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/detail.png"><img alt="detail" src="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/detail.png"/></a></p>

<p>You&rsquo;ll see the raw SQL and a list of individual query execution times that appeared in transaction traces. Scout collects backtraces on queries consuming more than 500 ms. If we&rsquo;ve collected a backtrace for the query, you&rsquo;ll see an icon next to the timing information. Click on one of the traces to reveal that trace in a new window:</p>

<p><a href="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/trace.png"><img alt="trace" src="https://s3-us-west-1.amazonaws.com/scout-blog/db_monitoring/trace.png"/></a></p>

<p>The source of that trace is immediately displayed.</p>

<h3 id="slow-query-insights">Slow Query Insights</h3>

<p>When the database monitoring addon is enabled, a new &ldquo;Slow Query&rdquo; insight is activated on your app dashboard:</p>

<p><img src="images/slow_query_insights.png" alt="slow query insights" /></p>

<p>This insight analyzes your queries in three dimensions, helping you focus on database optimizations that will most improve your app:</p>

<ol>
<li><strong>Which queries are most impacting app performance?</strong> This is based on the total time consumed of each query, where time consumed is the average query latency multiplied by the query throughput.</li>
<li><strong>Which queries are significant bottlenecks inside web endpoints and background jobs?</strong> A single query that is responsible for a large percentage of the time spent in a transaction is a great place to investigate for a performance win.</li>
<li><strong>Which queries are consistently slow?</strong> These are queries that have a high average latency.</li>
</ol>

<h3 id="pricing">Pricing</h3>

<p>Database Monitoring is available as an addon. See your billing page for pricing information.</p>

<h3 id="database-addon-installation">Database Addon Installation</h3>

<p><a href="#updating-to-the-newest-version">Update</a> - or install - the <code class="prettyprint">scout_apm</code> gem in your application. There&rsquo;s no special libraries to install on your database servers.</p>

<h3 id="database-monitoring-library-support">Database Monitoring Library Support</h3>

<p>Scout currently monitors queries executed via ActiveRecord, which includes most relational databases (PostgreSQL, MySQL, etc).</p>

<h3 id="what-does-sql-other-mean">What does SQL#other mean?</h3>

<p>Some queries may be identified by a generic <code class="prettyprint">SQL#other</code> label. This indicates our agent was unable to generate a friendly label from the raw SQL query. Ensure you are running version 2.3.3 of the <code class="prettyprint">scout_apm</code> gem or higher as this release includes more advanced query labeling logic.</p>

<h2 id="memory-bloat-detection">Memory Bloat Detection</h2>

<p>If a user triggers a request to your Rails application that results in a large number of object allocations (example: loading a large number of ActiveRecord objects), your app may require additional memory. The additional memory required to load the objects in memory is released back very slowly. Therefore, a single memory-hungry request will have a long-term impact on your Rails app&rsquo;s memory usage.</p>

<p>There are 3 specific features of Scout to aid in fixing memory bloat.</p>

<h3 id="memory-bloat-insights">Memory Bloat Insights</h3>

<p>The Insights area of the dashboard identifies controller-actions and background jobs that have triggered significant memory increases. An overview of the object allocation breakdown by tier (ActiveRecord, ActionView, etc) is displayed on the dashboard.</p>

<p><img src="images/memory_insights.png" alt="memory insights" /></p>

<h3 id="memory-traces">Memory Traces</h3>

<p>When inspecting a <a href="#transaction-traces">transaction trace</a>, you&rsquo;ll see a &ldquo;Memory Allocation Breakdown&rdquo; section:</p>

<p><img src="images/memory_trace.png" alt="memory trace" /></p>

<p>For perspective, we display how this trace&rsquo;s allocations compare to the norm.</p>

<h2 id="alerting">Alerting</h2>

<p><img src="images/alerts_chart.png" alt="alerts_chart" /></p>

<p>Alerting keeps your team updated if your app&rsquo;s performance degrades. Alerts can be configured on the app as a whole and on individual endpoints. Metrics include:</p>

<ul>
<li>mean response time</li>
<li>95th percentile response time</li>
<li>Apdex</li>
<li>error rate</li>
<li>throughput</li>
</ul>

<h3 id="alert-conditions">Alert conditions</h3>

<p>Configure alert conditions via the &ldquo;Alerts&rdquo; pill in the UI:</p>

<p><img src="images/alert_conditions.png" alt="alert_conditions" /></p>

<h3 id="notification-groups">Notification groups</h3>

<p>Alerts are sent to a notification group, which is composed of notification channels. You can configure these under your org&rsquo;s settings menu:</p>

<p><img src="images/alert_notification_groups.png" alt="alert notification groups" /></p>

<h2 id="deploy-tracking">Deploy Tracking</h2>

<p><img src="images/deploy_tracking.png" alt="deploy tracking" /></p>

<p>Correlate deploys with your app&rsquo;s performance: Scout&rsquo;s GitHub-enhanced deploy tracking makes it easy to identify the Git branch or tag running now and which team members contributed to every deploy.</p>

<p>Scout tracks your deploys without additional configuration if you are running Capistrano. If you aren&rsquo;t using Capistrano or deploying your app to Heroku, see our <a href="#ruby-deploy-tracking-config">deploy tracking configuration docs</a>.</p>

<h3 id="sorting">Sorting</h3>

<p>You can sort by memory allocations throughout the UI: from the list of endpoints, to our pulldowns, to transaction traces.</p>

<p><img src="images/memory_sort.png" alt="memory sort" /></p>

<h2 id="context">Context</h2>

<p>Context lets you see the forest from the trees. For example, you can add custom context to answer critical questions like:</p>

<ul>
<li>How many users are impacted by slow requests?</li>
<li>How many trial customers are impacted by slow requests?</li>
<li>How much of an impact are slow requests having on our highest paying customers?</li>
</ul>

<p>Adding custom context is easy - learn how via <a href="#ruby-custom-context">Ruby</a>, <a href="#elixir-custom-context">Elixir</a>, or <a href="#python-custom-context">Python</a>.</p>

<p>Context information is displayed in two areas:</p>

<ul>
<li>When viewing a <a href="#transaction-traces">transaction trace</a> - click the &ldquo;Context&rdquo; section to see the context Scout has collected.</li>
<li>When using <a href="#trace-explorer">Trace Explorer</a> - filter traces by context.</li>
</ul>

<h2 id="endpoints-performance">Endpoints Performance</h2>

<h3 id="endpoints-overview">Endpoints Overview</h3>

<p>The endpoints area within Scout provides a sortable view of your app&rsquo;s overall performance aggregated by endpoint name. Click on an endpoint to view details.</p>

<p><img src="images/endpoints_annotated.png" alt="endpoints overview" /></p>

<h2 id="time-comparisons">Time Comparisons</h2>

<p>You can easily compare the performance of your application between different time periods via the time selection on the top right corner of the UI.</p>

<p><img src="images/time_compare_annotated.png" alt="time compare" /></p>

<h2 id="digest-email">Digest Email</h2>

<p>At a frequency of your choice (daily or weekly), Scout crunches the numbers on your app&rsquo;s performance (both web endpoints and background jobs). Performance is compared to the previous week, and highlights are mentioned in the email.</p>

<p><img src="images/digest_screenshot.png" alt="digest" /></p>

<p>The email identifies performance trends, slow outliers, and attempts to narrow down issues to a specific cause (like slow HTTP requests to another service).</p>

<h2 id="devtrace">DevTrace</h2>

<p>DevTrace is our development profiler: it&rsquo;s included with our Ruby and Elixir libraries. DevTrace can be used for free without signup. Enabling DevTrace adds a speed badge when navigating your app in development. Clicking the speed badge reveals a shareable transaction trace of the request.</p>

<p><img src="images/devtrace.png" alt="devtrace" /></p>

<p>View our <a href="#ruby-devtrace">Ruby</a> and <a href="#elixir-devtrace">Elixir</a> instructions.</p>

<h2 id="chart-embeds">Chart Embeds</h2>

<p>You can embed an app&rsquo;s overview chart inside another web page (ex: an internal key metrics dashboard):</p>

<ol>
<li>Access the application dashboard within the Scout UI.</li>
<li>Adjust the timeframe and metrics to those you&rsquo;d like to include in the embedded chart.</li>
<li>Click the embed icon and copy the relevant code.</li>
</ol>

<p><img src="images/chart_embed.png" alt="chart_embed" /></p>

<p>Note that you&rsquo;ll need to update the provided iframe url with a Scout API key.</p>

<p>When clicking on an embedded chart, you&rsquo;ll be redirected to the relevant application.</p>

<h2 id="data-retention">Data Retention</h2>

<p>Scout stores 30 days of metrics and seven days of transaction traces.</p>

          <h1 id="integrations">Integrations</h1>

<h2 id="github">GitHub</h2>

<p>Scout annotates several areas of the UI with additional data from the app&rsquo;s associated Git repository when the GitHub integration is enabled.</p>

<h3 id="traces">Traces</h3>

<p>When the GitHub integration is enabled, Scout displays the actual code from backtraces collected from <a href="#transaction-traces">transaction traces</a>. The code is annotated with the <code class="prettyprint">git blame</code> data (the author and commit date), making it easier to track down developers most familar with bottlenecks.</p>

<p><img src="images/stream_slow_git_annotated.png" alt="stream show git" /></p>

<h3 id="deploys">Deploys</h3>

<p>When the GitHub integration is enabled, Scout annotates <a href="#deploy-tracing">deploys</a> with the associated Git branch or tag along. When hovering over a deploy, a <code class="prettyprint">diff</code> summary is displayed. This displays the changes between the selected deploy and the previous deploy.</p>

<p><img src="images/deploy_tracking.png" alt="deploy tracking" /></p>

<h3 id="github-configuration">Configuration</h3>

<p>The GitHub integration is an <strong>app-specific</strong> integration, authenticated via OAuth. After authenticating, choose the Git repository name and branch name used for your application.</p>

<p><img src="images/git_settings_annotated.png" alt="git settings" /></p>

<h3 id="missing-some-repositories">Missing some repositories?</h3>

<p>When configuring the GitHub integration, you may notice that only personal repositories are shown and repositories owned by organizations are missing. Your organization is likely leveraging trusted applications. See <a href="https://github.com/blog/1941-organization-approved-applications">GitHub&rsquo;s docs on organization-approved applications</a> for instructions approving Scout. Once Scout is listed as an approved application, the org&rsquo;s repositories will be available within Scout.</p>

<h2 id="rollbar">Rollbar</h2>

<p>When the Rollbar integration is enabled, Scout displays errors from the app&rsquo;s associated Rollbar project alongside performance data within the Scout UI.</p>

<p><img src="images/rollbar_errors_screenshot.png" alt="rollbar errors" /></p>

<p>When the error count is in <span style="color:#fff;background:#f0592a;padding: 2px">orange</span>, a new error has appeared in the current timeframe. When the error count is in <span style="background:#ccc;padding:2px">gray</span>, older errors are continuing in this timeframe.</p>

<h3 id="rollbar-configuration">Configuration</h3>

<p>The Rollbar configuration is an <strong>app-specific</strong> integration, configured by providing a read-only Rollbar <strong>Project Access Token</strong> (not an Account Access Token) in the app settings within Scout.</p>

<p><img src="images/rollbar_access_token.png" alt="rollbar access token" /> </p>

<p><img src="images/rollbar_settings.png" alt="rollbar settings" /></p>

<h2 id="slack">Slack</h2>

<p>To integrate Slack with Scout&rsquo;s Alert Notification system, you can utilize the Webhook feature on the <em>Application &gt; Notification Channels</em> page. In order for Scout and Slack to be able to work together, you need to use a third-party service called <a href="https://zapier.com/">Zapier</a>. Zapier is a service which allows you to connect different web services together to make custom work-flows. As well as Slack, a similar method to the one described below can be used to integrate with many different services. You can read more on our GitHub pages about how to integrate with <a href="https://github.com/scoutapp/roadmap/issues/15">PagerDuty</a>, <a href="https://github.com/scoutapp/roadmap/issues/3">VictorOps</a> and <a href="https://github.com/scoutapp/roadmap/issues/75">xMatters</a>.</p>

<h3 id="zapier-configuration">Zapier Configuration</h3>

<p>First of all you will need to create an account with <a href="https://zapier.com/">Zapier</a>, and once you have done this, you can go ahead and create a <em>Zap</em>, by clicking on the Make a Zap! button on the top right-hand side of the screen, as shown in the image below.</p>

<p><img src="images/zapier_alerts/create_new_zap.png" alt="Creating a new Zap" /></p>

<p>You need to create a <em>Trigger</em> (for Scout) and an <em>Action</em> (for Slack) in order to make the two systems able to communicate. First of all, create the trigger by selecting <em>Webhooks by Zapier</em> as the App you want to work with.</p>

<p><img src="images/zapier_alerts/create_scout_trigger.png" alt="Create a Scout trigger" /></p>

<p>Next you will need to select the type of trigger that you want, select <em>Catch Hook</em>. Next you will be given a URL, which is the Webhook that we will use to link to in Scout. Copy this URL and then open up Scout.</p>

<p><img src="images/zapier_alerts/copy_webhook_url.png" alt="Copy the Webhook URL" /></p>

<h3 id="scout-configuration">Scout Configuration</h3>

<p>In Scout, navigate to <em>Application &gt; Notification Channels</em> and create a new Webhook, like the picture below, copying in the Zapier URL.</p>

<p><img src="images/zapier_alerts/create_notification_channel.png" alt="Create a Notification Channel" /></p>

<p>Next you will need to add or edit a Notification Group to include this new channel.</p>

<p><img src="images/zapier_alerts/create_notification_group.png" alt="Create/Edit Notification Group" /></p>

<h3 id="create-an-alert">Create an Alert</h3>

<p>At this point if you try to carry on creating the Zap in Zapier, it will try to pull a sample Alert from Scout using the Webhook that we set up. The reason it does this is that it requires sample data from Scout in order to understand the format of the trigger, and what fields are available from the Scout. However, at this point there are not going to be any Alerts it can use because this Webhook has only just been set up. So here you have two options:</p>

<ul>
<li>Create a quick Alert in Scout to generate this sample data.</li>
<li>Click <em>Skip This Step</em> and then <em>Continue Without Samples</em>.</li>
</ul>

<p>We <strong>strongly recommend</strong> the first option, because later on when you are specifying the message that you are going to send to Slack, if you do not have sample data, you will not be able to use data that came from Scout. </p>

<p><img src="images/zapier_alerts/pick_sample_alert_1.png" alt="Pick a sample Alert" /></p>

<p>To create a quick Alert, open up Scout, go to <em>Alert &gt; Alert Conditions</em> and create a simple condition that will alert, and choose the Slack Notification Group we set up earlier.</p>

<p><img src="images/zapier_alerts/create_alert_condition.png" alt="Create Alert Condition" /></p>

<h3 id="choose-the-alert-in-zapier">Choose the Alert in Zapier</h3>

<p>After the Alert has occurred in Scout, go back to Zapier and click the <em>Ok, I did this</em> button and it will connect with Scout and look for an Alert with this matching Webhook. Choose this as the sample you want to use and click <em>Continue</em>.</p>

<p><img src="images/zapier_alerts/pick_sample_alert_2.png" alt="Pick a sample Alert" /></p>

<h3 id="create-a-slack-action">Create a Slack Action</h3>

<p>Next you need to add an Action step to the work-flow, this is the part were we integrate Slack. Click <em>Add a Step</em> on the left-hand side of the page.</p>

<p><img src="images/zapier_alerts/add_step.png" alt="Add a Step" /></p>

<p>Next click the <em>Action/Search</em> option, and you will be given the option to choose an app to connect.</p>

<p><img src="images/zapier_alerts/add_action.png" alt="Add an Action/Search" /></p>

<p>Choose Slack, and then a new Action will be created on the left-hand side of the screen.</p>

<p><img src="images/zapier_alerts/choose_an_app.png" alt="Choose an App" /></p>

<p>There are many different types of Slack Action that you can choose to perform, but let&rsquo;s choose <em>Send Channel Message</em>.</p>

<p><img src="images/zapier_alerts/select_slack_action.png" alt="Select a Slack Action" /></p>

<p>Next you can configure many aspects of the message that will be sent, such as which channel to send the message to and what particular data comes from the Scout Alert (shown in green). It is only possible to pull this data from Scout here if you created an Alert earlier like we advised.</p>

<p><img src="images/zapier_alerts/configure_message.png" alt="Configure the Message" /></p>

<p>Then you can send a test message to Slack to preview how it will look.</p>

<p><img src="images/zapier_alerts/test_slack.png" alt="Test Slack" /></p>

<p>Then all that&rsquo;s left to do is to give your Zap a descriptive name and enable it.</p>

<p><img src="images/zapier_alerts/name_zap.png" alt="Give your zap a name" /></p>

<p>Now everything is set up so that whenever an Alert occurs in Scout which is linked to this Notification Channel, you will see a message in Slack.</p>

<p><img src="images/zapier_alerts/end_result.png" alt="The end result" /></p>

          <h1 id="api">API</h1>

<h2 id="introduction">Introduction</h2>

<p>The ScoutAPM API is currently fairly narrow in scope. It is intended to
support 3rd party dashboards, exporting summary data from your applications.</p>

<p>If you have ideas on API enhancements, please contact us at support@scoutapm.com</p>

<h2 id="authorization">Authorization</h2>

<h3 id="obtaining-a-token">Obtaining a token</h3>

<ol>
<li>Log into the ScoutAPM website</li>
<li>Go to your organization&rsquo;s settings</li>
<li>Enter a name (for your use), and obtain a token</li>
</ol>

<h3 id="sending-authorization">Sending Authorization</h3>

<p>The key must be provided with every request, via one of several methods:</p>

<ul>
<li>An HTTP Header named <code class="prettyprint">X-SCOUT-API</code></li>
<li>As part of the JSON request body, as the top level key: <code class="prettyprint">key</code></li>
<li>A URL query string argument named <code class="prettyprint">key</code></li>
</ul>

<h3 id="response-format">Response Format</h3>

<p>Every endpoint returns a JSON object. The object will at the minimum,
have a <code class="prettyprint">&quot;header&quot;</code> field with embedded status and message fields. If the
endpoint returned results, it will be under a results keys.</p>
<pre class="highlight  tab-plaintext"><code>{
  "header": {
    "status": {
      "code": 200,
      "message": "OK"
    },
    "apiVersion": "0.1"
  },
  "results": { ... }
}
</code></pre>
<h2 id="api-endpoints">API Endpoints</h2>

<h3 id="applications">Applications</h3>

<h4 id="applications-list">Applications List</h4>

<p><code class="prettyprint">/api/v0/apps</code> - returns a list of applications and their ids</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  "apps": [
    {
      "name": "MyApp Staging",
      "id": 100
    },
    {
      "name": "MyApp Production",
      "id": 101
    }
}
</code></pre>
<h4 id="application-detail">Application Detail</h4>

<p><code class="prettyprint">/api/v0/apps/:id</code> - returns information about a specific application</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  "app": {
    "id": 101,
    "name": "MyApp Production"
  }
}
</code></pre>
<h3 id="metrics">Metrics</h3>

<h4 id="known-metric-list">Known Metric List</h4>

<p><code class="prettyprint">/api/v0/apps/:id/metrics</code> returns a list of known metric types</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  availableMetrics": [
    "response_time",
    "errors",
    "throughput"
  ]
}
</code></pre>
<h4 id="metric-data">Metric Data</h4>

<p><code class="prettyprint">/api/v0/apps/:id/metrics/:metric_type</code> - will return a time series dataset for the metric.</p>

<p><strong>Parameters:</strong></p>

<ul>
<li><strong>from</strong> - start time, ISO8601 formatted</li>
<li><strong>to</strong> - end time, ISO8601 formatted</li>
</ul>

<p>These two times must not be more than 2 weeks apart</p>

<p>Results:</p>
<pre class="highlight  tab-plaintext"><code>"results": {
  series": {
    "response_time": [
      [
        "2016-05-16T22:00:00Z",
        90.33333333333333
      ],
      [
        "2016-05-16T22:01:00Z",
        86.87233333333333
      ]
    ]
  }
}
</code></pre>
          <h1 id="compliance">Compliance</h1>

<h2 id="hipaa">HIPAA</h2>

<p>Our agent can be installed safely in HIPAA compliant environments. To ensure user data is properly de-identified:</p>

<ol>
<li>Disable sending HTTP query params if these contain sensitive data via the <code class="prettyprint">uri_reporting</code> config option.</li>
<li>Do not add custom context (like reporting the current user in the session).</li>
</ol>

<p>Email support@scoutapm.com with any questions regarding HIPAA.</p>

<h2 id="gdpr">GDPR</h2>

<p>While our monitoring agents are primarily metric-focused, they can be configured to send personal data if the customer wishes.</p>

<p>Under the GDPR, Scout is defined as a <a href="https://gdpr-info.eu/art-28-gdpr/">Data Processor</a>. You can <a href="https://app.hellosign.com/s/a349d944">view and sign our Data Processing Agreement</a> on behalf of your organization.</p>

<h2 id="pci-dss">PCI DSS</h2>

<p>Scout’s payment and card information is handled by Stripe, which has been audited by an independent PCI Qualified Security Assessor and is certified as a PCI Level 1 Service Provider, the most stringent level of certification available in the payments industry.</p>

<p>Scout does not typically receive credit card data, making it compliant with Payment Card Industry Data Security Standards (PCI DSS) in most situations.</p>

          <h1 id="service-status">Service Status</h1>

<p>We&rsquo;re transparent about our uptime and service issues. If you appear to be experiencing issues with our service:</p>

<ul>
<li><a href="https://status.scoutapm.com">Check out status site</a>. You can subscribe to service incidents.</li>
<li><a href="mailto:support@scoutapm.com">Email us</a></li>
</ul>

<h1 id="contacting-support">Contacting Support</h1>

<p>Don&rsquo;t hesitate to contact us at <a href="mailto:support@scoutapm.com">support@scoutapm.com</a> with any issues. We typically respond in a couple of hours during the business day.</p>

<p>Or, join us on <a href="http://slack.scoutapm.com/">Slack</a>. We are often, but not always, in Slack.</p>

<h1 id="reference">Reference</h1>

<h2 id="how-we-collect-metrics">How we collect metrics</h2>

<p>Scout is engineered to monitor the performance of mission-critical production applications. Here&rsquo;s a short overview of how this happens:</p>

<ul>
<li>Our agent is added as an application dependency (ex: for Ruby apps, add our gem to your Gemfile).</li>
<li>The agent instruments key libraries (database access, controllers, views, etc) automatically using low-overhead instrumentation.</li>
<li>Every minute, the agent connects over HTTPS through a 256-bit secure, encrypted connection and sends metrics to our servers.</li>
</ul>

<h2 id="performance-overhead">Performance Overhead</h2>

<p>Our agent is designed to run in production environments and is extensively benchmarked to ensure it performs on high-traffic applications.</p>

<p>Our most recent benchmarks (<em>lower is better</em>):</p>

<p><img src="images/overhead.png" alt="overhead" /></p>

<p>We&rsquo;ve <a href="https://scoutapm.com/blog/overhead-benchmarks-new-relic-vs-scout">open-sourced our benchmarks</a> so you can test on our own. If your results differ, <a href="mailto:support@scoutapm.com">reach out to us at support@scoutapm.com</a>.</p>

<h3 id="call-aggregation">Call Aggregation</h3>

<p>During a transaction, the Scout agent records each database call, each external HTTP request, each rendering of a view, and several other instrumented libraries. While each individual pieces of this overall trace has a tiny memory footprint, large transactions can sometimes build up thousands and thousands of them.  </p>

<p>To limit our agent&rsquo;s memory usage, we stop recording the details of every instrument after a relatively high limit. Detailed metrics and backtraces are collected for all calls up to the limit and aggregated metrics are collected for calls over the limit.</p>

<h2 id="security">Security</h2>

<p>We take the security of your code metrics extremely seriously. Keeping your data secure is fundamental to our business. Scout is nearing a decade storing critical metrics and those same fundamentals are applied here:</p>

<ul>
<li>All data transmitted by our agent to our servers is sent as serialized JSON over SSL.</li>
<li>Our UI is only served under SSL.</li>
<li>When additional data is collected for slow calls (ex: SQL queries), query parameters are sanitized before sending these to our servers.</li>
<li>Our infrastructure resides in an SOC2 compliant datacenter.</li>
</ul>

<h3 id="information-sent-to-our-servers">Information sent to our servers</h3>

<p>The following data is sent to our servers from the agent:</p>

<ul>
<li>Timing information collected from our instrumentation</li>
<li>Gems used by your application</li>
<li>Transaction traces, which include:

<ul>
<li>The URL, including query parameters, of the slow request. This can be modified to exclude query params via the <a href="#configuration-reference"><code>uri_reporting</code></a> configuration option.</li>
<li>IP Address of the client initiating the request</li>
<li>Sanitized SQL query statements</li>
</ul></li>
<li>Process memory and CPU usage</li>
<li>Error counts</li>
</ul>

<h3 id="git-integration-security">Git Integration</h3>

<p>Scout only needs read-only access to your repository, but unfortunately, Github doesn&rsquo;t currently allow this - they only offer read-write permissions through their OAuth API.</p>

<p>We have asked Github to offer read-only permissions, and they&rsquo;ve said that the feature coming soon. In the mean time, we&rsquo;re limited to the permissions structure Github offers. Our current Git security practices:</p>

<ul>
<li>we don&rsquo;t clone your repository&rsquo;s code; we only pull the commit history</li>
<li>the commit history is secured on our servers according to industry best practices</li>
<li>authentication subsystems within our application ensure your commit history is never exposed to anyone outside your account.</li>
</ul>

<p>All that said, we suggest the following:</p>

<ul>
<li><a href="https://github.com/contact">Contact Github</a> about allowing read-only access. This will ensure it stays top-of-mind.</li>
<li>This is optional and you are able to view backtrace information w/o the integration. It&rsquo;s likely possible to even write a UserScript to open the code locally in your editor or on Github.</li>
</ul>

<h4 id="workaround-for-read-only-github-access">Workaround for read-only Github Access</h4>

<p>With a few extra steps, you can grant Scout read-only access. Here&rsquo;s how:</p>

<ul>
<li>Create a team in your Github organization with read-only access to the respective application repositories.</li>
<li>Create a new Github user and make them a member of that team.</li>
<li>Authenticate with this user.</li>
</ul>

<h2 id="autoinstruments-faq">AutoInstruments FAQ</h2>

<h3 id="what-files-within-a-rails-app-does-autoinstruments-attempt-to-instrument">What files within a Rails app does AutoInstruments attempt to instrument?</h3>

<p>AutoInstruments applies instrumentation to file names that match <code class="prettyprint">RAILS_ROOT/app/controllers/*_controller.rb</code>.</p>

<h3 id="why-is-autoinstruments-limited-to-controllers">Why is Autoinstruments limited to controllers?</h3>

<p>Adding instrumentation induces a small amount of overhead to each instrumented code expression. If we added instrumentation to every line of code within a Rails app, the overhead would be too significant on a production deployment. By limiting Autoinstruments to controllers, we&rsquo;re striking a balance between visibility and overhead.</p>

<h3 id="what-are-some-examples-of-code-expressions-that-are-instrumented">What are some examples of code expressions that are instrumented?</h3>

<p>Below are some examples of how autoinstrumented spans appear in traces.</p>
<pre class="highlight ruby tab-ruby"><code><span class="c1"># RAILS_ROOT/app/controllers/users_controller.rb</span>
<span class="c1"># This file will be instrumented as its name matches `app/controllers/*_controller.rb`.</span>
<span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="n">fetch_users</span> <span class="c1"># &lt;- Appears as `fetch_users` in traces.</span>
    <span class="k">if</span> <span class="n">rss?</span> <span class="o">||</span> <span class="n">xml?</span> <span class="c1"># &lt;- This is broken into 2 spans within traces: (`rss?` and `xml?`)</span>
      <span class="n">formatter</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span> <span class="c1"># &lt;- The entire block will appear under "proc do |row|..."</span>
        <span class="n">row</span><span class="p">.</span><span class="nf">to_json</span>
      <span class="k">end</span>
      <span class="k">return</span> <span class="n">render_xml</span> <span class="c1"># &lt;- Appears as `return render_xml`</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">fetch_users</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="n">authorized?</span> <span class="c1"># &lt;- Appears as `return unless authorized?` in traces.</span>
    <span class="n">source</span> <span class="o">||=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:source</span><span class="p">].</span><span class="nf">present?</span> <span class="c1"># &lt;- Appears as `params[:source].present?`</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">all</span><span class="p">(</span><span class="ss">limit: </span><span class="mi">10</span><span class="p">)</span> <span class="c1"># &lt;- ActiveRecord queries are instrumented w/our AR instrumentation</span>
  <span class="k">end</span>
</code></pre>
<h3 id="is-every-method-call-to-an-autoinstrumented-code-expression-recorded">Is every method call to an autoinstrumented code expression recorded?</h3>

<p>Prior to storing a span, our agent checks if the span&rsquo;s total execution time is at least 5 ms. If the time spent is under this threshold, the span is thrown away and the time is allocated to the parent span. This decreases the amount of noise that appears in traces (spans consuming &lt; 5ms are unlikely optimization candidates) and decreases the memory usage of the agent. Only autoinstrumented spans are thrown away - spans that are explicity instrumented are retained.</p>

<h3 id="what-do-charts-look-like-when-autoinstruments-is-enabled">What do charts look like when autoinstruments is enabled?</h3>

<p>When autoinstruments is enabled, a large portion of controller time will shift to autoinstruments:</p>

<p><img src="images/autoinstruments_before_after.png" alt="autoinstruments before after" /></p>

<p>This is expected.</p>

<h3 id="how-much-overhead-does-autoinstruments-add">How much overhead does autoinstruments add?</h3>

<p>When When autoinstruments is enabled, you can estimate the additional overhead by inspecting your overview chart. Measure the mean <code class="prettyprint">controller</code> time before the deploy then <code class="prettyprint">controller</code> + <code class="prettyprint">autoinstruments</code> after. The difference between these numbers is the additional overhead.</p>

<h3 id="how-can-the-overhead-of-autoinstruments-be-reduced">How can the overhead of autoinstruments be reduced?</h3>

<p>By default, the Scout agent adds autoinstruments to every controller in your Rails app. You can exclude controllers from instrumentation, which will reduce overhead via the <a href="#auto_instruments_ignore_config"><code class="prettyprint">autoinstruments_ignore</code></a> option. To determine which controllers should be ignored:</p>

<ol>
<li>Ensure you are running version 2.6.1 of <code class="prettyprint">scout_apm</code> or later.</li>
<li>Adjust the Scout agent log level to <code class="prettyprint">DEBUG</code>.</li>
<li>Restart your app.</li>
<li>After about 10 minutes run the following command inside your <code class="prettyprint">RAILS_ROOT</code>:</li>
</ol>
<pre class="highlight  tab-plaintext"><code>grep -A20 "AutoInstrument Significant Layer Histograms" log/scout_apm.log
</code></pre>
<p>For each controller file, this will display the total number of spans recorded and the ratio of significant to total spans. Look for controllers that have a large <code class="prettyprint">total</code> and a small percentage of <code class="prettyprint">significant</code> spans. In the output below, it makes sense to ignore <code class="prettyprint">application_controller</code> as only 10% of those spans are significant:</p>
<pre class="highlight  tab-plaintext"><code>[09/23/19 07:27:52 -0600 Dereks-MacBook-Pro.local (87116)] DEBUG : AutoInstrument Significant Layer Histograms: {"/Users/dlite/projects/scout/apm/app/controllers/application_controller.rb"=&gt;
  {:total=&gt;545, :significant=&gt;0.1},
 "/Users/dlite/projects/scout/apm/app/controllers/apps_controller.rb"=&gt;
  {:total=&gt;25, :significant=&gt;0.56},
 "/Users/dlite/projects/scout/apm/app/controllers/checkin_controller.rb"=&gt;
  {:total=&gt;31, :significant=&gt;0.39},
 "/Users/dlite/projects/scout/apm/app/controllers/status_pages_controller.rb"=&gt;
  {:total=&gt;2, :significant=&gt;0.5},
 "/Users/dlite/projects/scout/apm/app/controllers/errors_controller.rb"=&gt;
  {:total=&gt;2, :significant=&gt;1.0},
 "/Users/dlite/projects/scout/apm/app/controllers/insights_controller.rb"=&gt;
  {:total=&gt;2, :significant=&gt;1.0}}
</code></pre>
<p>Add the following to the <code class="prettyprint">common: &amp;defaults</code> section of the <code class="prettyprint">config/scout_apm.yml</code> file to avoid instrumenting <code class="prettyprint">application_controller.rb</code>:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">common</span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">auto_instruments_ignore</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">application_controller'</span><span class="pi">]</span>
</code></pre>
<h2 id="scoutprof-faq">ScoutProf FAQ</h2>

<h3 id="does-scoutprof-work-with-stackprof">Does ScoutProf work with Stackprof?</h3>

<p><a href="#scoutprof">ScoutProf</a> and StackProf are not guaranteed to operate at the same time.  If you wish to use Stackprof, temporarily disable profiling in your config file (<code class="prettyprint">profile: false</code>) or via environment variables (<code class="prettyprint">SCOUT_PROFILE=false</code>). See the agent&rsquo;s <a href="#ruby-configuration-options">configuration options</a>.</p>

<h3 id="how-is-scoutprof-different-than-stackprof">How is ScoutProf different than Stackprof?</h3>

<p>Stackprof was the inspiration for ScoutProf.  Although little original Stackprof code remains, we started with Stackprof&rsquo;s core approach, and integrated it with our APM agent gem, changed it heavily to work with threaded applications, and implemented an easy to understand UI on our trace view.</p>

<h3 id="what-do-sample-counts-mean">What do sample counts mean ?</h3>

<p>ScoutProf attempts to sample your application every millisecond, capturing a snapshot backtrace of what is running in each thread.  For each successful backtrace captured, that is a sample.  Later, when we process the raw backtraces, identical traces get combined and the sample count is how many of each unique backtrace were seen.</p>

<h3 id="why-do-sample-counts-vary">Why do sample counts vary?</h3>

<p>Samples will be paused automatically for a few different reasons:</p>

<ul>
<li>If Ruby is in the middle of a GC run, samples won&rsquo;t be taken.</li>
<li>If the previous sampling hasn&rsquo;t been run, a new sampling request won&rsquo;t be added.</li>
</ul>

<p>The specifics of exactly how often these scenarios happen depend on how and in what order your ruby code runs. Different sample counts can be expected, even for the same endpoint.</p>

<h3 id="what-are-the-scoutprof-requirements">What are the ScoutProf requirements?</h3>

<ul>
<li>A Linux-based operating system</li>
<li>Ruby 2.1+</li>
</ul>

<h3 id="whats-supported-during-beta">What&rsquo;s supported during BETA?</h3>

<p>During our BETA period, ScoutProf has a few limitations:</p>

<ul>
<li>ScoutProf only runs on Linux. Support for additional distros will be added.</li>
<li>ScoutProf only breaks down time spent in ActionController, not ActionView and not Sidekiq. Support for other areas will be added.</li>
</ul>

<p>The ScoutProf-enabled version of <code class="prettyprint">scout_apm</code> can be safely installed on all environments our agent supports: the limitations above only prevent ScoutProf from running.</p>

<h3 id="can-scoutprof-be-enabled-for-actioncontroller-api-and-actioncontroller-metal-actions">Can ScoutProf be enabled for ActionController::API and ActionController::Metal actions?</h3>

<p>Yes. Add the following to your controller:</p>
<pre class="highlight ruby tab-ruby"><code><span class="k">def</span> <span class="nf">enable_scoutprof?</span><span class="p">;</span> <span class="kp">true</span><span class="p">;</span> <span class="k">end</span>
</code></pre>
<h2 id="billing">Billing</h2>

<h3 id="free-trial">Free Trial</h3>

<p>We offer a no risk, fully featured, free trial. Enter a credit or debit card anytime to continue using Scout APM after the end of your trial.</p>

<h3 id="billing-date">Billing Date</h3>

<p>Your first bill is 30 days after your signup date.</p>

<h3 id="subscription-style">Subscription Style</h3>

<h4 id="per-request">Per-Request</h4>

<p>We currently offer three transaction-based <a href="https://scoutapm.com/info/pricing">pricing plans</a>. Custom plans are available for higher transaction volume. Contact <a href="mailto:support@scoutapm.com">support@scoutapm.com</a> for pricing options.</p>

<h2 id="replacing-new-relic">Replacing New Relic</h2>

<p>Scout is an attractive <a href="https://scoutapm.com/newrelic-alternative" target="_blank">alternative to New Relic</a> for modern dev teams. We provide a laser-focus on getting to slow custom application code fast vs. wide breadth as debugging slow custom application code is typically the most time-intensive performance optimization work.</p>

<p>In many cases, Scout is able to replace New Relic as-is. However, there are cases where your app has specific needs we currently don&rsquo;t provide. Don&rsquo;t fret - here&rsquo;s some of the more common scenarios and our suggestions for building a monitoring stack you&rsquo;ll love:</p>

<ul>
<li><p><strong>Exception Monitoring</strong> - Scout doesn&rsquo;t provide exception monitoring, but we do integrate with (<a href="#rollbar">Rollbar</a> and <a href="#sentry">Sentry</a>) to provide a side-by-side view of your performance metrics and errors within the Scout UI.</p></li>
<li><p><strong>Browser Monitoring (Real User Monitoring)</strong> - there are a number of dedicated tools for both Real User Monitoring (RUM) and synthetic monitoring. We&rsquo;ve <a href="https://scoutapm.com/blog/real-user-monitoring-with-raygun">reviewed Raygun Pulse</a>, an attractive RUM product. You can also continue to use New Relic for browser monitoring and use Scout for application monitoring.</p></li>
</ul>

<h2 id="our-monitoring-stack">Our Monitoring Stack</h2>

<p>Curious about what a company that lives-and-breathes monitoring (us!) uses to monitor our apps? <a href="https://scoutapm.com/blog/rails-monitoring-stack-2016">We shared our complete monitoring stack on our blog</a>.</p>

<h3 id="talk-to-us-about-your-monitoring-stack">Talk to us about your monitoring stack</h3>

<p>Don&rsquo;t hesitate to <a href="mailto:support@scoutapm.com">email us</a> if you need to talk through your monitoring stack. Monitoring is something we know and love.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
  <script>
    /* From AnchorJS docs: Don't add anchors on later events, like $(document).ready() or window.onload as some browsers will attempt to jump to your ID before AnchorJS can add it to the page. 
    */
    /**
     * AnchorJS v3.2.0 options and selector
     */
    anchors.options.placement = 'right';
    anchors.add('.content > h2, .content > h3, .content > h4, .lookup th');

    $.ajax({
      url: "https://scoutapm.com/latest_gem_version",
      dataType: "jsonp"
    }).success(function(response){
      $("#latest-gem-version").html(response.version)
    });

    /**
     * AnchorJS v3.2.0 options and selector
     */

    // (function (global) {
    //   'use strict';
    //   anchors.options.placement = 'right';

    //   anchors.add('.content > h2, .content > h3, .content > h4');

    // })(window);

  </script>
</html>
